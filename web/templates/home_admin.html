<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>{{Id_empresa}}</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <!-- Bootstrap 3.3.7 -->
  <link rel="stylesheet" href="/static/a/bower_components/bootstrap/dist/css/bootstrap.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="/static/a/bower_components/font-awesome/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="/static/a/bower_components/Ionicons/css/ionicons.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="/static/a/dist/css/AdminLTE.min.css">
  <!-- Material Design -->
  <link rel="stylesheet" href="/static/a/dist/css/bootstrap-material-design.min.css">
  <link rel="stylesheet" href="/static/a/dist/css/ripples.min.css">
  <link rel="stylesheet" href="/static/a/dist/css/MaterialAdminLTE.min.css">
  <!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
  <link rel="stylesheet" href="/static/a/dist/css/skins/all-md-skins.min.css">
  <!-- Morris chart -->
  <link rel="stylesheet" href="/static/a/bower_components/morris.js/morris.css">
  <!-- jvectormap -->
  <link rel="stylesheet" href="/static/a/bower_components/jvectormap/jquery-jvectormap.css">
  <!-- Date Picker -->
  <link rel="stylesheet" href="/static/a/bower_components/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css">
  <!-- Daterange picker -->
  <link rel="stylesheet" href="/static/a/bower_components/bootstrap-daterangepicker/daterangepicker.css">
  <!-- bootstrap wysihtml5 - text editor -->
  <link rel="stylesheet" href="/static/a/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css">

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <!-- Google Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
    <script src="/static/vendors/jquery/dist/jquery.min.js"></script>

    <script async="" src="/static/analytics.js"></script>
      <script src="/static/charts/Chart.min.js"></script> 
    <script src="/static/charts/utils.js"></script> 
    <script src="/static/numeroALetras.js" type="text/javascript"></script> 
    <script src="/static/jspdf.debug.js"></script>
    <script src="/static/buffer.js"></script>
    <script src="/static/forge.min.js"></script>
    <script src="/static/moment.min.js"></script>
  <style>
  canvas{
    -moz-user-select: none;
    -webkit-user-select: none;
    -ms-user-select: none;
  }
.active { background-color: #1e4e86;}
.control-label {color: #1e4e86;}
  </style>


<style type="text/css">/* Chart.js */
@keyframes chartjs-render-animation{from{opacity:.99}to{opacity:1}}.chartjs-render-monitor{animation:chartjs-render-animation 1ms}.chartjs-size-monitor,.chartjs-size-monitor-expand,.chartjs-size-monitor-shrink{position:absolute;direction:ltr;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1}.chartjs-size-monitor-expand>div{position:absolute;width:1000000px;height:1000000px;left:0;top:0}.chartjs-size-monitor-shrink>div{position:absolute;width:200%;height:200%;left:0;top:0}</style>

<script type="text/javascript">
var pestalla = 1;


function cerrar_elemento(id_tab) {
  $('#' +'li' + id_tab).remove();
  $('#' +'rr' + id_tab).remove();
}

function cerrar_panel(id_tab) {
  $('#' +'id' + id_tab).remove();
  $('#' +'rr' + id_tab).remove();
}

  
var dict_pestalla = {}
var cc_porPesta = {}

var modulos = {}
var procesos = {}
var procesospk = {}

  {% for id in menu %}
  modulos["{{ id.Nombre }}"] = []{% endfor %}    

  {% for id in menu %}{% for pkmodulo in modulos %}{% if id.PkModGen == pkmodulo.PkModGen %}{% if pkmodulo.formtipo == "Registro" %}
            modulos["{{ id.Nombre }}"].push("{{ pkmodulo.mdesc }}")
            procesos["{{ pkmodulo.mdesc }}"]= "{{ pkmodulo.modulo }}"
            procesospk["{{ pkmodulo.mdesc }}"]= "{{ pkmodulo.id }}"{% endif %}{% endif %}{% endfor %}{% endfor %}











function mod_campo_largo(pkcampo, valor, id){
  tt_div = document.getElementById("div"+id.id)

  clase = tt_div.attributes["class"].value.split("-")

  clase[2] =  parseInt(clase[2]) 

  tempo = clase[2].toString().split(' ')

  clase[2] =  parseInt(tempo[0]) + parseInt(valor)

  if(clase[2] > 0){
    tt_div.attributes["class"].value = clase[0] + "-" + clase[1] + "-" + clase[2].toString().trim()
    actuai_estilo(pkcampo, 'largoweb',  clase[2].toString().trim())
  }


}
function mod_campo_invisible(pkcampo,valor, temp_pestalla){
    if(valor == 1){
      actuai_estilo(pkcampo, 'Visible',  'N')
      modificar_estilo_recarga(temp_pestalla)
    }else{
      actuai_estilo(pkcampo, 'Visible',  'Y')
      modificar_estilo_recarga(temp_pestalla)
    }
    

}
function mod_campo_salto(pkcampo, valor, id, temp_pestalla){
  if(valor == 1){
    actuai_estilo(pkcampo, 'saltoweb',  '<div class="row"></div>')
  }else{
    actuai_estilo(pkcampo, 'saltoweb',  '')
  }
  modificar_estilo_recarga(temp_pestalla)

}

var cm_pkcampoA =''
var cm_pkcampoB =''


function mod_campo_posi(pkcampo, tag, temp_pestalla){

    if(cm_pkcampoA == ''){
      cm_pkcampoA = pkcampo
      tag.style.backgroundColor = 'AQUA'
    }else{
      if(cm_pkcampoA == pkcampo){
        cm_pkcampoA = ''
        tag.style.backgroundColor = ''

      }
    }
    if(cm_pkcampoB == '' && cm_pkcampoA != pkcampo){cm_pkcampoB = pkcampo}
    if(cm_pkcampoA != '' && cm_pkcampoB != ''){
      intercambio_cc(cm_pkcampoA, cm_pkcampoB, temp_pestalla)
      cm_pkcampoA = ''
      cm_pkcampoB = ''
    }
}



function mod_campo_bloque(pkcampo, valor, id, temp_pestalla){

  if (valor == 0){actuai_estilo(pkcampo, 'posicionweb',  'arriba_izq')}
  if (valor == 1){actuai_estilo(pkcampo, 'posicionweb',  'arriba_der')}
  if (valor == 2){actuai_estilo(pkcampo, 'posicionweb',  'abajo_der')}
  if (valor == 3){actuai_estilo(pkcampo, 'posicionweb',  'abajo_izq')}
  
  modificar_estilo_recarga(temp_pestalla)
}
     
function intercambio_cc(t_pkcampoA, t_pkcampoB, t_pestalla){
        $.ajax({
          type: 'POST',
          url: '/intercambio_cc',
          data: {'fuente': $(this).attr("value"), 'csrfmiddlewaretoken': '{{ csrf_token }}', 'Id_empresa':'{{Id_empresa}}', 'usuario':'{{usuario}}', 'idioma':'{{ idioma }}', 't_pkcampoA':t_pkcampoA, 't_pkcampoB':t_pkcampoB },
          success: function(Response){
            modificar_estilo_recarga(t_pestalla)
          }
        });     
}
function actuai_estilo(t_pkcampo, t_atributo, t_valor){
        $.ajax({
          type: 'POST',
          url: '/actualiza_campo',
          data: {'fuente': $(this).attr("value"), 'csrfmiddlewaretoken': '{{ csrf_token }}', 'Id_empresa':'{{Id_empresa}}', 'usuario':'{{usuario}}', 'idioma':'{{ idioma }}', 't_pkcampo':t_pkcampo, 't_atributo':t_atributo,'t_valor':t_valor }

        });     
}


function modificar_estilo_recarga(temp_pestalla) {

        var cc_tabla = dict_pestalla["p-" + temp_pestalla]

        dict_pestalla["p-" + temp_pestalla]

        pkmodulo = dict_pestalla["p-" + temp_pestalla]["tabla_cab"]["PkModulo"]

        var id_tab = pkmodulo
        tipo = 'Nuevo'


        $.ajax({
          type: 'POST',
          url: '/{{idioma}}/consulta',
          data: {'fuente': $(this).attr("value"), 'csrfmiddlewaretoken': '{{ csrf_token }}', 'Id_empresa':'{{Id_empresa}}', 'usuario':'{{usuario}}', 'idioma':'{{ idioma }}', 'pkmodulo':pkmodulo, 'pestalla':pestalla,'pkregistro':0, 'tipo':tipo },
          success: function(Response){

            $('#rr' + pestalla).html('');

            id_dic = 'p-' + pestalla
            dict_pestalla[id_dic] = Response
            cc_porPesta[id_dic] = 1

            div_botones = '<div class="row"><div class="col-md-12"><div class="row">'
            readonly = 'readonly="readonly"'
   
           
            readonly = ''
            

            div_botones =div_botones +'<button type="button" onclick="cerrar_elemento(' + pestalla + ')" class="btn btn-danger"><span>Cerrar</span></button>'
            
            div_botones =div_botones +'</div></div></div>'

            $('#rr' + pestalla).append(div_botones);
            div_campos2 = ''
            div_campos = '<div class="card-block text-left"> <div class="row">'
            div_campos_arriba_izq= ''
            div_campos_arriba_der= ''
            div_campos_abajo_izq= ''
            div_campos_abajo_der= ''
            div_c_t =''
            ultimo_id =""
            ultimo_posi =""
            div_c_inv = ""
            div_c_inv_tt = ""
            for (x = 0; x < Response["campos_cab"].length; x++) { 
              
              if (tipo == 'Nuevo'){

                  if (Response["campos_cab"][x]["TablaCampo"] == "cmptxtsimple"){
                    valor_campo = Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["ValorPredeterminado"]

                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpnumsimple"){
                    valor_campo = Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Menor"]

                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpnumsecuencial"){
                    if (Response["campos_cab"][x]["TablaCampo"].substring(0,2) == "Pk"){
                      valor_campo = 0
                    }else{
                      valor_campo = Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["ValorInicial"]
                    }
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpopcmultiple"){
                      valor_campo = Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Valor"]

                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpsistema"){

                    if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Nombre"] == 'Usuario Actual'){
                      valor_campo = "{{usuario}}"

                    }

                    if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Nombre"] == 'Fecha Actual'){
                      var now = new Date();
                      valor_campo = now.format("Y-m-d") + 'T' +  now.format("h:m:s")
                    }


                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpformuladetalle"){
                     valor_campo = 0
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpfecha"){
                    var now = new Date();
                    if (Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Tiempo"] == "Y"){
                      valor_campo = now.format("Y-m-d") + 'T' +  now.format("h:m:s")
                    }else{
                      valor_campo = now.format("Y-m-d");
                    }
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpreferencia"){
                    valor_campo = Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0][0]["predeterminado_valor"]
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpreferenciaadjunto"){
                    valor_campo = 0
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpoperacion"){
                    valor_campo = 0
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpconsolidado"){
                    valor_campo = 0
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmparchivo"){
                    valor_campo = ""
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpnumeroaletras"){
                    valor_campo = ""
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpdecabecera"){
                    valor_campo = ""
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpelectronico"){
                    valor_campo = 0

                  }
                }else{
                  valor_campo = Response["valores_cab"][0][Response["campos_cab"][x]["Nombre"]] 

                  if(Response["campos_cab"][x]["TablaCampo"] == "cmpfecha"){

                    var now = new Date(Response["valores_cab"][0][Response["campos_cab"][x]["Nombre"]]);
                    if (Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Tiempo"] == "Y"){
                      valor_campo = now.format("Y-m-d") + 'T' +  now.format("h:m:s")
                    }else{
                      valor_campo = now.format("Y-m-d");
                    }
                    

                  }
              }

              ID_TAG = 'p' + Response["pestalla"] + 'zzz' + Response["campos_cab"][x]["Nombre"] + '';

              if (Response["campos_cab"][x]["Visible"] == "Y") {
  


                  div_c_t = Response["campos_cab"][x]["saltoweb"]
                  div_c_t = div_c_t + '<div id="div'+ ID_TAG + '" class="col-sm-' + Response["campos_cab"][x]["largoweb"] + '">'


                  div_c_t = div_c_t + '<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">'
                  div_c_t = div_c_t + '<label class="control-label for="' + Response["campos_cab"][x]["Nombre"] + '" style="font-size: 11px;" >' + Response["campos_cab"][x]["Descripcion"] + '</label>'
                  div_c_t = div_c_t + '</a><ul class="dropdown-menu" role="menu" style="text-align: center;"><li> <i onclick="mod_campo_largo(' + Response["campos_cab"][x]["PkId"] + ', -1, '+ID_TAG+')" class="fa fa-minus" style="cursor: pointer;"></i>  <i class="fa fa-arrows-h" style="width: 30px;"></i>  <i onclick="mod_campo_largo(' + Response["campos_cab"][x]["PkId"] + ', 1, '+ID_TAG+')" class="fa fa-plus" style="cursor: pointer;"></i> </li> '


                  div_c_t = div_c_t + '<li><i onclick="mod_campo_posi(' + Response["campos_cab"][x]["PkId"] + ', '+ID_TAG+', '+pestalla+')" class="fa fa-retweet" style="cursor: pointer;"></i></li>' 
                  
                  div_c_t = div_c_t + '<li><i onclick="mod_campo_invisible(' + Response["campos_cab"][x]["PkId"] + ',1, '+pestalla+')" class="fa fa-ban" style="cursor: pointer;"></i></li>' 


                  if(Response["campos_cab"][x]["saltoweb"] ==""){
                    div_c_t = div_c_t +'<li><i class="fa fa-level-down" onclick="mod_campo_salto(' + Response["campos_cab"][x]["PkId"] + ', 1, '+ID_TAG+', '+pestalla+')" style="cursor: pointer;"></i></li>'

                  }else{
                    div_c_t = div_c_t +'<li><i onclick="mod_campo_salto(' + Response["campos_cab"][x]["PkId"] + ', 0, '+ID_TAG+', '+pestalla+')" style="cursor: pointer;" class="fa fa-level-up"></i> </li>'
                  }



                if (Response["campos_cab"][x]["posicionweb"] == "arriba_izq") {
 
                  div_c_t = div_c_t +'<li onclick="mod_campo_bloque(' + Response["campos_cab"][x]["PkId"] + ', 1, '+ID_TAG+', '+pestalla+')">Mover bloque <i class="fa fa-arrow-circle-o-up"></i><i class="fa fa-arrow-circle-o-right" style="cursor: pointer;"></i></i> </li>'           
                  if(typeof(Response["campos_det"]) == "object"){
                    div_c_t = div_c_t +'<li onclick="mod_campo_bloque(' + Response["campos_cab"][x]["PkId"] + ', 2, '+ID_TAG+', '+pestalla+')" style="cursor: pointer;">Mover bloque <i class="fa fa-arrow-circle-o-down"></i><i class="fa fa-arrow-circle-o-right"></i></i> </li>'               
                    div_c_t = div_c_t +'<li onclick="mod_campo_bloque(' + Response["campos_cab"][x]["PkId"] + ', 3, '+ID_TAG+', '+pestalla+')" style="cursor: pointer;">Mover bloque <i class="fa fa-arrow-circle-o-down"></i><i class="fa fa-arrow-circle-o-left"></i></i> </li>' 
                  }
                }
                if (Response["campos_cab"][x]["posicionweb"] == "arriba_der") {
                  div_c_t = div_c_t +'<li onclick="mod_campo_bloque(' + Response["campos_cab"][x]["PkId"] + ', 0, '+ID_TAG+', '+pestalla+')" style="cursor: pointer;">Mover bloque <i class="fa fa-arrow-circle-o-up"></i><i class="fa fa-arrow-circle-o-left"></i></i></li>'   
                  if(typeof(Response["campos_det"]) == "object"){
                    div_c_t = div_c_t +'<li onclick="mod_campo_bloque(' + Response["campos_cab"][x]["PkId"] + ', 2, '+ID_TAG+', '+pestalla+')" style="cursor: pointer;">Mover bloque <i class="fa fa-arrow-circle-o-down"></i><i class="fa fa-arrow-circle-o-right"></i></i> </li>'               
                    div_c_t = div_c_t +'<li onclick="mod_campo_bloque(' + Response["campos_cab"][x]["PkId"] + ', 3, '+ID_TAG+', '+pestalla+')" style="cursor: pointer;">Mover bloque <i class="fa fa-arrow-circle-o-down"></i><i class="fa fa-arrow-circle-o-left"></i></i> </li>' 
                  }
                }
                if (Response["campos_cab"][x]["posicionweb"] == "abajo_izq") {
                  div_c_t = div_c_t +'<li onclick="mod_campo_bloque(' + Response["campos_cab"][x]["PkId"] + ', 0, '+ID_TAG+', '+pestalla+')" style="cursor: pointer;">Mover bloque <i class="fa fa-arrow-circle-o-up"></i><i class="fa fa-arrow-circle-o-left"></i></i> </li>' 
                  div_c_t = div_c_t +'<li onclick="mod_campo_bloque(' + Response["campos_cab"][x]["PkId"] + ', 1, '+ID_TAG+', '+pestalla+')" style="cursor: pointer;">Mover bloque <i class="fa fa-arrow-circle-o-up"></i><i class="fa fa-arrow-circle-o-right"></i></i> </li>'              
                  div_c_t = div_c_t +'<li onclick="mod_campo_bloque(' + Response["campos_cab"][x]["PkId"] + ', 2, '+ID_TAG+', '+pestalla+')" style="cursor: pointer;">Mover bloque <i class="fa fa-arrow-circle-o-down"></i><i class="fa fa-arrow-circle-o-right"></i></i> </li>'               

                }
                if (Response["campos_cab"][x]["posicionweb"] == "abajo_der") {
                  div_c_t = div_c_t +'<li onclick="mod_campo_bloque(' + Response["campos_cab"][x]["PkId"] + ', 0, '+ID_TAG+', '+pestalla+')" style="cursor: pointer;">Mover bloque <i class="fa fa-arrow-circle-o-up"></i><i class="fa fa-arrow-circle-o-left"></i></i> </li>' 
                  div_c_t = div_c_t +'<li onclick="mod_campo_bloque(' + Response["campos_cab"][x]["PkId"] + ', 1, '+ID_TAG+', '+pestalla+')" style="cursor: pointer;">Mover bloque <i class="fa fa-arrow-circle-o-up"></i><i class="fa fa-arrow-circle-o-right"></i></i> </li>'                           
                  div_c_t = div_c_t +'<li onclick="mod_campo_bloque(' + Response["campos_cab"][x]["PkId"] + ', 3, '+ID_TAG+', '+pestalla+')" style="cursor: pointer;">Mover bloque <i class="fa fa-arrow-circle-o-down"></i><i class="fa fa-arrow-circle-o-left"></i></i> </li>'              
                }


                  div_c_t = div_c_t +'</ul>'


                  if (Response["campos_cab"][x]["TablaCampo"] == "cmptxtsimple"){
                    readonly_int = ''
                    if (Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Modificable"] == "N"){readonly_int = 'readonly="readonly"'
                    }
                    if (tipo == 'Nuevo'){
                      valor_campo = Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["ValorPredeterminado"]
                    }
                      if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Largo"] > 100){
                         div_c_t = div_c_t + '<textarea type="text" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' '+ readonly_int +' onchange="guardar_calcular('+ ID_TAG +', 0 )" style="font-size: 11px;">'+ valor_campo +'</textarea>'
                      }else{
                          div_c_t = div_c_t + '<input type="text" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' '+ readonly_int +' onchange="guardar_calcular('+ ID_TAG +', 0 )" style="height: 25px;font-size: 11px;">'
                      }
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpnumsimple"){

                      div_c_t = div_c_t + '<input type="number" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' min="'+ Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Menor"] +'" max="'+ Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Mayor"] +'" onchange="guardar_calcular('+ ID_TAG +', 0 )" style="text-align: right;height: 25px;font-size: 11px;">'                    
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpnumsecuencial"){

                    div_c_t = div_c_t + '<input type="number" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" readonly="readonly" style="text-align: right;height: 25px;font-size: 11px;">'
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpopcmultiple"){
                    if (tipo != 'consulta'){
                      div_c_t = div_c_t + '<select class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" id="'+ ID_TAG + '" value="'+ valor_campo +'" onchange="guardar_calcular('+ ID_TAG +' , 0)" style="height: 25px;font-size: 11px;">'

                      for (z = 0; z < Response["func_cab"][Response["campos_cab"][x]["Nombre"]].length; z++) { 

                        if(valor_campo == Response["func_cab"][Response["campos_cab"][x]["Nombre"]][z]["Valor"] )
                          {
                              div_c_t = div_c_t + '<option selected>' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][z]["Valor"] + '</option>'
                          }else{
                              div_c_t = div_c_t + '<option>' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][z]["Valor"] + '</option>'
                          }
                      }
                      div_c_t = div_c_t + '</select>'                        
                    }else{
                      div_c_t = div_c_t + '<input type="text" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' onchange="guardar_calcular('+ ID_TAG +', 0 )" style="height: 25px;font-size: 11px;">'
                    }
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpsistema"){
                    if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Nombre"] == 'Usuario Actual'){
                      div_c_t = div_c_t + '<input type="text" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" readonly="readonly" style="height: 25px;font-size: 11px;">'
                    }

                    if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Nombre"] == 'Fecha Actual'){
                      div_c_t = div_c_t + '<input type="datetime-local" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" readonly="readonly" style="height: 25px;font-size: 11px;">'
                    }
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpformuladetalle"){

                    div_c_t = div_c_t + '<input type="text" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" readonly="readonly" onchange="guardar_calcular('+ ID_TAG +' , 0 )" style="text-align: right;height: 25px;font-size: 11px;">'
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpfecha"){
                    tipodato = 'date'
                 
                    if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Tiempo"] == 'Y'){
                            tipodato = 'datetime-local'}
                    div_c_t = div_c_t + '<input type="' + tipodato + '" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' onchange="guardar_calcular('+ ID_TAG +', 0 )" style="height: 25px;font-size: 11px;">'
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpreferencia"){
                    div_c_t = div_c_t + '<div class="">'
                    


                    if (tipo != 'consulta'){
                      div_c_t = div_c_t + '<input type="text" id="'+ ID_TAG + '" class="form-control col-sm-' + (Response["campos_cab"][x]["largoweb"]-1) + '" value="'+ valor_campo +'" '+ readonly +' onchange="guardar_calcular('+ ID_TAG +', 0 )" style="width: 70%;height: 25px;font-size: 11px;" onkeypress="return runScript(event, '+ ID_TAG +')" >'
                      div_c_t = div_c_t + '<button type="button" class="btn btn-primary" data-toggle="modal" data-target=".bs-example-modal-lg" onclick="buscar_referencia_cabecera('+ ID_TAG +' )"style="height: 25px;padding: 3px 4px;"><span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span></button>'
                    }else{
                      div_c_t = div_c_t + '<input type="text" id="'+ ID_TAG + '" class="form-control col-sm-' + (Response["campos_cab"][x]["largoweb"]-1) + '" value="'+ valor_campo +'" '+ readonly +' onchange="guardar_calcular('+ ID_TAG +', 0 )" style="height: 25px;font-size: 11px;" onkeypress="return runScript(event, '+ ID_TAG +')" >'
                    }
                    
                    div_c_t = div_c_t + '</div>'
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpreferenciaadjunto"){

                    if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Tipo"] == 'Imagen'){
                      div_c_t = div_c_t + '<input type="text" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +'  onchange="guardar_calcular('+ ID_TAG +', 0 )" style="height: 25px;font-size: 11px;">'

                    }
                    else{
                        Moddato = ''
                        if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Modificable"] == 'N'){
                            Moddato = 'readonly="readonly"'}
                        if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Tipo"] == 'Texto'){


                          if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Tamano"] == 'G'){

                           div_c_t = div_c_t + '<textarea type="text" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' '+ Moddato +' onchange="guardar_calcular('+ ID_TAG +', 0 )" style="height: 45px;font-size: 11px;">'+ valor_campo +'</textarea>'

                          }else{
                            div_c_t = div_c_t + '<input type="text" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' ' + Moddato + ' onchange="guardar_calcular('+ ID_TAG +', 0 )" style="height: 25px;font-size: 11px;">'
                          }


                        }
                        if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Tipo"] == 'Numero'){
                            div_c_t = div_c_t + '<input type="number" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' ' + Moddato + ' onchange="guardar_calcular('+ ID_TAG +', 0 )" style="text-align: right;" style="height: 25px;font-size: 11px;">'

                        }
                        if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Tipo"] == 'Fecha'){
                     
                            div_c_t = div_c_t + '<input type="date" id="'+ ID_TAG + '"class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' ' + Moddato + ' onchange="guardar_calcular('+ ID_TAG +', 0 )" style="height: 25px;font-size: 11px;">'
                          }
                        if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Tipo"] == 'Fecha Tiempo'){
                      
                            div_c_t = div_c_t + '<input type="datetime-local" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' ' + Moddato + ' onchange="guardar_calcular('+ ID_TAG +', 0 )" style="height: 25px;font-size: 11px;">'
                          }

                         
                    }
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpoperacion"){

                    div_c_t = div_c_t + '<input type="text" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' onchange="setTwoNumberDecimal('+ Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Decimales"] +')" readonly="readonly" onchange="guardar_calcular('+ ID_TAG +', 0 )" style="text-align: right;height: 25px;font-size: 11px;" >'
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpconsolidado"){
              
                    div_c_t = div_c_t + '<input type="text" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' readonly="readonly" onchange="guardar_calcular('+ ID_TAG +', 0)" style="height: 25px;font-size: 11px;">'
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmparchivo"){

                   div_c_t = div_c_t + '<input type="file" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' style="height: 25px;font-size: 11px;">'
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpnumeroaletras"){
             
                   div_c_t = div_c_t + '<input type="text" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' readonly="readonly" style="height: 25px;font-size: 11px;">'
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpdecabecera"){

                    div_c_t = div_c_t + '<input type="text" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' readonly="readonly" style="height: 25px;font-size: 11px;">'
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpelectronico"){

                    div_c_t = div_c_t + '<input type="text" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' readonly="readonly" style="height: 25px;font-size: 11px;">'
                  }
                  div_c_t = div_c_t + '</div>'
           

                  if (Response["campos_cab"][x]["posicionweb"] == "arriba_izq") {
                    div_campos_arriba_izq = div_campos_arriba_izq + div_c_t
                  }
                  if (Response["campos_cab"][x]["posicionweb"] == "arriba_der") {
                    div_campos_arriba_der = div_campos_arriba_der + div_c_t
                  }
                  if (Response["campos_cab"][x]["posicionweb"] == "abajo_izq") {
                    div_campos_abajo_izq = div_campos_abajo_izq + div_c_t
                  }
                  if (Response["campos_cab"][x]["posicionweb"] == "abajo_der") {
                    div_campos_abajo_der = div_campos_abajo_der + div_c_t
                  }

              }else{ 

                  div_c_inv = '<div id="div'+ ID_TAG + '" class="col-sm-' + Response["campos_cab"][x]["largoweb"] + '">'

                  div_c_inv = div_c_inv + '<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">'

                  div_c_inv = div_c_inv + '<label class="control-label for="' + Response["campos_cab"][x]["Nombre"] + '" style="font-size: 11px;" >' + Response["campos_cab"][x]["Descripcion"] + '</label></a>'
                  div_c_inv = div_c_inv + '<ul class="dropdown-menu" role="menu" style="text-align: center;">'
                  div_c_inv = div_c_inv + '<li><i onclick="mod_campo_invisible(' + Response["campos_cab"][x]["PkId"] + ',0, '+pestalla+')" class="fa fa-ban" style="cursor: pointer;"></i></li></ul>'
                  div_c_inv = div_c_inv + '<input type="text" id="'+ ID_TAG + '" value="'+ valor_campo +'" '+ readonly +'></div>'

                div_c_inv_tt = div_c_inv_tt +div_c_inv
              }

               
            }
            div_campos = div_campos + '<div class="col-md-6 col-xs-12"> <div class="row">'+ div_campos_arriba_izq + '</div></div>'
            div_campos = div_campos + '<div class="col-md-6 col-xs-12"> <div class="row">'+ div_campos_arriba_der + '</div></div>'
            
            
            $('#rr' + pestalla).append(div_campos);

            document.getElementById('id'+ pestalla).click();




            if(typeof(Response["campos_det"]) == "object"){
                    var largo_tabla= 0
                    for (x = 0; x < Response["campos_det"].length; x++) {
                      if (Response["campos_det"][x]["Visible"] == "Y") {
                        largo_tabla = largo_tabla + parseFloat(Response["campos_det"][x]["largo"])
                        
                      }
                    }

                if (tipo == 'consulta'){ 
                    div_campos = '<div style="overflow: auto;"><table id="tabla' + Response["pestalla"] + '" class="table table-striped" style="width: ' + parseInt(largo_tabla) +   'px;overflow-x:auto;font-size: 11px;"><thead><tr>'
                  }else{
                    div_campos = '<div style="overflow: auto;" ><table id="tabla' + Response["pestalla"] + '" class="table table-striped" style="width: ' + parseInt(largo_tabla) +   'px;overflow-x:auto;font-size: 11px;"><thead><tr><th style="width: 10px;"></th>'
                }
                 

                for (x = 0; x < Response["campos_det"].length; x++) { 
                  if (Response["campos_det"][x]["Visible"] == "Y") {
                    //div_campos = div_campos + '<th class="col-md-' + Response["campos_det"][x]["largoweb"] + '" style="width: ' + Response["campos_det"][x]["largo"] + 'px;">' + Response["campos_det"][x]["Descripcion"] + '</th>'
                    div_campos = div_campos + '<th class="col-md-' + Response["campos_det"][x]["largoweb"] + '" style="padding-left: 0px;padding-right: 0px;">' + Response["campos_det"][x]["Descripcion"] + '</th>'
                  } 
                }
                div_campos = div_campos +'</tr></thead><tbody>'
                var i = 0;
                do {
                    if (tipo == 'consulta'){ 
                        div_campos = div_campos + '<tr id="f' + Response["pestalla"] + '-f'+ i +'">'     
                    }else{
                        div_campos = div_campos + '<tr id="f' + Response["pestalla"] + '-f'+ i +'"><td><div class="row"  style="padding-left: 10px;">'
                        div_campos = div_campos + '<button type="button" onclick="mas(' + Response["pestalla"]+')" class="btn btn-success" style="padding: 3px 4px;">+</button>'
                        div_campos = div_campos + '<button type="button" onclick="menos(' + Response["pestalla"]+',' + i + ', 0)" class="btn btn-danger" style="padding: 3px 6px;">-</button></div></td>'
                    }


                    for (x = 0; x < Response["campos_det"].length; x++) {

                        valor_campo = 0;
                        if (tipo == 'Nuevo'){
                            
                          if (Response["campos_det"][x]["TablaCampo"] == "cmptxtsimple"){
                            valor_campo = Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["ValorPredeterminado"]
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpnumsimple"){
                            valor_campo = Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Menor"]
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpnumsecuencial"){
                            if (Response["campos_det"][x]["TablaCampo"].slice(0,2) == "Pk"){
                              valor_campo = 0
                            }else{
                              valor_campo = Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["ValorInicial"]
                            }
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpopcmultiple"){
                              valor_campo = Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Valor"]
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpsistema"){
                            if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Nombre"] == 'Usuario Actual'){
                              valor_campo = "{{usuario}}"

                            }
                            if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Nombre"] == 'Fecha Actual'){
                              var now = new Date();
                              valor_campo = now.format("Y-m-d") + 'T' +  now.format("h:m:s")
                            }
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpformuladetalle"){
                             valor_campo = 0
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpfecha"){
                            var now = new Date();
                            addi = ' AM'
                            if (Response["func_det"][Response["campos_det"][x]["Nombre"]][0][0]["Tiempo"] == "Y"){
                               if(now.format("H") > 11){addi = ' PM' }
                              valor_campo = now + addi
                            }else{
                              valor_campo = now.format("Y-m-d");
                            }
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpreferencia"){
                            valor_campo = Response["func_det"][Response["campos_det"][x]["Nombre"]][0][0]["predeterminado_valor"]
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpreferenciaadjunto"){
                            valor_campo = 0
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpoperacion"){
                            valor_campo = 0
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpconsolidado"){
                            valor_campo = 0
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpdecabecera"){
                            valor_campo = ""
                          }
                          }else{
                            valor_campo = Response["valores_det"][i][Response["campos_det"][x]["Nombre"]] 
                        }
                        
                        id_tag_detalle = 'pd' + Response["pestalla"] +  'fff'+ i + 'ccc'+ Response["campos_det"][x]["Nombre"]

                        if (Response["campos_det"][x]["Visible"] == "Y") {
                          //div_campos = div_campos + '<td><div class="col-sm-' + Response["campos_det"][x]["largoweb"] + '" col-md-' + Response["campos_det"][x]["largoweb"] + '" col-lg-' + Response["campos_det"][x]["largoweb"] + '">'
                          div_campos = div_campos + '<td style="padding-left: 0px;padding-right: 0px;"><div style="width: ' + Response["campos_det"][x]["largo"] + 'px;">'

                          if (Response["campos_det"][x]["TablaCampo"] == "cmptxtsimple"){
                              readonly_int = ''

                              if (Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Modificable"] == "N"){
                                readonly_int = 'readonly="readonly"'
                              }
                              if (tipo == 'Nuevo'){
                                valor_campo = Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["ValorPredeterminado"]
                              }
                              if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Largo"] > 100){
                                 div_campos = div_campos + '<textarea type="text" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' onchange="guardar_calcular_det('+ id_tag_detalle +')" ' + readonly_int + ' style="font-size: 11px;">'+ valor_campo +'</textarea>'
                              }else{
                               div_campos = div_campos + '<input type="text" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' onchange="guardar_calcular_det('+ id_tag_detalle +')" '+ readonly_int + ' style="height: 25px;font-size: 11px;">'
                              }
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpnumsimple"){

                              div_campos = div_campos + '<input type="number" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' onchange="guardar_calcular_det('+ id_tag_detalle +')" min="'+ Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Menor"] +'" max="'+ Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Mayor"] +'" style="text-align: right;height: 25px;font-size: 11px;">'
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpnumsecuencial"){

                            div_campos = div_campos + '<input type="number" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" readonly="readonly" onchange="guardar_calcular_det('+ id_tag_detalle +')" style="text-align: right; height: 25px; font-size: 11px;">'
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpopcmultiple"){
                            if (tipo != 'consulta'){
                              div_campos = div_campos + '<select class="form-control" id="'+id_tag_detalle +'" value="'+ valor_campo +'" onchange="guardar_calcular_det('+ id_tag_detalle +')" style="height: 25px;font-size: 11px;">'
                              for (z = 0; z < Response["func_det"][Response["campos_det"][x]["Nombre"]].length; z++) { 
                                if(valor_campo == Response["func_det"][Response["campos_det"][x]["Nombre"]][z]["Valor"] )
                                  {
                                      div_campos = div_campos + '<option selected>' + Response["func_det"][Response["campos_det"][x]["Nombre"]][z]["Valor"] + '</option>'
                                  }else{
                                      div_campos = div_campos + '<option>' + Response["func_det"][Response["campos_det"][x]["Nombre"]][z]["Valor"] + '</option>'
                                  }
                              }
                              div_campos = div_campos + '</select>'
                            }else{
                              div_campos = div_campos + '<input type="text" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' onchange="guardar_calcular_det('+ id_tag_detalle +')" style="height: 25px;font-size: 11px;" >'
                            }
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpsistema"){
                            if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Nombre"] == 'Usuario Actual'){
                              div_campos = div_campos + '<input type="text" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" readonly="readonly" style="height: 25px;font-size: 11px;">'
                            }
                            if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["NumDecimales"] == 'Fecha Actual'){
                              div_campos = div_campos + '<input type="datetime-local" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" readonly="readonly" onchange="guardar_calcular_det('+ id_tag_detalle +')" style="height: 25px;font-size: 11px;">'
                            }
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpformuladetalle"){

                            div_campos = div_campos + '<input type="text" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" readonly="readonly" onchange="guardar_calcular_det('+ id_tag_detalle +')" style="height: 25px;font-size: 11px;">'
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpfecha"){
                            tipodato = 'date'
                            if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Tiempo"] == 'Y'){
                                    tipodato = 'datetime-local'}
                            div_campos = div_campos + '<input type="' + tipodato + '" id="'+id_tag_detalle +'"  class="form-control" value="'+ valor_campo +'" '+ readonly +' onchange="guardar_calcular_det('+ id_tag_detalle +')" style="height: 25px;font-size: 11px;">'
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpreferencia"){
                            
                            if (tipo == 'consulta'){ 
                              div_campos = div_campos + '<div class="input-group"><input type="text" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' onchange="guardar_calcular_det('+ id_tag_detalle +')" style="height: 25px;font-size: 11px;" onkeypress="return runScript_detalle(event, '+ id_tag_detalle +')">'
                              div_campos = div_campos + '</div>'
                            }else{

                              div_campos = div_campos + '<div class="input-group"><input type="text" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' onchange="guardar_calcular_det('+ id_tag_detalle +')" style="width: 70%;height: 25px;font-size: 11px;" onkeypress="return runScript_detalle(event, '+ id_tag_detalle +')">'
                              div_campos = div_campos + '<button type="button" class="btn btn-primary" data-toggle="modal" data-target=".bs-example-modal-lg" onclick="buscar_referencia_detalle('+ id_tag_detalle +' )" style="height: 25px;padding: 3px 4px;"><span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></button></div>'
                             }
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpreferenciaadjunto"){
                            if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Tipo"] == 'Imagen'){

                              div_campos = div_campos + '<div class="thumbnail" style="height: 100px;margin-bottom: 1px;"><div class="image view view-first"><img style="width: 80%;height: 60%; display: block;" id="'+id_tag_detalle +'_img" src="/static/archivos/{{Id_empresa}}/'+ valor_campo +'" alt="image" value="'+ valor_campo +'"><a id="'+id_tag_detalle +'_label" href="/static/archivos/{{Id_empresa}}/'+ valor_campo +'" target="_blank">'+ valor_campo +'</a></div></div>'

                            }else{
                                Moddato = ''
                                if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Modificable"] == 'N'){
                                    Moddato = 'readonly="readonly"'}
                                if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Tipo"] == 'Texto'){
                                  if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Tamano"] == 'G'){
                                    div_campos = div_campos + '<textarea type="text" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' ' + Moddato + ' onchange="guardar_calcular_det('+ id_tag_detalle +')" style="font-size: 11px;">'+ valor_campo +'</textarea>'
                                  }else{
                                    div_campos = div_campos + '<input type="text" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' ' + Moddato + ' onchange="guardar_calcular_det('+ id_tag_detalle +')" style="height: 25px;font-size: 11px;">'
                                  }
                                  
                                }
                                if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Tipo"] == 'Numero'){

                                    div_campos = div_campos + '<input type="number" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' ' + Moddato + ' onchange="guardar_calcular_det('+ id_tag_detalle +')" style="text-align: right;height: 25px;font-size: 11px;">'
                                }
                                if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Tipo"] == 'Fecha'){

                                    div_campos = div_campos + '<input type="date" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' ' + Moddato + ' onchange="guardar_calcular_det('+ id_tag_detalle +')" style="height: 25px;font-size: 11px;">'
                                  }
                                if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Tipo"] == 'Fecha Tiempo'){

                                    div_campos = div_campos + '<input type="datetime-local" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' ' + Moddato + ' onchange="guardar_calcular_det('+ id_tag_detalle +')" style="height: 25px;font-size: 11px;">'
                                  }
                            }
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpoperacion"){

                            div_campos = div_campos + '<input type="text" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' onchange="setTwoNumberDecimal('+ Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Decimales"] +')" readonly="readonly" style="text-align: right;height: 25px;font-size: 11px;"> '
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpconsolidado"){
                      
                            div_campos = div_campos + '<input type="text" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' readonly="readonly" style="height: 25px;font-size: 11px;">'
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmparchivo"){

                           div_campos = div_campos + '<input type="file" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' style="height: 25px;font-size: 11px;">'
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpnumeroaletras"){
                     
                           div_campos = div_campos + '<input type="text" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' readonly="readonly" style="height: 25px;font-size: 11px;">'
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpdecabecera"){

                            div_campos = div_campos + '<input type="text" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' readonly="readonly" style="height: 25px;font-size: 11px;">'
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpelectronico"){

                            div_campos = div_campos + '<input type="text" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' readonly="readonly" style="height: 25px;font-size: 11px;">'
                          }

                          div_campos = div_campos + '</div></td>'

                        } else {
                          div_campos = div_campos + '<input type="hidden" id="'+id_tag_detalle +'" value="' +valor_campo+ '" '+ readonly +'>'
                        } 
                    }

                    div_campos = div_campos + '</tr>'
                    i++;
                }while (i < Response["valores_det"].length);
            
              cc_porPesta['p-'+pestalla] = (Response["valores_det"].length )
              div_campos = div_campos + '</tbody></table></div>'
                           

              $('#rr' + pestalla).append(div_campos);

              $('#rr' + pestalla).append('<div class="col-md-6 col-xs-12"> <div class="row">'+ div_campos_abajo_izq + '</div></div>');
              $('#rr' + pestalla).append('<div class="col-md-6 col-xs-12"> <div class="row">'+ div_campos_abajo_der + '</div></div>');
              $('#rr' + pestalla).append('Campos invisibles <br><div class="row">'+ div_c_inv_tt + '</div>');
              
              
              document.getElementById('id'+ pestalla).click();
            } 

          }
        });     
}
function modificar_estilo(pkmodulo, pkregistro, tipo, temp_pestalla) {

        pestalla = pestalla +1;

        if(temp_pestalla == 'consulta'){
            $("#myTab").prepend('<li role="presentation" class="" id="li' + pestalla + '"><a href="#rr' + pestalla + '" id="id' + pestalla + '" role="tab" data-toggle="tab" aria-expanded="false">Consulta</a></li>');
        }else{
          if(dict_pestalla['p-'+temp_pestalla]["tabla_cab"] == undefined){
           $("#myTab").prepend('<li role="presentation" class="" id="li' + pestalla + '"><a href="#rr' + pestalla + '" id="id' + pestalla + '" role="tab" data-toggle="tab" aria-expanded="false">' + dict_pestalla['p-'+temp_pestalla]["tabla"][0]["Descripcion"] + '</a></li>');
        }else{

          $("#myTab").prepend('<li role="presentation" class="" id="li' + pestalla + '"><a href="#rr' + pestalla + '" id="id' + pestalla + '" role="tab" data-toggle="tab" aria-expanded="false">' +  dict_pestalla['p-'+temp_pestalla]["tabla_cab"]["Descripcion"] + '</a></li>');
        }
        }
        


        var id_tab = pkmodulo
        tipo = 'Nuevo'


        $.ajax({
          type: 'POST',
          url: '/{{idioma}}/consulta',
          data: {'fuente': $(this).attr("value"), 'csrfmiddlewaretoken': '{{ csrf_token }}', 'Id_empresa':'{{Id_empresa}}', 'usuario':'{{usuario}}', 'idioma':'{{ idioma }}', 'pkmodulo':pkmodulo, 'pestalla':pestalla,'pkregistro':pkregistro, 'tipo':tipo },
          beforeSend: function () {
              $("#myTabContent").prepend('<div role="tabpanel" class="tab-pane fade" id="rr' + pestalla + '" aria-labelledby="id' + pestalla + '"> Procesando </div>');
             },
          success: function(Response){

            $('#rr' + pestalla).html('');

            id_dic = 'p-' + pestalla
            dict_pestalla[id_dic] = Response
            cc_porPesta[id_dic] = 1

            div_botones = '<div class="row"><div class="col-md-12"><div class="row">'
            readonly = 'readonly="readonly"'
   
           
            readonly = ''
            

            div_botones =div_botones +'<button type="button" onclick="cerrar_elemento(' + pestalla + ')" class="btn btn-danger"><span>Cerrar</span></button>'
            
            div_botones =div_botones +'</div></div></div>'

            $('#rr' + pestalla).append(div_botones);
            div_campos2 = ''
            div_campos = '<div class="card-block text-left"> <div class="row">'
            div_campos_arriba_izq= ''
            div_campos_arriba_der= ''
            div_campos_abajo_izq= ''
            div_campos_abajo_der= ''
            div_c_t =''
            ultimo_id = ''
            div_c_inv = ""
            div_c_inv_tt = ""
            for (x = 0; x < Response["campos_cab"].length; x++) { 
              
              if (tipo == 'Nuevo'){

                  if (Response["campos_cab"][x]["TablaCampo"] == "cmptxtsimple"){
                    valor_campo = Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["ValorPredeterminado"]

                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpnumsimple"){
                    valor_campo = Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Menor"]

                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpnumsecuencial"){
                    if (Response["campos_cab"][x]["TablaCampo"].substring(0,2) == "Pk"){
                      valor_campo = 0
                    }else{
                      valor_campo = Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["ValorInicial"]
                    }
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpopcmultiple"){
                      valor_campo = Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Valor"]

                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpsistema"){

                    if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Nombre"] == 'Usuario Actual'){
                      valor_campo = "{{usuario}}"

                    }

                    if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Nombre"] == 'Fecha Actual'){
                      var now = new Date();
                      valor_campo = now.format("Y-m-d") + 'T' +  now.format("h:m:s")
                    }


                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpformuladetalle"){
                     valor_campo = 0
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpfecha"){
                    var now = new Date();
                    if (Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Tiempo"] == "Y"){
                      valor_campo = now.format("Y-m-d") + 'T' +  now.format("h:m:s")
                    }else{
                      valor_campo = now.format("Y-m-d");
                    }
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpreferencia"){
                    valor_campo = Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0][0]["predeterminado_valor"]
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpreferenciaadjunto"){
                    valor_campo = 0
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpoperacion"){
                    valor_campo = 0
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpconsolidado"){
                    valor_campo = 0
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmparchivo"){
                    valor_campo = ""
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpnumeroaletras"){
                    valor_campo = ""
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpdecabecera"){
                    valor_campo = ""
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpelectronico"){
                    valor_campo = 0

                  }
                }else{
                  valor_campo = Response["valores_cab"][0][Response["campos_cab"][x]["Nombre"]] 

                  if(Response["campos_cab"][x]["TablaCampo"] == "cmpfecha"){

                    var now = new Date(Response["valores_cab"][0][Response["campos_cab"][x]["Nombre"]]);
                    if (Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Tiempo"] == "Y"){
                      valor_campo = now.format("Y-m-d") + 'T' +  now.format("h:m:s")
                    }else{
                      valor_campo = now.format("Y-m-d");
                    }
                    

                  }
              }

              ID_TAG = 'p' + Response["pestalla"] + 'zzz' + Response["campos_cab"][x]["Nombre"] + '';
              
             

              if (Response["campos_cab"][x]["Visible"] == "Y") {
                

                  div_c_t = Response["campos_cab"][x]["saltoweb"]
                  div_c_t = div_c_t + '<div id="div'+ ID_TAG + '" class="col-sm-' + Response["campos_cab"][x]["largoweb"] + '">'

                  div_c_t = div_c_t + '<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">'

                  div_c_t = div_c_t + '<label class="control-label for="' + Response["campos_cab"][x]["Nombre"] + '" style="font-size: 11px;" >' + Response["campos_cab"][x]["Descripcion"] + '</label>'
                  div_c_t = div_c_t + '</a><ul class="dropdown-menu" role="menu" style="text-align: center;"><li> <i onclick="mod_campo_largo(' + Response["campos_cab"][x]["PkId"] + ', -1, '+ID_TAG+')" class="fa fa-minus" style="cursor: pointer;"></i>  <i class="fa fa-arrows-h" style="width: 30px;"></i>  <i onclick="mod_campo_largo(' + Response["campos_cab"][x]["PkId"] + ', 1, '+ID_TAG+')" class="fa fa-plus" style="cursor: pointer;"></i> </li>'


                    div_c_t = div_c_t + '<li><i onclick="mod_campo_posi(' + Response["campos_cab"][x]["PkId"] + ', '+ID_TAG+', '+pestalla+')" class="fa fa-retweet" style="cursor: pointer;"></i>  </li>' 
                    div_c_t = div_c_t + '<li><i onclick="mod_campo_invisible(' + Response["campos_cab"][x]["PkId"] + ',1,  '+pestalla+')" class="fa fa-ban" style="cursor: pointer;"></i></li>'
               
                  if(Response["campos_cab"][x]["saltoweb"] ==""){
                    div_c_t = div_c_t +'<li><i class="fa fa-level-down" onclick="mod_campo_salto(' + Response["campos_cab"][x]["PkId"] + ', 1, '+ID_TAG+', '+pestalla+')" style="cursor: pointer;"></i></li>'

                  }else{
                    div_c_t = div_c_t +'<li><i onclick="mod_campo_salto(' + Response["campos_cab"][x]["PkId"] + ', 0, '+ID_TAG+', '+pestalla+')" style="cursor: pointer;" class="fa fa-level-up"></i> </li>'
                  }



                if (Response["campos_cab"][x]["posicionweb"] == "arriba_izq") {
 
                  div_c_t = div_c_t +'<li onclick="mod_campo_bloque(' + Response["campos_cab"][x]["PkId"] + ', 1, '+ID_TAG+', '+pestalla+')" style="cursor: pointer;">Mover bloque <i class="fa fa-arrow-circle-o-up"></i><i class="fa fa-arrow-circle-o-right"></i></i> </li>'       
                  if(typeof(Response["campos_det"]) == "object"){
                    div_c_t = div_c_t +'<li onclick="mod_campo_bloque(' + Response["campos_cab"][x]["PkId"] + ', 2, '+ID_TAG+', '+pestalla+')" style="cursor: pointer;">Mover bloque <i class="fa fa-arrow-circle-o-down"></i><i class="fa fa-arrow-circle-o-right"></i></i> </li>'               
                    div_c_t = div_c_t +'<li onclick="mod_campo_bloque(' + Response["campos_cab"][x]["PkId"] + ', 3, '+ID_TAG+', '+pestalla+')" style="cursor: pointer;">Mover bloque <i class="fa fa-arrow-circle-o-down"></i><i class="fa fa-arrow-circle-o-left"></i></i> </li>'
                  }
       
                  
                   }
                if (Response["campos_cab"][x]["posicionweb"] == "arriba_der") {
                  div_c_t = div_c_t +'<li onclick="mod_campo_bloque(' + Response["campos_cab"][x]["PkId"] + ', 0, '+ID_TAG+', '+pestalla+')" style="cursor: pointer;">Mover bloque <i class="fa fa-arrow-circle-o-up"></i><i class="fa fa-arrow-circle-o-left"></i></i> </li>'       
                  if(typeof(Response["campos_det"]) == "object"){
                    div_c_t = div_c_t +'<li onclick="mod_campo_bloque(' + Response["campos_cab"][x]["PkId"] + ', 2, '+ID_TAG+', '+pestalla+')" style="cursor: pointer;">Mover bloque <i class="fa fa-arrow-circle-o-down"></i><i class="fa fa-arrow-circle-o-right"></i></i> </li>'               
                    div_c_t = div_c_t +'<li onclick="mod_campo_bloque(' + Response["campos_cab"][x]["PkId"] + ', 3, '+ID_TAG+', '+pestalla+')" style="cursor: pointer;">Mover bloque <i class="fa fa-arrow-circle-o-down"></i><i class="fa fa-arrow-circle-o-left"></i></i> </li>' 
                  }
                }
                if (Response["campos_cab"][x]["posicionweb"] == "abajo_izq") {
                  div_c_t = div_c_t +'<li onclick="mod_campo_bloque(' + Response["campos_cab"][x]["PkId"] + ', 0, '+ID_TAG+', '+pestalla+')" style="cursor: pointer;">Mover bloque <i class="fa fa-arrow-circle-o-up"></i><i class="fa fa-arrow-circle-o-left"></i></i> </li>' 
                  div_c_t = div_c_t +'<li onclick="mod_campo_bloque(' + Response["campos_cab"][x]["PkId"] + ', 1, '+ID_TAG+', '+pestalla+')" style="cursor: pointer;">Mover bloque <i class="fa fa-arrow-circle-o-up"></i><i class="fa fa-arrow-circle-o-right"></i></i> </li>'              
                  div_c_t = div_c_t +'<li onclick="mod_campo_bloque(' + Response["campos_cab"][x]["PkId"] + ', 2, '+ID_TAG+', '+pestalla+')" style="cursor: pointer;">Mover bloque <i class="fa fa-arrow-circle-o-down"></i><i class="fa fa-arrow-circle-o-right"></i></i> </li>'               
                }
                if (Response["campos_cab"][x]["posicionweb"] == "abajo_der") {
                  div_c_t = div_c_t +'<li onclick="mod_campo_bloque(' + Response["campos_cab"][x]["PkId"] + ', 0, '+ID_TAG+', '+pestalla+')" style="cursor: pointer;">Mover bloque <i class="fa fa-arrow-circle-o-up"></i><i class="fa fa-arrow-circle-o-left"></i></i> </li>' 
                  div_c_t = div_c_t +'<li onclick="mod_campo_bloque(' + Response["campos_cab"][x]["PkId"] + ', 1, '+ID_TAG+', '+pestalla+')" style="cursor: pointer;">Mover bloque <i class="fa fa-arrow-circle-o-up"></i><i class="fa fa-arrow-circle-o-right"></i></i> </li>'                           
                  div_c_t = div_c_t +'<li onclick="mod_campo_bloque(' + Response["campos_cab"][x]["PkId"] + ', 3, '+ID_TAG+', '+pestalla+')" style="cursor: pointer;">Mover bloque <i class="fa fa-arrow-circle-o-down"></i><i class="fa fa-arrow-circle-o-left"></i></i> </li>'              
                }


                  div_c_t = div_c_t +'</ul>'


                  if (Response["campos_cab"][x]["TablaCampo"] == "cmptxtsimple"){
                    readonly_int = ''
                    if (Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Modificable"] == "N"){readonly_int = 'readonly="readonly"'
                    }
                    if (tipo == 'Nuevo'){
                      valor_campo = Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["ValorPredeterminado"]
                    }
                      if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Largo"] > 100){
                         div_c_t = div_c_t + '<textarea type="text" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' '+ readonly_int +' onchange="guardar_calcular('+ ID_TAG +', 0 )" style="font-size: 11px;">'+ valor_campo +'</textarea>'
                      }else{
                          div_c_t = div_c_t + '<input type="text" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' '+ readonly_int +' onchange="guardar_calcular('+ ID_TAG +', 0 )" style="height: 25px;font-size: 11px;">'
                      }
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpnumsimple"){

                      div_c_t = div_c_t + '<input type="number" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' min="'+ Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Menor"] +'" max="'+ Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Mayor"] +'" onchange="guardar_calcular('+ ID_TAG +', 0 )" style="text-align: right;height: 25px;font-size: 11px;">'                    
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpnumsecuencial"){

                    div_c_t = div_c_t + '<input type="number" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" readonly="readonly" style="text-align: right;height: 25px;font-size: 11px;">'
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpopcmultiple"){
                    if (tipo != 'consulta'){
                      div_c_t = div_c_t + '<select class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" id="'+ ID_TAG + '" value="'+ valor_campo +'" onchange="guardar_calcular('+ ID_TAG +' , 0)" style="height: 25px;font-size: 11px;">'

                      for (z = 0; z < Response["func_cab"][Response["campos_cab"][x]["Nombre"]].length; z++) { 

                        if(valor_campo == Response["func_cab"][Response["campos_cab"][x]["Nombre"]][z]["Valor"] )
                          {
                              div_c_t = div_c_t + '<option selected>' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][z]["Valor"] + '</option>'
                          }else{
                              div_c_t = div_c_t + '<option>' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][z]["Valor"] + '</option>'
                          }
                      }
                      div_c_t = div_c_t + '</select>'                        
                    }else{
                      div_c_t = div_c_t + '<input type="text" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' onchange="guardar_calcular('+ ID_TAG +', 0 )" style="height: 25px;font-size: 11px;">'
                    }
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpsistema"){
                    if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Nombre"] == 'Usuario Actual'){
                      div_c_t = div_c_t + '<input type="text" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" readonly="readonly" style="height: 25px;font-size: 11px;">'
                    }

                    if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Nombre"] == 'Fecha Actual'){
                      div_c_t = div_c_t + '<input type="datetime-local" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" readonly="readonly" style="height: 25px;font-size: 11px;">'
                    }
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpformuladetalle"){

                    div_c_t = div_c_t + '<input type="text" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" readonly="readonly" onchange="guardar_calcular('+ ID_TAG +' , 0 )" style="text-align: right;height: 25px;font-size: 11px;">'
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpfecha"){
                    tipodato = 'date'
                 
                    if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Tiempo"] == 'Y'){
                            tipodato = 'datetime-local'}
                    div_c_t = div_c_t + '<input type="' + tipodato + '" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' onchange="guardar_calcular('+ ID_TAG +', 0 )" style="height: 25px;font-size: 11px;">'
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpreferencia"){
                    div_c_t = div_c_t + '<div class="col 3">'
                    


                    if (tipo != 'consulta'){
                      div_c_t = div_c_t + '<input type="text" id="'+ ID_TAG + '" class="form-control col-sm-' + (Response["campos_cab"][x]["largoweb"]-1) + '" value="'+ valor_campo +'" '+ readonly +' onchange="guardar_calcular('+ ID_TAG +', 0 )" style="width: 70%;height: 25px;font-size: 11px;" onkeypress="return runScript(event, '+ ID_TAG +')" >'
                      div_c_t = div_c_t + '<button type="button" class="btn btn-primary" data-toggle="modal" data-target=".bs-example-modal-lg" onclick="buscar_referencia_cabecera('+ ID_TAG +' )"style="height: 25px;padding: 3px 4px;"><span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span></button>'
                    }else{
                      div_c_t = div_c_t + '<input type="text" id="'+ ID_TAG + '" class="form-control col-sm-' + (Response["campos_cab"][x]["largoweb"]-1) + '" value="'+ valor_campo +'" '+ readonly +' onchange="guardar_calcular('+ ID_TAG +', 0 )" style="height: 25px;font-size: 11px;" onkeypress="return runScript(event, '+ ID_TAG +')" >'
                    }
                    
                    div_c_t = div_c_t + '</div>'
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpreferenciaadjunto"){

                    if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Tipo"] == 'Imagen'){
                      div_c_t = div_c_t + '<input type="text" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +'  onchange="guardar_calcular('+ ID_TAG +', 0 )" style="height: 25px;font-size: 11px;">'

                    }
                    else{
                        Moddato = ''
                        if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Modificable"] == 'N'){
                            Moddato = 'readonly="readonly"'}
                        if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Tipo"] == 'Texto'){

                          div_c_t = div_c_t + '<input type="text" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' ' + Moddato + ' onchange="guardar_calcular('+ ID_TAG +', 0 )" style="height: 25px;font-size: 11px;">'
                        }
                        if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Tipo"] == 'Numero'){
                            div_c_t = div_c_t + '<input type="number" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' ' + Moddato + ' onchange="guardar_calcular('+ ID_TAG +', 0 )" style="text-align: right;" style="height: 25px;font-size: 11px;">'

                        }
                        if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Tipo"] == 'Fecha'){
                     
                            div_c_t = div_c_t + '<input type="date" id="'+ ID_TAG + '"class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' ' + Moddato + ' onchange="guardar_calcular('+ ID_TAG +', 0 )" style="height: 25px;font-size: 11px;">'
                          }
                        if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Tipo"] == 'Fecha Tiempo'){
                      
                            div_c_t = div_c_t + '<input type="datetime-local" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' ' + Moddato + ' onchange="guardar_calcular('+ ID_TAG +', 0 )" style="height: 25px;font-size: 11px;">'
                          }

                         
                    }
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpoperacion"){

                    div_c_t = div_c_t + '<input type="text" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' onchange="setTwoNumberDecimal('+ Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Decimales"] +')" readonly="readonly" onchange="guardar_calcular('+ ID_TAG +', 0 )" style="text-align: right;height: 25px;font-size: 11px;" >'
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpconsolidado"){
              
                    div_c_t = div_c_t + '<input type="text" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' readonly="readonly" onchange="guardar_calcular('+ ID_TAG +', 0)" style="height: 25px;font-size: 11px;">'
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmparchivo"){

                   div_c_t = div_c_t + '<input type="file" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' style="height: 25px;font-size: 11px;">'
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpnumeroaletras"){
             
                   div_c_t = div_c_t + '<input type="text" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' readonly="readonly" style="height: 25px;font-size: 11px;">'
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpdecabecera"){

                    div_c_t = div_c_t + '<input type="text" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' readonly="readonly" style="height: 25px;font-size: 11px;">'
                  }
                  if (Response["campos_cab"][x]["TablaCampo"] == "cmpelectronico"){

                    div_c_t = div_c_t + '<input type="text" id="'+ ID_TAG + '" class="form-control col-sm-' + Response["campos_cab"][x]["largoweb"] + '" value="'+ valor_campo +'" '+ readonly +' readonly="readonly" style="height: 25px;font-size: 11px;">'
                  }
                  div_c_t = div_c_t + '</div>'
           

                  if (Response["campos_cab"][x]["posicionweb"] == "arriba_izq") {
                    div_campos_arriba_izq = div_campos_arriba_izq + div_c_t
                  }
                  if (Response["campos_cab"][x]["posicionweb"] == "arriba_der") {
                    div_campos_arriba_der = div_campos_arriba_der + div_c_t
                  }
                  if (Response["campos_cab"][x]["posicionweb"] == "abajo_izq") {
                    div_campos_abajo_izq = div_campos_abajo_izq + div_c_t
                  }
                  if (Response["campos_cab"][x]["posicionweb"] == "abajo_der") {
                    div_campos_abajo_der = div_campos_abajo_der + div_c_t
                  }


              }else{ 
                  div_c_inv = '<div id="div'+ ID_TAG + '" class="col-sm-' + Response["campos_cab"][x]["largoweb"] + '">'

                  div_c_inv = div_c_inv + '<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">'

                  div_c_inv = div_c_inv + '<label class="control-label for="' + Response["campos_cab"][x]["Nombre"] + '" style="font-size: 11px;" >' + Response["campos_cab"][x]["Descripcion"] + '</label></a>'
                  div_c_inv = div_c_inv + '<ul class="dropdown-menu" role="menu" style="text-align: center;">'
                  div_c_inv = div_c_inv + '<li><i onclick="mod_campo_invisible(' + Response["campos_cab"][x]["PkId"] + ',0, '+pestalla+')" class="fa fa-ban" style="cursor: pointer;"></i></li></ul>'
                  div_c_inv = div_c_inv + '<input type="text" id="'+ ID_TAG + '" value="'+ valor_campo +'" '+ readonly +'></div>'
                div_c_inv_tt = div_c_inv_tt +div_c_inv



              }
            }
            div_campos = div_campos + '<div class="col-md-6 col-xs-12"> <div class="row">'+ div_campos_arriba_izq + '</div></div>'
            div_campos = div_campos + '<div class="col-md-6 col-xs-12"> <div class="row">'+ div_campos_arriba_der + '</div></div>'
            
            
            $('#rr' + pestalla).append(div_campos);

            document.getElementById('id'+ pestalla).click();




            if(typeof(Response["campos_det"]) == "object"){
                    var largo_tabla= 0
                    for (x = 0; x < Response["campos_det"].length; x++) {
                      if (Response["campos_det"][x]["Visible"] == "Y") {
                        largo_tabla = largo_tabla + parseFloat(Response["campos_det"][x]["largo"])
                        
                      }
                    }

                if (tipo == 'consulta'){ 
                    div_campos = '<div style="overflow: auto;"><table id="tabla' + Response["pestalla"] + '" class="table table-striped" style="width: ' + parseInt(largo_tabla) +   'px;overflow-x:auto;font-size: 11px;"><thead><tr>'
                  }else{
                    div_campos = '<div style="overflow: auto;" ><table id="tabla' + Response["pestalla"] + '" class="table table-striped" style="width: ' + parseInt(largo_tabla) +   'px;overflow-x:auto;font-size: 11px;"><thead><tr><th style="width: 10px;"></th>'
                }
                 

                for (x = 0; x < Response["campos_det"].length; x++) { 
                  if (Response["campos_det"][x]["Visible"] == "Y") {
                    //div_campos = div_campos + '<th class="col-md-' + Response["campos_det"][x]["largoweb"] + '" style="width: ' + Response["campos_det"][x]["largo"] + 'px;">' + Response["campos_det"][x]["Descripcion"] + '</th>'
                    div_campos = div_campos + '<th class="col-md-' + Response["campos_det"][x]["largoweb"] + '" style="padding-left: 0px;padding-right: 0px;">' + Response["campos_det"][x]["Descripcion"] + '</th>'
                  } 
                }
                div_campos = div_campos +'</tr></thead><tbody>'
                var i = 0;
                do {
                    if (tipo == 'consulta'){ 
                        div_campos = div_campos + '<tr id="f' + Response["pestalla"] + '-f'+ i +'">'     
                    }else{
                        div_campos = div_campos + '<tr id="f' + Response["pestalla"] + '-f'+ i +'"><td><div class="row"  style="padding-left: 10px;">'
                        div_campos = div_campos + '<button type="button" onclick="mas(' + Response["pestalla"]+')" class="btn btn-success" style="padding: 3px 4px;">+</button>'
                        div_campos = div_campos + '<button type="button" onclick="menos(' + Response["pestalla"]+',' + i + ', 0)" class="btn btn-danger" style="padding: 3px 6px;">-</button></div></td>'
                    }


                    for (x = 0; x < Response["campos_det"].length; x++) {

                        valor_campo = 0;
                        if (tipo == 'Nuevo'){
                            
                          if (Response["campos_det"][x]["TablaCampo"] == "cmptxtsimple"){
                            valor_campo = Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["ValorPredeterminado"]
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpnumsimple"){
                            valor_campo = Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Menor"]
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpnumsecuencial"){
                            if (Response["campos_det"][x]["TablaCampo"].slice(0,2) == "Pk"){
                              valor_campo = 0
                            }else{
                              valor_campo = Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["ValorInicial"]
                            }
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpopcmultiple"){
                              valor_campo = Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Valor"]
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpsistema"){
                            if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Nombre"] == 'Usuario Actual'){
                              valor_campo = "{{usuario}}"

                            }
                            if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Nombre"] == 'Fecha Actual'){
                              var now = new Date();
                              valor_campo = now.format("Y-m-d") + 'T' +  now.format("h:m:s")
                            }
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpformuladetalle"){
                             valor_campo = 0
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpfecha"){
                            var now = new Date();
                            addi = ' AM'
                            if (Response["func_det"][Response["campos_det"][x]["Nombre"]][0][0]["Tiempo"] == "Y"){
                               if(now.format("H") > 11){addi = ' PM' }
                              valor_campo = now + addi
                            }else{
                              valor_campo = now.format("Y-m-d");
                            }
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpreferencia"){
                            valor_campo = Response["func_det"][Response["campos_det"][x]["Nombre"]][0][0]["predeterminado_valor"]
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpreferenciaadjunto"){
                            valor_campo = 0
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpoperacion"){
                            valor_campo = 0
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpconsolidado"){
                            valor_campo = 0
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpdecabecera"){
                            valor_campo = ""
                          }
                          }else{
                            valor_campo = Response["valores_det"][i][Response["campos_det"][x]["Nombre"]] 
                        }
                        
                        id_tag_detalle = 'pd' + Response["pestalla"] +  'fff'+ i + 'ccc'+ Response["campos_det"][x]["Nombre"]

                        if (Response["campos_det"][x]["Visible"] == "Y") {
                          //div_campos = div_campos + '<td><div class="col-sm-' + Response["campos_det"][x]["largoweb"] + '" col-md-' + Response["campos_det"][x]["largoweb"] + '" col-lg-' + Response["campos_det"][x]["largoweb"] + '">'
                          div_campos = div_campos + '<td style="padding-left: 0px;padding-right: 0px;"><div style="width: ' + Response["campos_det"][x]["largo"] + 'px;">'

                          if (Response["campos_det"][x]["TablaCampo"] == "cmptxtsimple"){
                              readonly_int = ''

                              if (Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Modificable"] == "N"){
                                readonly_int = 'readonly="readonly"'
                              }
                              if (tipo == 'Nuevo'){
                                valor_campo = Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["ValorPredeterminado"]
                              }
                              if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Largo"] > 100){
                                 div_campos = div_campos + '<textarea type="text" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' onchange="guardar_calcular_det('+ id_tag_detalle +')" ' + readonly_int + ' style="font-size: 11px;">'+ valor_campo +'</textarea>'
                              }else{
                               div_campos = div_campos + '<input type="text" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' onchange="guardar_calcular_det('+ id_tag_detalle +')" '+ readonly_int + ' style="height: 25px;font-size: 11px;">'
                              }
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpnumsimple"){

                              div_campos = div_campos + '<input type="number" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' onchange="guardar_calcular_det('+ id_tag_detalle +')" min="'+ Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Menor"] +'" max="'+ Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Mayor"] +'" style="text-align: right;height: 25px;font-size: 11px;">'
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpnumsecuencial"){

                            div_campos = div_campos + '<input type="number" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" readonly="readonly" onchange="guardar_calcular_det('+ id_tag_detalle +')" style="text-align: right; height: 25px; font-size: 11px;">'
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpopcmultiple"){
                            if (tipo != 'consulta'){
                              div_campos = div_campos + '<select class="form-control" id="'+id_tag_detalle +'" value="'+ valor_campo +'" onchange="guardar_calcular_det('+ id_tag_detalle +')" style="height: 25px;font-size: 11px;">'
                              for (z = 0; z < Response["func_det"][Response["campos_det"][x]["Nombre"]].length; z++) { 
                                if(valor_campo == Response["func_det"][Response["campos_det"][x]["Nombre"]][z]["Valor"] )
                                  {
                                      div_campos = div_campos + '<option selected>' + Response["func_det"][Response["campos_det"][x]["Nombre"]][z]["Valor"] + '</option>'
                                  }else{
                                      div_campos = div_campos + '<option>' + Response["func_det"][Response["campos_det"][x]["Nombre"]][z]["Valor"] + '</option>'
                                  }
                              }
                              div_campos = div_campos + '</select>'
                            }else{
                              div_campos = div_campos + '<input type="text" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' onchange="guardar_calcular_det('+ id_tag_detalle +')" style="height: 25px;font-size: 11px;" >'
                            }
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpsistema"){
                            if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Nombre"] == 'Usuario Actual'){
                              div_campos = div_campos + '<input type="text" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" readonly="readonly" style="height: 25px;font-size: 11px;">'
                            }
                            if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["NumDecimales"] == 'Fecha Actual'){
                              div_campos = div_campos + '<input type="datetime-local" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" readonly="readonly" onchange="guardar_calcular_det('+ id_tag_detalle +')" style="height: 25px;font-size: 11px;">'
                            }
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpformuladetalle"){

                            div_campos = div_campos + '<input type="text" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" readonly="readonly" onchange="guardar_calcular_det('+ id_tag_detalle +')" style="height: 25px;font-size: 11px;">'
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpfecha"){
                            tipodato = 'date'
                            if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Tiempo"] == 'Y'){
                                    tipodato = 'datetime-local'}
                            div_campos = div_campos + '<input type="' + tipodato + '" id="'+id_tag_detalle +'"  class="form-control" value="'+ valor_campo +'" '+ readonly +' onchange="guardar_calcular_det('+ id_tag_detalle +')" style="height: 25px;font-size: 11px;">'
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpreferencia"){
                            
                            if (tipo == 'consulta'){ 
                              div_campos = div_campos + '<div class="input-group"><input type="text" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' onchange="guardar_calcular_det('+ id_tag_detalle +')" style="height: 25px;font-size: 11px;" onkeypress="return runScript_detalle(event, '+ id_tag_detalle +')">'
                              div_campos = div_campos + '</div>'
                            }else{

                              div_campos = div_campos + '<div class="input-group"><input type="text" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' onchange="guardar_calcular_det('+ id_tag_detalle +')" style="width: 70%;height: 25px;font-size: 11px;" onkeypress="return runScript_detalle(event, '+ id_tag_detalle +')">'
                              div_campos = div_campos + '<button type="button" class="btn btn-primary" data-toggle="modal" data-target=".bs-example-modal-lg" onclick="buscar_referencia_detalle('+ id_tag_detalle +' )" style="height: 25px;padding: 3px 4px;"><span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></button></div>'
                             }
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpreferenciaadjunto"){
                            if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Tipo"] == 'Imagen'){

                              div_campos = div_campos + '<div class="thumbnail" style="height: 100px;margin-bottom: 1px;"><div class="image view view-first"><img style="width: 80%;height: 60%; display: block;" id="'+id_tag_detalle +'_img" src="/static/archivos/{{Id_empresa}}/'+ valor_campo +'" alt="image" value="'+ valor_campo +'"><a id="'+id_tag_detalle +'_label" href="/static/archivos/{{Id_empresa}}/'+ valor_campo +'" target="_blank">'+ valor_campo +'</a></div></div>'

                            }else{
                                Moddato = ''
                                if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Modificable"] == 'N'){
                                    Moddato = 'readonly="readonly"'}
                                if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Tipo"] == 'Texto'){
                                  if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Tamano"] == 'G'){
                                    div_campos = div_campos + '<textarea type="text" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' ' + Moddato + ' onchange="guardar_calcular_det('+ id_tag_detalle +')" style="font-size: 11px;">'+ valor_campo +'</textarea>'
                                  }else{
                                    div_campos = div_campos + '<input type="text" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' ' + Moddato + ' onchange="guardar_calcular_det('+ id_tag_detalle +')" style="height: 25px;font-size: 11px;">'
                                  }
                                  
                                }
                                if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Tipo"] == 'Numero'){

                                    div_campos = div_campos + '<input type="number" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' ' + Moddato + ' onchange="guardar_calcular_det('+ id_tag_detalle +')" style="text-align: right;height: 25px;font-size: 11px;">'
                                }
                                if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Tipo"] == 'Fecha'){

                                    div_campos = div_campos + '<input type="date" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' ' + Moddato + ' onchange="guardar_calcular_det('+ id_tag_detalle +')" style="height: 25px;font-size: 11px;">'
                                  }
                                if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Tipo"] == 'Fecha Tiempo'){

                                    div_campos = div_campos + '<input type="datetime-local" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' ' + Moddato + ' onchange="guardar_calcular_det('+ id_tag_detalle +')" style="height: 25px;font-size: 11px;">'
                                  }
                            }
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpoperacion"){

                            div_campos = div_campos + '<input type="text" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' onchange="setTwoNumberDecimal('+ Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Decimales"] +')" readonly="readonly" style="text-align: right;height: 25px;font-size: 11px;"> '
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpconsolidado"){
                      
                            div_campos = div_campos + '<input type="text" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' readonly="readonly" style="height: 25px;font-size: 11px;">'
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmparchivo"){

                           div_campos = div_campos + '<input type="file" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' style="height: 25px;font-size: 11px;">'
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpnumeroaletras"){
                     
                           div_campos = div_campos + '<input type="text" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' readonly="readonly" style="height: 25px;font-size: 11px;">'
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpdecabecera"){

                            div_campos = div_campos + '<input type="text" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' readonly="readonly" style="height: 25px;font-size: 11px;">'
                          }
                          if (Response["campos_det"][x]["TablaCampo"] == "cmpelectronico"){

                            div_campos = div_campos + '<input type="text" id="'+id_tag_detalle +'" class="form-control" value="'+ valor_campo +'" '+ readonly +' readonly="readonly" style="height: 25px;font-size: 11px;">'
                          }

                          div_campos = div_campos + '</div></td>'

                        } else {
                          div_campos = div_campos + '<input type="hidden" id="'+id_tag_detalle +'" value="' +valor_campo+ '" '+ readonly +'>'
                        } 
                    }

                    div_campos = div_campos + '</tr>'
                    i++;
                }while (i < Response["valores_det"].length);
            
              cc_porPesta['p-'+pestalla] = (Response["valores_det"].length )
              div_campos = div_campos + '</tbody></table></div>'
                           

              $('#rr' + pestalla).append(div_campos);

              $('#rr' + pestalla).append('<div class="col-md-6 col-xs-12"> <div class="row">'+ div_campos_abajo_izq + '</div></div>');
              $('#rr' + pestalla).append('<div class="col-md-6 col-xs-12"> <div class="row">'+ div_campos_abajo_der + '</div></div>');
               $('#rr' + pestalla).append('Campos invisibles <br><div class="row">'+ div_c_inv_tt + '</div>');

              document.getElementById('id'+ pestalla).click();
            }

            
            
            
            for (z2 = 0; z2 < Response["campos_cab"].length; z2++) { 
              if (tipo == 'Nuevo'){
                if(Response["campos_cab"][z2]["TablaCampo"] == "cmpreferencia"){
                  if(Response["func_cab"][Response["campos_cab"][z2]["Nombre"]][0][0]["predeterminado_valor"] != ''){
                    id_tag = 'p' + pestalla + 'zzz' + Response["campos_cab"][z2]["Nombre"]

                    if(Response["func_cab"][Response["campos_cab"][z2]["Nombre"]][0][0]["Tipo_Predeterminado"] == '1'){
                    id_tag_detalle_pret = 'p' + pestalla + 'zzz' + Response["func_cab"][Response["campos_cab"][z2]["Nombre"]][0][0]["predeterminado"] 
                      document.getElementById(id_tag).value = document.getElementById(id_tag_detalle_pret).value
                    }
                    buscar_referencia_cabecera_enter(document.getElementById(id_tag))
                  }
                }
              }
            }
             
            for (z2 = 0; z2 < Response["campos_det"].length; z2++) { 
              if (tipo == 'Nuevo'){
                if(Response["campos_det"][z2]["TablaCampo"] == "cmpreferencia"){
                  if(Response["func_det"][Response["campos_det"][z2]["Nombre"]][0][0]["predeterminado_valor"] != ''){
                    id_tag_detalle = 'pd' + Response["pestalla"] +  'fff'+ 0 + 'ccc'+ Response["campos_det"][z2]["Nombre"]
                    if(Response["func_det"][Response["campos_det"][z2]["Nombre"]][0][0]["Tipo_Predeterminado"] == '1'){
                      id_tag_detalle_pret = 'pd' + Response["pestalla"] +  'fff'+ 0 + 'ccc'+ Response["func_det"][Response["campos_det"][z2]["Nombre"]][0][0]["predeterminado"]
                      document.getElementById(id_tag_detalle).value = document.getElementById(id_tag_detalle_pret).value
                    }
                      buscar_referencia_detalle_enter(document.getElementById(id_tag_detalle))
                  }
                }
              }
            }

          }
        });     
}

$(document).ready(function(){


  $(".opciones_list").click(function(e){
  window.open("log/opciones/Ingresar/"+$(this).attr("id") +"/", '_blank');
      });
  $(".dropdown-item").click(function(e){


        //  $("#id"+ $(this).attr("id")).remove();
        //  $("#rr"+ $(this).attr("id")).empty();
          pestalla = pestalla +1;


          $("#myTab").prepend('<li role="presentation" class="" id="li' + pestalla + '"><a href="#rr' + pestalla + '" id="id' + pestalla + '" role="tab" data-toggle="tab" aria-expanded="false">' + $(this).attr("result") + '</a></li>');

          if( $(this).attr("value") == "registro"){
          $.ajax({
            type: 'POST',
            url: '/menu_click',
            data: {'fuente': $(this).attr("value"), 'csrfmiddlewaretoken': '{{ csrf_token }}', 'Id_empresa':'{{Id_empresa}}','pk': $(this).attr("id"), 'usuario':'{{usuario}}', 'idioma':'{{ idioma }}', 'pestalla':pestalla},
            beforeSend: function () {
              $("#myTabContent").prepend('<div role="tabpanel" class="tab-pane fade" id="rr' + pestalla + '" aria-labelledby="id' + pestalla + '"> <div style="padding-top: 50px;">Procesando </div></div>');
                  },
            success: function(Response){

              dict_pestalla['p-'+Response["pestalla"]] = Response


              div_opcio = '<div><button type="button" onclick="cerrar_elemento(' + Response["pestalla"] +')" class="btn btn-warning">{{idioma_html.cerrar}}</span></button></div></div>'

              div_opcio = div_opcio + '<div class="col-md-55"><div class=""><div class="image view view-first"><img style="height: 150px;width: 100%; display: block;" src="/static/img/hojas.png" alt="image"></div><div class="caption" style="height: 100px;"><p><strong>{{idioma_html.estilo}}</strong></p><p>{{idioma_html.estilo_des}}</p></div><button class="btn btn-primary" onclick="modificar_estilo(' + Response["tabla"][0]["PkModulo"] +',0,0,' + Response["pestalla"] +')" style="width: 100%;"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></button></div></div>'

              div_opcio = div_opcio + '<div class="col-md-55"><div class=""><div class="image view view-first"><img style="height: 150px;width: 100%; display: block;" src="/static/img/arquitec2.png" alt="image"></div><div class="caption" style="height: 100px;"><p><strong>{{idioma_html.campo}}</strong></p><p>{{idioma_html.campo_des}}</p></div><button class="btn btn-primary" onclick="algo()" style="width: 100%;"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></button></div></div>'

              div_opcio = div_opcio + '<div class="col-md-55"><div class=""><div class="image view view-first"><img style="height: 150px;width: 100%; display: block;" src="/static/img/hojas.png" alt="image"></div><div class="caption" style="height: 100px;"><p><strong>{{idioma_html.acciones}}</strong></p><p>{{idioma_html.acciones_des}}</p></div><button class="btn btn-primary" onclick="algo()" style="width: 100%;"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></button></div></div>'

              div_opcio = div_opcio + '<div class="col-md-55"><div class=""><div class="image view view-first"><img style="height: 150px;width: 100%; display: block;" src="/static/img/hojas.png" alt="image"></div><div class="caption" style="height: 100px;"><p><strong>{{idioma_html.pdf}}</strong></p><p>{{idioma_html.pdf_des}}</p></div><button class="btn btn-primary" onclick="algo()" style="width: 100%;"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></button></div></div>'

              div_opcio = div_opcio + '<div class="col-md-55"><div class=""><div class="image view view-first"><img style="height: 150px;width: 100%; display: block;" src="/static/img/hojas.png" alt="image"></div><div class="caption" style="height: 100px;"><p><strong>{{idioma_html.valida}}</strong></p><p>{{idioma_html.valida_des}}</p></div><button class="btn btn-primary" onclick="algo()" style="width: 100%;"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></button></div></div>'
              div_opcio = div_opcio + '<div class="col-md-55"><div class=""><div class="image view view-first"><img style="height: 150px;width: 100%; display: block;" src="/static/img/hojas.png" alt="image"></div><div class="caption" style="height: 100px;"><p><strong>{{idioma_html.importa}}</strong></p><p>{{idioma_html.importa_des}}</p></div><button class="btn btn-primary" onclick="algo()" style="width: 100%;"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></button></div></div>'

             
             
              
           
              $('#rr' + Response["pestalla"]).html(div_opcio);

              document.getElementById('id'+ Response["pestalla"]).click();


              }
            });
          }
          if( $(this).attr("value") == "reporte"){
            $.ajax({
            type: 'POST',
            url: '/menu_reporte',
            data: {'fuente': $(this).attr("value"), 'csrfmiddlewaretoken': '{{ csrf_token }}', 'Id_empresa':'{{Id_empresa}}','pkrepo': $(this).attr("id"), 'nombre_rep':$(this).attr("result"), 'usuario':'{{usuario}}', 'idioma':'{{ idioma }}', 'pestalla':pestalla},
            beforeSend: function () {
              $("#myTabContent").prepend('<div role="tabpanel" class="tab-pane fade" id="rr' + pestalla + '" aria-labelledby="id' + pestalla + '"> <div style="padding-top: 50px;"> Procesando </div></div>');
                  },
            success: function(Response){

              id_dic = 'p-' + pestalla
              dict_pestalla[id_dic] = Response

              data_int =  '<div class="panel-body" style="padding-top: 50px;">'
              data_int = data_int + '<button class="btn btn-primary" id="reporteejecutar" name="reporteejecutar" type="submit" value="' + Response['pkrepo'] + '" onclick="reporte_ejecutar('+ Response["pestalla"] +',0, '+ Response["pkrepo"] +')">{{idioma_html.ejecutar}}</button>' 
              data_int = data_int + '<button type="button" onclick="cerrar_elemento('+ Response["pestalla"] +')" class="btn btn-warning"><span class="glyphicon glyphicon-remove-sign" aria-hidden="true"></span></button>'
              data_int = data_int + '<div class="card-block text-left"><table class="table table-hover"><thead><tr><th></th><th></th><th></th></tr></thead><tbody>'

              for (x = 0; x < Response['variables_reprotes'].length; x++) {
                //data_int = data_int + '<br>'

                if(Response['variables_reprotes'][x]["tipo"] == "Texto"){
                    data_int = data_int + '<tr><td><strong>'+Response['variables_reprotes'][x]["glosa"] +':</td>'
                    data_int = data_int + '<td> <input type="text" id="var-'+ Response["pestalla"] +'-'+ Response['variables_reprotes'][x]["id"] +'" name="'+ Response['variables_reprotes'][x]["id_rep"] +'" value="%"></td>'
                    data_int = data_int + '<td></td></tr>'
                }else
                {
                  if(Response['variables_reprotes'][x]["tipo"] == "Valor"){
                      data_int = data_int + '<tr><td><strong>'+Response['variables_reprotes'][x]["glosa"] +':</td>'
                      data_int = data_int + '<td> <input type="text" id="var-'+ Response["pestalla"] +'-'+ Response['variables_reprotes'][x]["id"] +'" name="'+ Response['variables_reprotes'][x]["id_rep"] +'" value="0"></td>'
                      data_int = data_int + '<td></td></tr>'
                  }else{
                    data_int = data_int + '<tr><td><strong>'+Response['variables_reprotes'][x]["glosa"] +':</td>'
                    data_int = data_int + '<td> <input type="date" id="var-'+ Response["pestalla"] +'-'+ Response['variables_reprotes'][x]["id"] +'" name="'+ Response['variables_reprotes'][x]["id_rep"] +'" value="'+ Response['variables_reprotes'][x]["valor"] +'"></td>'
                    data_int = data_int + '<td></td></tr>'
                  }
                }
              }
              for (x = 0; x < Response['referencias_reprotes'].length; x++) {
                data_int = data_int + '<tr><td><strong>'+Response['referencias_reprotes'][x]["glosa"] +':</td>'
                data_int = data_int + '<td> <input type="text" id="rpzz'+ Response["pestalla"] +'zz'+ x +'zz'+Response['referencias_reprotes'][x]["id"] +'" name="'+Response['referencias_reprotes'][x]["id"] +'" value="%"></td>'
                data_int = data_int + '<td><button type="button" class="btn btn-primary" data-toggle="modal" data-target=".bs-example-modal-lg" onclick="buscar_referencia_reporte(rpzz'+ Response["pestalla"] +'zz'+ x +'zz'+Response['referencias_reprotes'][x]["id"]+')"><span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span></button></td></tr>'


              }
              data_int = data_int + '</tbody></table></div>  '
              $('#rr' + Response["pestalla"]).html(data_int);
              }
            });
          }

          });
      });

  $(window).load(function() {
   // executes when complete page is fully loaded, including all frames, objects and images
       

          $.ajax({
            type: 'POST',
            url: '/cargar_paneles',
            data: {'csrfmiddlewaretoken': '{{ csrf_token }}', 'Id_empresa':'{{Id_empresa}}', 'usuario':'{{usuario}}', 'idioma':'{{ idioma }}'},
            beforeSend: function () {
                             },
            success: function(Response){


              for (x = 0; x < Response["paneles"].length; x++) {
                pestalla = pestalla +1;

                $("#myTab").prepend('<li role="presentation" class="" id="li' + pestalla + '"><a href="#rr' + pestalla + '" id="id' + pestalla + '" role="tab" data-toggle="tab" aria-expanded="false">' + Response["paneles"][x]["nombre"] + '</a></li>');

                $("#myTabContent").prepend('<div role="tabpanel" class="tab-pane fade" id="rr' + pestalla + '" aria-labelledby="id' + pestalla + '"> Procesando </div>');

                new_tap ='<div class="row" style="padding-top: 50px;">'


                new_tap = new_tap + '<div class="col-md-12"><button class="btn btn-primary" onclick="nuevonota(' + pestalla + ')">{{idioma_html.nuevo}}</button><button type="button" onclick="cerrar_panel(' + pestalla + ')" class="btn btn-warning">{{idioma_html.cerrar}}</button></div>'

                for (x2 = 0; x2 < Response["estados"][Response["paneles"][x]["pkpanel"]].length; x2++) {
                  new_tap = new_tap + '<div class="col-md-3">'
                  new_tap = new_tap + '<div class="x_panel">'

                  new_tap = new_tap + '<div class="x_title">'
                  new_tap = new_tap + ' <h2>' +Response["estados"][Response["paneles"][x]["pkpanel"]][x2]["nombre"]+  '</h2>'
                  new_tap = new_tap + ' <div class="clearfix"></div></div>'

                  new_tap = new_tap + ' <div class="x_content">'
                  new_tap = new_tap + '   <div class="dashboard-widget-content">'
                  new_tap = new_tap + '     <ul class="list-unstyled timeline widget" id="ul_estadopk' +Response["estados"][Response["paneles"][x]["pkpanel"]][x2]["pkestado"]+  '">'

                  for (x3 = 0; x3 < Response["notas"][Response["estados"][Response["paneles"][x]["pkpanel"]][x2]["pkestado"]].length; x3++) {

                    new_tap = new_tap + '       <li id="li_notapk'+Response["notas"][Response["estados"][Response["paneles"][x]["pkpanel"]][x2]["pkestado"]][x3]["pknota"]+'">'
                    //new_tap = new_tap + '<ul class="nav navbar-right panel_toolbox">   <div><a style="padding-right: 10px;padding-left: 10px;"><i class="fa fa-mail-forward"></i></a><a onclick="abrir_nota('+Response["notas"][Response["estados"][Response["paneles"][x]["pkpanel"]][x2]["pkestado"]][x3]["pknota"]+')"><i class="fa fa-comment"></i></a></div> </ul>'

                   

                   



                    new_tap = new_tap + '         <div class="block">'
                    new_tap = new_tap + '           <div class="block_content">'



                    new_tap = new_tap + '             <h2 class="title"><a>'+Response["notas"][Response["estados"][Response["paneles"][x]["pkpanel"]][x2]["pkestado"]][x3]["titulo"]+'</a></h2>'
                    new_tap = new_tap + '             <div class="byline"><p>'+Response["notas"][Response["estados"][Response["paneles"][x]["pkpanel"]][x2]["pkestado"]][x3]["fecha_inicio"]+' ' +Response["notas"][Response["estados"][Response["paneles"][x]["pkpanel"]][x2]["pkestado"]][x3]["fecha_fin"]+ ' '+Response["notas"][Response["estados"][Response["paneles"][x]["pkpanel"]][x2]["pkestado"]][x3]["responable"]+'</span></div>'
                    new_tap = new_tap + '             <p class="excerpt">'+Response["notas"][Response["estados"][Response["paneles"][x]["pkpanel"]][x2]["pkestado"]][x3]["descripcion"]+'</p>'

                     new_tap = new_tap + '<div style="text-align: right;">'
                    
                    new_tap = new_tap + '<button type="button" class="btn btn-primary" data-toggle="modal" data-target=".bs-example-modal-sm" onclick="abrir_nota('+Response["notas"][Response["estados"][Response["paneles"][x]["pkpanel"]][x2]["pkestado"]][x3]["pknota"]+' )"><span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span></button>'
                    new_tap = new_tap + '</div>'


                    new_tap = new_tap + '           </div>'
                    new_tap = new_tap + '         </div>'
                    new_tap = new_tap + '       </li>'
                    }



                  new_tap = new_tap + '     </ul>'
                  new_tap = new_tap + '   </div>'
                  new_tap = new_tap + ' </div>'
                  new_tap = new_tap + '</div></div>'
                }

                new_tap =new_tap + '</div>'

                $('#rr' + pestalla).html(new_tap);
              }

              }
          });
          


          $.ajax({
            type: 'POST',
            url: '/cargar_charts',
            data: {'csrfmiddlewaretoken': '{{ csrf_token }}', 'Id_empresa':'{{Id_empresa}}', 'usuario':'{{usuario}}', 'idioma':'{{ idioma }}'},
            beforeSend: function () {},
            success: function(Response){
              carga_charts(Response)
              //test_echarts()

              


        
            }
          });
  });

var colorNames = Object.keys(window.chartColors);

function runScript_modi_fast(e, campo) {
    //See notes about 'which' and 'key'
    if (e.keyCode == 13) {
        modi_fast(campo)
    }else{
          var campo_int = document.getElementById(campo.id)
          campo_int.style.backgroundColor = "white"
    }
}

function modi_fast(campo){


  var cc_id = campo.id
  var res = cc_id.split("zzz");
  var res2 = res[1].split("jjj");


  var cc_pesta = res[0].substring(2);
  var cc_nombre  = res2[0]
  var cc_pk  = res2[1]

  var cc_tabla = dict_pestalla["p-" + cc_pesta]["tabla"][0]["Nombre"]
  var cc_valor =  campo.value
 
        $.ajax({
          type: 'POST',
          url: '/modi_fast',
          data: {'fuente': $(this).attr("value"), 'csrfmiddlewaretoken': '{{ csrf_token }}', 'Id_empresa':'{{Id_empresa}}','id': cc_id, 'pkregistro': cc_pk, 'tabla':cc_tabla, 'nombre':cc_nombre, 'valor':cc_valor, 'usuario':'{{usuario}}'},
          success: function(Response){
          var campo = document.getElementById(Response["id"])
          campo.style.backgroundColor = "lightgreen"
          }
        });

}

function cerrar_cemaforo(){
  $('#panel_cemaforo').remove();
  $('#home-tab').remove();

}

function carga_charts(Response){

  if(Response["lista_charts"].length>0){
    $('#panel_cemaforo').html('');
  }

    if(Response["lista_charts"].length >0 ){
      add_tap ='<div class="col-md-12"><button type="button" onclick="cerrar_cemaforo()" class="btn btn-warning">{{idioma_html.cerrar}}</button></div>'
    }else{
      add_tap =''
    }
        var iDiv = document.createElement('div');
        iDiv.innerHTML= add_tap
        var divcemaforo = document.getElementById('panel_cemaforo');
        divcemaforo.appendChild(iDiv);

    for (y = 0; y < Response["lista_charts"].length; y++) {
      
      new_tap =  ''

      if(Response["lista_charts"][y]["tipo"]=='chart js'){
        var iDiv = document.createElement('div');
        iDiv.className  = Response["lista_charts"][y]["html_class"]

        new_tap = new_tap + '<div class="x_panel tile"><h2>'+ Response["lista_charts"][y]["titulo"] +'</h2><div class="x_title"></div><canvas id="charts'+ Response["lista_charts"][y]["pk"] +'"></canvas></div></div>'
        new_tap = new_tap + '</div>'

        iDiv.innerHTML= new_tap

        if(Response["lista_charts"][y]["modelo"]=='barras'){
          data_final = {}
          data_temp = []

          data_final['labels'] = Response["lista_charts"][y]["dato_x"].split(",")
          for (yy = 0; yy < Response["valores_charts"][Response["lista_charts"][y]["pk"]].length; yy++) {
            data_linea = {}

            data_linea['label'] = Response["valores_charts"][Response["lista_charts"][y]["pk"]][yy][Response["lista_charts"][y]["label"]]
            data_linea['backgroundColor'] = 'rgb('+ Math.floor(Math.random() * 254) +','+ Math.floor(Math.random() * 254) +','+ Math.floor(Math.random() * 254) +')'
            data_linea['borderColor'] = 'rgb('+ Math.floor(Math.random() * 254) +','+ Math.floor(Math.random() * 254) +','+ Math.floor(Math.random() * 254) +')'
            data_linea['fill'] = false

            data_valor = []
            columas = Response["lista_charts"][y]["dato_x"].split(",")
              for (y3 = 0; y3 < columas.length; y3++) {
                data_valor.push(Response["valores_charts"][Response["lista_charts"][y]["pk"]][yy][columas[y3]])
              }
            data_linea['data'] = data_valor
            data_temp.push(data_linea)
          }
          
          data_final['datasets'] = data_temp

          var config = {
              type: 'line',
              data: data_final,
              options: {responsive: true,title: {display: true,text: Response["lista_charts"][y]["descripcion"]},
                tooltips: {mode: 'index',intersect: false,},
                hover: {mode: 'nearest',intersect: true},
                scales: {
                  xAxes: [{display: true,scaleLabel: {display: true,labelString: Response["lista_charts"][y]["dato_x_name"]}}],
                  yAxes: [{display: true,scaleLabel: {display: true,labelString: Response["lista_charts"][y]["dato_y_name"]}}]
                }
              }
            };

          var divcemaforo = document.getElementById('panel_cemaforo');
          divcemaforo.appendChild(iDiv);

          var canvas_int = document.getElementById('charts' +Response["lista_charts"][y]["pk"]).getContext('2d');
          window.myLine = new Chart(canvas_int, config);
        }

        if(Response["lista_charts"][y]["modelo"]=='pastel'){
          temp_valores = []
          temp_backgroundColor = []
          temp_labels = []

          for (yy = 0; yy < Response["valores_charts"][Response["lista_charts"][y]["pk"]].length; yy++) {
            temp_valores.push(Response["valores_charts"][Response["lista_charts"][y]["pk"]][yy][Response["lista_charts"][y]["dato_y_name"]])
            temp_backgroundColor.push('rgb('+ Math.floor(Math.random() * 254) +','+ Math.floor(Math.random() * 254) +','+ Math.floor(Math.random() * 254) +')')
            temp_labels.push(Response["valores_charts"][Response["lista_charts"][y]["pk"]][yy][Response["lista_charts"][y]["dato_x_name"]])
          }

          data_final = {}
          data_final['datasets'] = [{'data':temp_valores,'backgroundColor':temp_backgroundColor,'label':Response["lista_charts"][y]["titulo"]}]
          data_final['labels'] = temp_labels
           


          var config = {
              type: 'doughnut',
              data: data_final,
              options: {responsive: true,legend: {position: 'top',},
              title: {display: true,text: Response["lista_charts"][y]["titulo"]},
              animation: {animateScale: true,animateRotate: true}
              }
            };



          var divcemaforo = document.getElementById('panel_cemaforo');
          divcemaforo.appendChild(iDiv);

          var canvas_int = document.getElementById('charts' +Response["lista_charts"][y]["pk"]).getContext('2d');
          window.myLine = new Chart(canvas_int, config);
        }
      }
      if(Response["lista_charts"][y]["tipo"]=='echarts'){


        var iDiv = document.createElement('div');
        iDiv.className  = Response["lista_charts"][y]["html_class"]

        new_tap = new_tap + '<div class="x_panel tile"><h2>'+ Response["lista_charts"][y]["titulo"] +'</h2><div class="x_title"></div><div id="charts'+ Response["lista_charts"][y]["pk"] +'" style="width: 100%; min-height: 300px"></div></div></div>'
        iDiv.innerHTML= new_tap

        var divcemaforo = document.getElementById('panel_cemaforo');
        divcemaforo.appendChild(iDiv);

        if(Response["lista_charts"][y]["modelo"]=='gauge'){
            var dom = document.getElementById('charts'+ Response["lista_charts"][y]["pk"]);
            var myChart = echarts.init(dom);
            var app = {};
            var a = Response["valores_charts"][Response["lista_charts"][y]["pk"]][0][Response["lista_charts"][y]["dato_x_name"]]
            var b = Response["valores_charts"][Response["lista_charts"][y]["pk"]][0][Response["lista_charts"][y]["dato_y_name"]]
            option = null;
            option = {
                tooltip : {
                    formatter: "{a} <br/>{b} : {c}%"
                },
                toolbox: {
                    feature: {
                        restore: {},
                        saveAsImage: {}
                    }
                },
                series: [
                    {
                        name: Response["lista_charts"][y]["dato_y_name"]+': '+b,
                        type: 'gauge',
                        detail: {formatter:'{value}%'},
                        data: [{value: Math.floor(b/a*100), name: Response["lista_charts"][y]["label"]}]
                    }
                ]
            };

            myChart.setOption(option, true);
        }
      }
       
    }
}
function reporte_ejecutar(tem_pestalla, temp_nivel,  id){

  Response = dict_pestalla['p-'+tem_pestalla]
  senten = []
  str1 = []
  str2 = []
  str3 = []
  str4 = []
  str5 = []

  label = {}
  varref = {}
  varvar = {}

    for (x2 = 0; x2 < Response["Resto_reporte"][0].length; x2++) {
      str1.push(Response["Resto_reporte"][0][x2]["sentencia"]) 
    }
    for (x2 = 0; x2 < Response["Resto_reporte"][1].length; x2++) {
      str2.push(Response["Resto_reporte"][1][x2]["sentencia"]) 
    }
    for (x2 = 0; x2 < Response["Resto_reporte"][2].length; x2++) {
      str3.push(Response["Resto_reporte"][2][x2]["sentencia"]) 
    }
    for (x2 = 0; x2 < Response["Resto_reporte"][3].length; x2++) {
      str4.push(Response["Resto_reporte"][3][x2]["sentencia"]) 
    }
    for (x2 = 0; x2 < Response["Resto_reporte"][4].length; x2++) {
      str5.push(Response["Resto_reporte"][4][x2]["sentencia"]) 
    }
    for (x2 = 0; x2 < str1.length; x2++) {
      senten.push(str1[x2] + str2[x2] + str3[x2] + str4[x2] + str5[x2])
    }

    for (x = 0; x < Response["referencias_reprotes"].length; x++) {
      id_tem =  "rpzz" + tem_pestalla + "zz"+ x + "zz" + Response["referencias_reprotes"][x]["id"]
      varref[Response["referencias_reprotes"][x]["id_rep"]] = String(document.getElementById(id_tem).value)  
      label[Response["referencias_reprotes"][x]["id_rep"]] = Response["referencias_reprotes"][x]["glosa"]
    }

    for (x = 0; x < Response["variables_reprotes"].length; x++) {
      id_tem =  "var-"+ tem_pestalla + "-"+ Response["variables_reprotes"][x]["id"]
      varvar[Response["variables_reprotes"][x]["id_rep"]] = String(document.getElementById(id_tem).value)    
      label[Response["variables_reprotes"][x]["id_rep"]] = Response["variables_reprotes"][x]["glosa"]
  
    }
  $.ajax({
          type: 'POST',
          url: '/reporte_ejecutar',
          data: {'fuente': $(this).attr("value"), 'csrfmiddlewaretoken': '{{ csrf_token }}', 'Id_empresa':'{{Id_empresa}}','senten': JSON.stringify(senten), 'usuario':'{{usuario}}', 'label':JSON.stringify(label), 'varref':JSON.stringify(varref),'varvar':JSON.stringify(varvar), 'pestalla':tem_pestalla, 'id':id, 'nombre_rep':Response["nombre_rep"]},
          beforeSend: function () {
             
            data_int = '<div class="col-md-12" style="padding-top: 50px;"><div class="col-middle"><button type="button" onclick="cerrar_elemento(' + tem_pestalla +')" class="btn btn-warning"><span class="glyphicon glyphicon-remove-sign" aria-hidden="true"></span></button><div class="text-center text-center"><h1 class="error-number"></h1><h2>{{idioma_html.espere}}</h2><p>{{idioma_html.carga}}.</p><div class="weather-icon"><span><canvas height="84" width="84" id="partly-cloudy-day"></canvas></span></div></div></div></div>'
            $('#rr' +tem_pestalla).html(data_int);            


            },
          success: function(Response){

            dict_pestalla['p-'+Response["pestalla"]] = Response
            reppuesta_rep = Response["resutado"]

            data_int =  '<div style="padding-top: 50px;"><div class="panel-body" style="overflow: auto;"><div class="row"><button class="btn btn-primary" id="reporteejecutar" name="reporteejecutar" type="submit" value="4" onclick="reejecutar_reprote(' + Response["id"] + ')">{{idioma_html.nuevo}}</button><button type="button" onclick="cerrar_elemento(' + Response["pestalla"] + ')" class="btn btn-warning"><span class="glyphicon glyphicon-remove-sign" aria-hidden="true"></span></button><button type="button" data-toggle="tooltip" data-placement="top" title="Pdf" onclick="pdf_reporte(' + Response["pestalla"] + ')" class="btn btn-info"><span class="fa fa-file-pdf-o" aria-hidden="true"></span></button><button type="button" data-toggle="tooltip" data-placement="top" title="Excell" onclick="excell_reporte(' + Response["pestalla"] + ')" class="btn btn-info"><span class="fa fa-file-excel-o" aria-hidden="true"></span></button></div><table width="100%" class="table table-striped table-bordered table-hover" id="dataTables-' + Response["pestalla"] + '"><thead><tr>'

            var y_vinculo = 0
            var x_vinculo = 0
            
            if(reppuesta_rep[0].length==2){  
               data_int = data_int + '<th></th>'
                for (x = 0; x < reppuesta_rep[1][0].length; x++) {
                  if(reppuesta_rep[1][0][x][0] == '$vinculo'){
                    y_vinculo = x
                  }
                }

            }
    
            for (x = 0; x < reppuesta_rep[0][0].length; x++) {
              if(reppuesta_rep[0][0][x][0] != '$vinculo'){
                data_int = data_int + '<th>' + reppuesta_rep[0][0][x][0] + '</th>'
              }else{
                x_vinculo = x
              }
            }
            data_int = data_int + '</tr></thead><tbody>'

            for (x = 0; x < reppuesta_rep[0][1].length; x++) {

              data_int = data_int + '<tr class="odd gradeX">'
              
              var haydetalle = 0

              if(reppuesta_rep[0].length==2){  
                  for (y = 0; y < reppuesta_rep[1][1].length; y++) {
                    if(reppuesta_rep[0][1][x][x_vinculo] == reppuesta_rep[1][1][y][y_vinculo]){haydetalle = 1}
                  }
                if(haydetalle == 1){
                  data_int = data_int + '<td style="text-align: center;"><button type="button" data-toggle="modal" data-target=".bs-example-modal-md" style="padding: 1px 6px;margin-bottom: 0px;margin-right: 0px;" onclick="abrir_subrep('+Response["pestalla"]+', '+ x +')" class="btn btn-round btn-success"><span class="fa fa-plus" aria-hidden="true"></span></button></td>'  
                }else{
                  data_int = data_int + '<td></td>'  
                }
              }

              for (x2 = 0; x2 < reppuesta_rep[0][0].length; x2++) {
                if(reppuesta_rep[0][0][x2][0] != '$vinculo'){
                  data_int = data_int + '<td>' + reppuesta_rep[0][1][x][x2] + '</td>'
                }
              }

              data_int = data_int + '</tr>'

            }
            data_int = data_int + '</tbody></table></div></div>'
            $('#rr' +tem_pestalla).html(data_int);            
          } 
    });

  //---------------------------------------------
}





function selecctt_buscador2click(x) {  
  document.getElementById("vfinal_bus").value = x.rowIndex
  document.getElementById("vfinal_bus_2").value = document.getElementById("dataTables-example").rows[x.rowIndex].cells[0].innerHTML.trim();
}

function selecctt_buscador(x) {  
  document.getElementById("vfinal_bus").value = x.rowIndex
  document.getElementById("vfinal_bus_2").value = document.getElementById("dataTables-example").rows[x.rowIndex].cells[0].innerHTML.trim();
}

function calcular_0(pestana_int) {


    Response = dict_pestalla['p-'+pestana_int]
  
    for (x = 0; x < Response["campos_cab"].length; x++) {   
        ID_TAG = 'p' + pestana_int + 'zzz' + Response["campos_cab"][x]["Nombre"] + ''; 
        if (Response["campos_cab"][x]["TablaCampo"] == "cmpnumsimple"){
          if (document.getElementById(ID_TAG).value <=  Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Menor"]){
            document.getElementById(ID_TAG).value = setTwoNumberDecimal(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Menor"], Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["NumDecimales"])
          }else{
            if (document.getElementById(ID_TAG).value >=  Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Mayor"]){
              document.getElementById(ID_TAG).value = setTwoNumberDecimal(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Mayor"], Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["NumDecimales"])
            }else{
            document.getElementById(ID_TAG).value = setTwoNumberDecimal(document.getElementById(ID_TAG).value, Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["NumDecimales"])
            }
            
          }
        }
        if (Response["campos_cab"][x]["TablaCampo"] == "cmpformuladetalle"){
          valor_final = 0;
          cc_final = 0;

          for (x2 = 0; x2 < (cc_porPesta['p-' + pestana_int] + 1 ); x2++) { 

            Campo_a_oper = Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0][0]["Campo"]
            Campo = Campo_a_oper.split(".")
            ID_TAG_campo = 'pd' + pestana_int + 'fff' + x2 +'ccc'+ Campo[1]

            if (document.getElementById(ID_TAG_campo) != null){

              Valor = parseFloat(document.getElementById(ID_TAG_campo).value)

              excluido = 0;

              for (x3 = 0; x3 < Response["func_cab"][Response["campos_cab"][x]["Nombre"]][1].length; x3++) { 
                valor_comparar = 0;
                ID_TAG_campoA = 'pd' + pestana_int + 'fff' + x2 +'ccc'+ Response["func_cab"][Response["campos_cab"][x]["Nombre"]][1][x3]["Campo"]
                if (Response["func_cab"][Response["campos_cab"][x]["Nombre"]][1][x3]["Tipo"] == "Valor")
                  {
                    valor_comparar = Response["func_cab"][Response["campos_cab"][x]["Nombre"]][1][x3]["Valor"]
                  }else{
                    ID_TAG_compa = 'pd' + pestana_int + 'fff' + x2 + 'ccc' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][1][x3]["Valor"]
                    valor_comparar = document.getElementById(ID_TAG_compa).value
                  }
                if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][1][x3]["Operador"] == "=")
                {if(document.getElementById(ID_TAG_campoA).value != valor_comparar){excluido = 1}}
                if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][1][x3]["Operador"] == "<")
                {if(document.getElementById(ID_TAG_campoA).value >= valor_comparar){excluido = 1}}
                if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][1][x3]["Operador"] == ">")
                {if(document.getElementById(ID_TAG_campoA).value <= valor_comparar){excluido = 1}}
                if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][1][x3]["Operador"] == "<=")
                {if(document.getElementById(ID_TAG_campoA).value > valor_comparar){excluido = 1}}
                if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][1][x3]["Operador"] == ">=")
                {if(document.getElementById(ID_TAG_campoA).value < valor_comparar){excluido = 1}}
              }    
            
              if(excluido == 0){
                if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0][0]["Operacion"] == "Suma"){
                  valor_final =  parseFloat(valor_final) + parseFloat(Valor)
                }
                if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0][0]["Operacion"] == "Promedio"){
                  valor_final =  parseFloat(valor_final) + parseFloat(Valor)
                  cc_final =  cc_final + 1
                }
                if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0][0]["Operacion"] == "Maximo"){
                  if(parseFloat(valor_final) < parseFloat(Valor)){valor_final = Valor}
                }
                if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0][0]["Operacion"] == "Minimo"){
                  if(parseFloat(valor_final) > parseFloat(Valor)){valor_final = Valor}
                }
                if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0][0]["Operacion"] == "Contar"){
                  cc_final =  cc_final + 1
                }
              }
            }      
          }
          if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0][0]["Operacion"] == "Suma"){
            document.getElementById(ID_TAG).value =   setTwoNumberDecimal(valor_final, 2)
          }
          if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0][0]["Operacion"] == "Promedio"){
            valor_final =  valor_final / (cc_final + 1)
            document.getElementById(ID_TAG).value =   setTwoNumberDecimal(valor_final, 2)
          }
          if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0][0]["Operacion"] == "Maximo"){
            document.getElementById(ID_TAG).value =   setTwoNumberDecimal(valor_final, 2)
          }
          if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0][0]["Operacion"] == "Minimo"){
            document.getElementById(ID_TAG).value =   setTwoNumberDecimal(valor_final, 2)
          }
          if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0][0]["Operacion"] == "Contar"){
            document.getElementById(ID_TAG).value =   cc_final
          }           
        }
        if (Response["campos_cab"][x]["TablaCampo"] == "cmpsistema"){

          if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Nombre"] == "Fecha Actual"){
            temp_sentencia = 'select now() as "tiempo"'
            id_tag_ajax = ID_TAG
             $.ajax({
                type: 'POST',
                url: '/consolidado',
                data: {'fuente': $(this).attr("value"), 'csrfmiddlewaretoken': '{{ csrf_token }}', 'Id_empresa':'{{Id_empresa}}','cmpsenten': temp_sentencia, 'tag1': id_tag_ajax, 'tag2': 0, 'usuario':'{{usuario}}'},
                success: function(Response){
                  if (Response["cmpvalor"].length == 0){
                    document.getElementById(Response["tag1"]).value = 0
                  }else{
                    document.getElementById(Response["tag1"]).value =  Response["cmpvalor"][0]['tiempo']
                  }
                }
              });
          }
          if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Nombre"] == "Usuario Actual"){
            document.getElementById(ID_TAG).value = '{{usuario}}'
          }
          if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Nombre"] == "Hora Actual"){
            temp_sentencia = 'select now() as "tiempo"'
            $.ajax({
              type: 'POST',
              url: '/consolidado',
              data: {'fuente': $(this).attr("value"), 'csrfmiddlewaretoken': '{{ csrf_token }}', 'Id_empresa':'{{Id_empresa}}','cmpsenten': temp_sentencia, 'tag1': ID_TAG, 'tag2': ID_TAG, 'usuario':'{{usuario}}'},
              success: function(Response){
                if (Response["cmpvalor"].length == 0){
                  document.getElementById(Response["tag1"]).value = 0
                }else{
                  document.getElementById(Response["tag1"]).value =  Response["cmpvalor"][0]['tiempo']
                }
              }
            });
          }
        }
        if (Response["campos_cab"][x]["TablaCampo"] == "cmpreferencia"){
        }
        if (Response["campos_cab"][x]["TablaCampo"] == "cmpreferenciaadjunto"){
        }
        if (Response["campos_cab"][x]["TablaCampo"] == "cmpoperacion"){
          temp  = 0.0;
          operador = "=";
          Valor = 0.0;

          for (x3 = 0; x3 < Response["func_cab"][Response["campos_cab"][x]["Nombre"]][1].length; x3++) { 
            if (Response["func_cab"][Response["campos_cab"][x]["Nombre"]][1][x3]["Estado"] == "C"){

              ID_TAG_campo = 'p' + pestana_int + 'zzz' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][1][x3]["Sentencia"] + ''; 
              if(document.getElementById(ID_TAG_campo).value == ""){
                Valor = 0.0
              }else{
                Valor = document.getElementById(ID_TAG_campo).value
              }

              if(operador == "="){temp = parseFloat(Valor)}
              if(operador == "+"){temp = parseFloat(temp) + parseFloat(Valor)}
              if(operador == "-"){temp = parseFloat(temp) - parseFloat(Valor)}
              if(operador == "*"){temp = parseFloat(temp) * parseFloat(Valor)}
              if(operador == "/"){
                if(Valor > 0){temp = parseFloat(temp) / parseFloat(Valor)}
                }
            }
            if (Response["func_cab"][Response["campos_cab"][x]["Nombre"]][1][x3]["Estado"] == "O"){
              operador = Response["func_cab"][Response["campos_cab"][x]["Nombre"]][1][x3]["Sentencia"]
            }
            if (Response["func_cab"][Response["campos_cab"][x]["Nombre"]][1][x3]["Estado"] == "V"){
              Valor = Response["func_cab"][Response["campos_cab"][x]["Nombre"]][1][x3]["Sentencia"]
              if(operador == "="){temp = parseFloat(Valor)}
              if(operador == "+"){temp = parseFloat(temp) + parseFloat(Valor)}
              if(operador == "-"){temp = parseFloat(temp) - parseFloat(Valor)}
              if(operador == "*"){temp = parseFloat(temp) * parseFloat(Valor)}
              if(operador == "/"){
                if(Valor > 0){temp = parseFloat(temp) / parseFloat(Valor)}
                }
            }
          }
          temp = setTwoNumberDecimal(temp, Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0][0]["Decimales"])
          document.getElementById(ID_TAG).value = temp
        }
        if (Response["campos_cab"][x]["TablaCampo"] == "cmpconsolidado"){

          A_Select = 'Select ( '
          A_From = 'From '
          A_Where = 'Where '
          A_Group = 'Group by '
          A_GroupWhere = 'Group by '
          sentencia = ""
          FaltaDato = false



          for (x3 = 0; x3 < Response["func_cab"][Response["campos_cab"][x]["Nombre"]][1].length; x3++) { 
              A_From = A_From + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][1][x3]["Tabla"] + ' as ' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][1][x3]["Nombre"] + ', '
          }
          if(A_From == "From "){ A_From = ""}else{        A_From =   A_From.slice(0,-2)}

          for (x3 = 0; x3 < Response["func_cab"][Response["campos_cab"][x]["Nombre"]][2].length; x3++) { 

            if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][2][x3]["Tipo"] == "Valor"){
              A_Where = A_Where + " '" + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][2][x3]["Elemento"] + "' "            
            }
            if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][2][x3]["Tipo"] == "Operacion"){
             A_Where = A_Where + " " + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][2][x3]["Elemento"] + " "             
            }
            if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][2][x3]["Tipo"] == "Registro"){
              ID_TAG_reg = 'p' + pestana_int + 'zzz' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][2][x3]["Elemento"]; 

              if(document.getElementById(ID_TAG_reg).value == ""){
                FaltaDato = true       
                A_Where = A_Where + " '' "
              }else{
                A_Where = A_Where + " '" + document.getElementById(ID_TAG_reg).value + "' "
              }
                    
            }
            if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][2][x3]["Tipo"] == "Campo"){

              if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][2][x3]["Funcion"] == ""){

                A_Where = A_Where + " " + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][2][x3]["Origen"] + '.' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][2][x3]["Elemento"] + " " 
              }
              if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][2][x3]["Funcion"] == " "){
                A_Where = A_Where + " " + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][2][x3]["Origen"] + '.' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][2][x3]["Elemento"] + " "               }
              if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][2][x3]["Funcion"] == "Suma"){
                 A_Where = A_Where + " " + 'Sum(' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][2][x3]["Origen"] + '.' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][2][x3]["Elemento"] + ') '
                  A_GroupWhere = A_GroupWhere + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][2][x3]["Origen"] + '.' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][2][x3]["Elemento"] + ', '
              }
              if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][2][x3]["Funcion"] == "Promedio"){
                A_Where = A_Where + ' Avg(' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][2][x3]["Origen"] + '.' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][2][x3]["Elemento"] + ') '
                A_GroupWhere = A_GroupWhere + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][2][x3]["Origen"] + '.' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][2][x3]["Elemento"] + ', '
              }
              if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][2][x3]["Funcion"] == "Contar"){
                A_Where = A_Where + ' Count(' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][2][x3]["Origen"] + '.' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][2][x3]["Elemento"] + ') ' 
                A_GroupWhere = A_GroupWhere + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][2][x3]["Origen"] + '.' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][2][x3]["Elemento"] + ', '            
              }
            }

            
          }
          if(A_Where == 'Where '){A_Where = ''}
          if(A_GroupWhere == "Group by "){ A_GroupWhere = ""}else{A_GroupWhere =   A_GroupWhere.slice(0,-2)}
      

          for (x3 = 0; x3 < Response["func_cab"][Response["campos_cab"][x]["Nombre"]][3].length; x3++) { 


            if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][3][x3]["Tipo"] == "Valor"){
               A_Select = A_Select + " '" + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][3][x3]["Elemento"] + "' "
            }
            if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][3][x3]["Tipo"] == "Operacion"){
               A_Select = A_Select + " " + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][3][x3]["Elemento"] + " "   
            }
            if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][3][x3]["Tipo"] == "Registro"){
              ID_TAG_reg = 'p' + pestana_int + 'zzz' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][3][x3]["Elemento"]; 

              if(document.getElementById(ID_TAG_reg).value == ""){
                FaltaDato = true       
                A_Select = A_Select + " '' "     
              }else{
                A_Select = A_Select + " '" + document.getElementById(ID_TAG_reg).value + "' "
              }
            }
            if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][3][x3]["Tipo"] == "Campo"){

              if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][3][x3]["Funcion"] == ""){

                A_Select = A_Select + " " + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][3][x3]["Origen"] + '.' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][3][x3]["Elemento"] + " "
              }
              if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][3][x3]["Funcion"] == " "){
                A_Select = A_Select + " " + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][3][x3]["Origen"] + '.' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][3][x3]["Elemento"] + " "
              }
              if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][3][x3]["Funcion"] == "Suma"){
                 A_Select = A_Select + ' Sum(' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][3][x3]["Origen"] + '.' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][3][x3]["Elemento"] + ') '
                  A_Group = A_Group + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][3][x3]["Origen"] + '.' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][3][x3]["Elemento"] + ', '
              }
              if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][3][x3]["Funcion"] == "Promedio"){
                A_Select = A_Select + ' Avg(' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][3][x3]["Origen"] + '.' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][3][x3]["Elemento"] + ') '
                A_Group = A_Group + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][3][x3]["Origen"] + '.' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][3][x3]["Elemento"] + ', '
              }
              if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][3][x3]["Funcion"] == "Contar"){
                A_Select = A_Select + ' Count(' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][3][x3]["Origen"] + '.' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][3][x3]["Elemento"] + ') ' 
                A_Group = A_Group + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][3][x3]["Origen"] + '.' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][3][x3]["Elemento"] + ', '            
              }
            }
          }
          if(A_Group == "Group by "){ A_Group = ""}else{A_Group = A_Group.slice(0,-2)}

          A_Select = A_Select + " ) as '" + Response["campos_cab"][x]["Nombre"] + "'"
          if(A_Group == ""){
            if(A_GroupWhere == ""){
              sentencia = A_Select + " " + A_From + " " + A_Where 
            }else{
              sentencia = A_Select + " " + A_From + " " + A_Where + " " +  A_GroupWhere
            }
          }else{
            if(A_GroupWhere == ""){
              sentencia = A_Select + " " + A_From + " " + A_Where + " " + A_Group
            }else{
              sentencia = A_Select + " " + A_From + " " + A_Where + " " + A_Group + ", " + A_GroupWhere.replace("Group by ","")
            }
          }

          if(FaltaDato == true && Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0][0]["Permite_nulo"] == "No"){
           document.getElementById(ID_TAG).value =  0

          }else{
            ID_TAG_resp = 'p' + pestana_int + 'zzz' + Response["campos_cab"][x]["Nombre"] + '';
            ID_TAG_nombre = Response["campos_cab"][x]["Nombre"]
              $.ajax({
                type: 'POST',
                url: '/consolidado',
                data: {'fuente': $(this).attr("value"), 'csrfmiddlewaretoken': '{{ csrf_token }}', 'Id_empresa':'{{Id_empresa}}','cmpsenten': sentencia,'tag1': ID_TAG_resp, 'tag2': ID_TAG_nombre, 'usuario':'{{usuario}}'},
                success: function(Response){
                  if (Response["cmpvalor"].length == 0){
                    document.getElementById(Response["tag1"]).value = 0
                  }else{
                    document.getElementById(Response["tag1"]).value =  Response["cmpvalor"][0][Response["tag2"]]
                  }
                }
              });
          }
        }
        if (Response["campos_cab"][x]["TablaCampo"] == "cmpnumeroaletras"){
          ID_TAG_campo = 'p' + pestana_int + 'zzz' + Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["CampoNumero"] + ''; 
           
         document.getElementById(ID_TAG).value =  numeroALetras(document.getElementById(ID_TAG_campo).value);

        }
    }
}

function calcular_detalle(pestana_int, fila) {


    Response = dict_pestalla['p-'+pestana_int]
  
    for (x = 0; x < Response["campos_det"].length; x++) {   
        ID_TAG = 'pd' + pestana_int + 'fff' + fila + 'ccc' + Response["campos_det"][x]["Nombre"] + ''; 

        if (Response["campos_det"][x]["TablaCampo"] == "cmpnumsimple"){
          if (document.getElementById(ID_TAG).value <=  Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Menor"]){
            document.getElementById(ID_TAG).value = setTwoNumberDecimal(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Menor"], Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["NumDecimales"])
          }else{
            if (document.getElementById(ID_TAG).value >=  Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Mayor"]){
              document.getElementById(ID_TAG).value = setTwoNumberDecimal(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Mayor"], Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["NumDecimales"])
            }else{
              document.getElementById(ID_TAG).value = setTwoNumberDecimal(document.getElementById(ID_TAG).value, Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["NumDecimales"])
            }


            
          }
        }
        if (Response["campos_det"][x]["TablaCampo"] == "cmpformuladetalle"){
          valor_final = 0;
          cc_final = 0;

          for (x2 = 0; x2 < (cc_porPesta['p-' + pestana_int] + 1 ); x2++) { 

            excluido = 0;

            for (x3 = 0; x3 < Response["func_det"][Response["campos_det"][x]["Nombre"]][1].length; x3++) { 
            valor_comparar = 0;

            ID_TAG_campo = 'pd' + pestana_int + 'fff' + x2 +'ccc'+ Response["func_det"][Response["campos_det"][x]["Nombre"]][1][x3]["Campo"]
              if (Response["func_det"][Response["campos_det"][x]["Nombre"]][1][x3]["Tipo"] == "Valor")
                {
                  valor_comparar = Response["func_det"][Response["campos_det"][x]["Nombre"]][1][x3]["Valor"]
                }else{
                  ID_TAG_compa = 'pd' + pestana_int + 'fff' + x2 + 'ccc' + Response["func_det"][Response["campos_det"][x]["Nombre"]][1][x3]["Valor"]
                  valor_comparar = document.getElementById(ID_TAG_compa).value
                }
              if(Response["func_det"][Response["campos_det"][x]["Nombre"]][1][x3]["Operador"] == "=")
              {if(document.getElementById(ID_TAG_campo).value != valor_comparar){excluido = 1}}
              if(Response["func_det"][Response["campos_det"][x]["Nombre"]][1][x3]["Operador"] == "<")
              {if(document.getElementById(ID_TAG_campo).value >= valor_comparar){excluido = 1}}
              if(Response["func_det"][Response["campos_det"][x]["Nombre"]][1][x3]["Operador"] == ">")
              {if(document.getElementById(ID_TAG_campo).value <= valor_comparar){excluido = 1}}
              if(Response["func_det"][Response["campos_det"][x]["Nombre"]][1][x3]["Operador"] == "<=")
              {if(document.getElementById(ID_TAG_campo).value > valor_comparar){excluido = 1}}
              if(Response["func_det"][Response["campos_det"][x]["Nombre"]][1][x3]["Operador"] == ">=")
              {if(document.getElementById(ID_TAG_campo).value < valor_comparar){excluido = 1}}
            }    
          
            if(excluido == 0){

              Campo_a_oper = Response["func_det"][Response["campos_det"][x]["Nombre"]][0][0]["Campo"]
              Campo = Campo_a_oper.split(".")
              ID_TAG_campo = 'pd' + pestana_int + 'fff' + x2 +'ccc'+ Campo[1]
              Valor = parseFloat(document.getElementById(ID_TAG_campo).value)


              if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0][0]["Operacion"] == "Suma"){
                valor_final =  parseFloat(valor_final) + parseFloat(Valor)
              }
              if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0][0]["Operacion"] == "Promedio"){
                valor_final =  parseFloat(valor_final) + parseFloat(Valor)
                cc_final =  cc_final + 1
              }
              if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0][0]["Operacion"] == "Maximo"){
                if(parseFloat(valor_final) < parseFloat(Valor)){valor_final = Valor}
              }
              if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0][0]["Operacion"] == "Minimo"){
                if(parseFloat(valor_final) > parseFloat(Valor)){valor_final = Valor}
              }
              if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0][0]["Operacion"] == "Contar"){
                cc_final =  cc_final + 1
              }
            }

          }      
          
          if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0][0]["Operacion"] == "Suma"){
            document.getElementById(ID_TAG).value =   setTwoNumberDecimal(valor_final, 2)
          }
          if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0][0]["Operacion"] == "Promedio"){
            valor_final =  valor_final / (cc_final + 1)
            document.getElementById(ID_TAG).value =   setTwoNumberDecimal(valor_final, 2)
          }
          if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0][0]["Operacion"] == "Maximo"){
            document.getElementById(ID_TAG).value =   setTwoNumberDecimal(valor_final, 2)
          }
          if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0][0]["Operacion"] == "Minimo"){
            document.getElementById(ID_TAG).value =   setTwoNumberDecimal(valor_final, 2)
          }
          if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0][0]["Operacion"] == "Contar"){
            document.getElementById(ID_TAG).value =   cc_final

          }           
        }
        if (Response["campos_det"][x]["TablaCampo"] == "cmpfecha"){
        }
        if (Response["campos_det"][x]["TablaCampo"] == "cmpreferencia"){
        }
        if (Response["campos_det"][x]["TablaCampo"] == "cmpreferenciaadjunto"){
        }
        if (Response["campos_det"][x]["TablaCampo"] == "cmpoperacion"){
          temp  = 0.0;
          operador = "=";
          Valor = 0.0;

          for (x3 = 0; x3 < Response["func_det"][Response["campos_det"][x]["Nombre"]][1].length; x3++) { 
            if (Response["func_det"][Response["campos_det"][x]["Nombre"]][1][x3]["Estado"] == "C"){

              ID_TAG_campo = 'pd' + pestana_int + 'fff' + fila + 'ccc'+ Response["func_det"][Response["campos_det"][x]["Nombre"]][1][x3]["Sentencia"] + ''; 
              if(document.getElementById(ID_TAG_campo).value == ""){
                Valor = 0.0
              }else{
                Valor = document.getElementById(ID_TAG_campo).value
              }

              if(operador == "="){temp = parseFloat(Valor)}
              if(operador == "+"){temp = parseFloat(temp) + parseFloat(Valor)}
              if(operador == "-"){temp = parseFloat(temp) - parseFloat(Valor)}
              if(operador == "*"){temp = parseFloat(temp) * parseFloat(Valor)}
              if(operador == "/"){
                if(Valor > 0){temp = parseFloat(temp) / parseFloat(Valor)}
                }
            }
            if (Response["func_det"][Response["campos_det"][x]["Nombre"]][1][x3]["Estado"] == "O"){
              operador = Response["func_det"][Response["campos_det"][x]["Nombre"]][1][x3]["Sentencia"]
            }
            if (Response["func_det"][Response["campos_det"][x]["Nombre"]][1][x3]["Estado"] == "V"){
              Valor = Response["func_det"][Response["campos_det"][x]["Nombre"]][1][x3]["Sentencia"]
              if(operador == "="){temp = parseFloat(Valor)}
              if(operador == "+"){temp = parseFloat(temp) + parseFloat(Valor)}
              if(operador == "-"){temp = parseFloat(temp) - parseFloat(Valor)}
              if(operador == "*"){temp = parseFloat(temp) * parseFloat(Valor)}
              if(operador == "/"){
                if(Valor > 0){temp = parseFloat(temp) / parseFloat(Valor)}
                }
            }
          }
          temp = setTwoNumberDecimal(temp, Response["func_det"][Response["campos_det"][x]["Nombre"]][0][0]["Decimales"])
          document.getElementById(ID_TAG).value = temp
        }
        if (Response["campos_det"][x]["TablaCampo"] == "cmpconsolidado"){

          A_Select = 'Select ( '
          A_From = 'From '
          A_Where = 'Where '
          A_Group = 'Group by '
          A_GroupWhere = 'Group by '
          sentencia = ""
          FaltaDato = false



          for (x3 = 0; x3 < Response["func_det"][Response["campos_det"][x]["Nombre"]][1].length; x3++) { 
              A_From = A_From + Response["func_det"][Response["campos_det"][x]["Nombre"]][1][x3]["Tabla"] + ' as ' + Response["func_det"][Response["campos_det"][x]["Nombre"]][1][x3]["Nombre"] + ', '
          }
          if(A_From == "From "){ A_From = ""}else{        A_From =   A_From.slice(0,-2)}

          for (x3 = 0; x3 < Response["func_det"][Response["campos_det"][x]["Nombre"]][2].length; x3++) { 

            if(Response["func_det"][Response["campos_det"][x]["Nombre"]][2][x3]["Tipo"] == "Valor"){
              A_Where = A_Where + " '" + Response["func_det"][Response["campos_det"][x]["Nombre"]][2][x3]["Elemento"] + "' "            
            }
            if(Response["func_det"][Response["campos_det"][x]["Nombre"]][2][x3]["Tipo"] == "Operacion"){
             A_Where = A_Where + ' ' + Response["func_det"][Response["campos_det"][x]["Nombre"]][2][x3]["Elemento"]+ ' '             
            }
            if(Response["func_det"][Response["campos_det"][x]["Nombre"]][2][x3]["Tipo"] == "Registro"){
              ID_TAG_reg = 'pd' + pestana_int + 'fff' + fila + 'ccc'+  Response["func_det"][Response["campos_det"][x]["Nombre"]][2][x3]["Elemento"]; 

              if(document.getElementById(ID_TAG_reg).value == ""){
                FaltaDato = true            
                A_Where = A_Where + " '' "
              }else{
                A_Where = A_Where + " '" + document.getElementById(ID_TAG_reg).value + "' "
              }
                    
            }
            if(Response["func_det"][Response["campos_det"][x]["Nombre"]][2][x3]["Tipo"] == "Campo"){

              if(Response["func_det"][Response["campos_det"][x]["Nombre"]][2][x3]["Funcion"] == ""){

                A_Where = A_Where + ' ' + Response["func_det"][Response["campos_det"][x]["Nombre"]][2][x3]["Origen"] + '.' + Response["func_det"][Response["campos_det"][x]["Nombre"]][2][x3]["Elemento"] + ' ' 
              }
              if(Response["func_det"][Response["campos_det"][x]["Nombre"]][2][x3]["Funcion"] == " "){
                A_Where = A_Where + ' ' + Response["func_det"][Response["campos_det"][x]["Nombre"]][2][x3]["Origen"] + '.' + Response["func_det"][Response["campos_det"][x]["Nombre"]][2][x3]["Elemento"] + ' ' 
              }
              if(Response["func_det"][Response["campos_det"][x]["Nombre"]][2][x3]["Funcion"] == "Suma"){
                 A_Where = A_Where + ' Sum(' + Response["func_det"][Response["campos_det"][x]["Nombre"]][2][x3]["Origen"] + '.' + Response["func_det"][Response["campos_det"][x]["Nombre"]][2][x3]["Elemento"] + ') '
                  A_GroupWhere = A_GroupWhere + Response["func_det"][Response["campos_det"][x]["Nombre"]][2][x3]["Origen"] + '.' + Response["func_det"][Response["campos_det"][x]["Nombre"]][2][x3]["Elemento"] + ', '
              }
              if(Response["func_det"][Response["campos_det"][x]["Nombre"]][2][x3]["Funcion"] == "Promedio"){
                A_Where = A_Where + ' Avg(' + Response["func_det"][Response["campos_det"][x]["Nombre"]][2][x3]["Origen"] + '.' + Response["func_det"][Response["campos_det"][x]["Nombre"]][2][x3]["Elemento"] + ') '
                A_GroupWhere = A_GroupWhere + Response["func_det"][Response["campos_det"][x]["Nombre"]][2][x3]["Origen"] + '.' + Response["func_det"][Response["campos_det"][x]["Nombre"]][2][x3]["Elemento"] + ', '
              }
              if(Response["func_det"][Response["campos_det"][x]["Nombre"]][2][x3]["Funcion"] == "Contar"){
                A_Where = A_Where + ' Count(' + Response["func_det"][Response["campos_det"][x]["Nombre"]][2][x3]["Origen"] + '.' + Response["func_det"][Response["campos_det"][x]["Nombre"]][2][x3]["Elemento"] + ') ' 
                A_GroupWhere = A_GroupWhere + Response["func_det"][Response["campos_det"][x]["Nombre"]][2][x3]["Origen"] + '.' + Response["func_det"][Response["campos_det"][x]["Nombre"]][2][x3]["Elemento"] + ', '            
              }
            }

            
          }
          if(A_GroupWhere == "Group by "){ A_GroupWhere = ""}else{A_GroupWhere =   A_GroupWhere.slice(0,-2)}
          if(A_Where == "Where "){ A_Where = ""}

          for (x3 = 0; x3 < Response["func_det"][Response["campos_det"][x]["Nombre"]][3].length; x3++) { 


            if(Response["func_det"][Response["campos_det"][x]["Nombre"]][3][x3]["Tipo"] == "Valor"){
               A_Select = A_Select + " '" + Response["func_det"][Response["campos_det"][x]["Nombre"]][3][x3]["Elemento"] + "' "
            }
            if(Response["func_det"][Response["campos_det"][x]["Nombre"]][3][x3]["Tipo"] == "Operacion"){
               A_Select = A_Select + " " + Response["func_det"][Response["campos_det"][x]["Nombre"]][3][x3]["Elemento"]+ " "   
            }
            if(Response["func_det"][Response["campos_det"][x]["Nombre"]][3][x3]["Tipo"] == "Registro"){
              ID_TAG_reg = 'pd' + pestana_int + 'fff' + fila + 'ccc'+  Response["func_det"][Response["campos_det"][x]["Nombre"]][3][x3]["Elemento"]; 

              if(document.getElementById(ID_TAG_reg).value == ""){
                FaltaDato = true            
                A_Select = A_Select + " '' "

              }else{
                A_Select = A_Select + " '" + document.getElementById(ID_TAG_reg).value + "' "
              }
            }
            if(Response["func_det"][Response["campos_det"][x]["Nombre"]][3][x3]["Tipo"] == "Campo"){

              if(Response["func_det"][Response["campos_det"][x]["Nombre"]][3][x3]["Funcion"] == ""){

                A_Select = A_Select + " " + Response["func_det"][Response["campos_det"][x]["Nombre"]][3][x3]["Origen"] + '.' + Response["func_det"][Response["campos_det"][x]["Nombre"]][3][x3]["Elemento"] + " "
              }
              if(Response["func_det"][Response["campos_det"][x]["Nombre"]][3][x3]["Funcion"] == " "){
                A_Select = A_Select + " " + Response["func_det"][Response["campos_det"][x]["Nombre"]][3][x3]["Origen"] + '.' + Response["func_det"][Response["campos_det"][x]["Nombre"]][3][x3]["Elemento"] + " "
              }
              if(Response["func_det"][Response["campos_det"][x]["Nombre"]][3][x3]["Funcion"] == "Suma"){
                 A_Select = A_Select + ' Sum(' + Response["func_det"][Response["campos_det"][x]["Nombre"]][3][x3]["Origen"] + '.' + Response["func_det"][Response["campos_det"][x]["Nombre"]][3][x3]["Elemento"] + ') '
                  A_Group = A_Group + Response["func_det"][Response["campos_det"][x]["Nombre"]][3][x3]["Origen"] + '.' + Response["func_det"][Response["campos_det"][x]["Nombre"]][3][x3]["Elemento"] + ', '
              }
              if(Response["func_det"][Response["campos_det"][x]["Nombre"]][3][x3]["Funcion"] == "Promedio"){
                A_Select = A_Select + ' Avg(' + Response["func_det"][Response["campos_det"][x]["Nombre"]][3][x3]["Origen"] + '.' + Response["func_det"][Response["campos_det"][x]["Nombre"]][3][x3]["Elemento"] + ') '
                A_Group = A_Group + Response["func_det"][Response["campos_det"][x]["Nombre"]][3][x3]["Origen"] + '.' + Response["func_det"][Response["campos_det"][x]["Nombre"]][3][x3]["Elemento"] + ', '
              }
              if(Response["func_det"][Response["campos_det"][x]["Nombre"]][3][x3]["Funcion"] == "Contar"){
                A_Select = A_Select + ' Count(' + Response["func_det"][Response["campos_det"][x]["Nombre"]][3][x3]["Origen"] + '.' + Response["func_det"][Response["campos_det"][x]["Nombre"]][3][x3]["Elemento"] + ') ' 
                A_Group = A_Group + Response["func_det"][Response["campos_det"][x]["Nombre"]][3][x3]["Origen"] + '.' + Response["func_det"][Response["campos_det"][x]["Nombre"]][3][x3]["Elemento"] + ', '            
              }
            }
          }
          if(A_Group == "Group by "){ A_Group = ""}else{A_Group = A_Group.slice(0,-2)}

          A_Select = A_Select + " ) as '" + Response["campos_det"][x]["Nombre"] + "' "
          if(A_Group == ""){
            if(A_GroupWhere == ""){
              sentencia = A_Select + " " + A_From + " " + A_Where 
            }else{
              sentencia = A_Select + " " + A_From + " " + A_Where + " " +  A_GroupWhere
            }
          }else{
            if(A_GroupWhere == ""){
              sentencia = A_Select + " " + A_From + " " + A_Where + " " + A_Group
            }else{
              sentencia = A_Select + " " + A_From + " " + A_Where + " " + A_Group + ", " + A_GroupWhere.replace("Group by ","")
            }
          }

          if(FaltaDato == true && Response["func_det"][Response["campos_det"][x]["Nombre"]][0][0]["Permite_nulo"] == "No"){document.getElementById(ID_TAG).value =  0
          }else{
            ID_TAG_resp = 'pd' + pestana_int + 'fff' + fila + 'ccc'+  Response["campos_det"][x]["Nombre"] + '';
            ID_TAG_nombre = Response["campos_det"][x]["Nombre"]
              $.ajax({
                type: 'POST',
                url: '/consolidado',
                data: {'fuente': $(this).attr("value"), 'csrfmiddlewaretoken': '{{ csrf_token }}', 'Id_empresa':'{{Id_empresa}}','cmpsenten': sentencia, 'tag1': ID_TAG_resp, 'tag2': ID_TAG_nombre, 'usuario':'{{usuario}}'},
                success: function(Response){
                  if(Response["cmpvalor"][0][Response["tag2"]] == null){
                    document.getElementById(Response["tag1"]).value =  0
                  }else{
                    document.getElementById(Response["tag1"]).value =  Response["cmpvalor"][0][Response["tag2"]]
                  }
                }
              });
          }
        }
        if (Response["campos_det"][x]["TablaCampo"] == "cmpnumeroaletras"){
         document.getElementById(ID_TAG).value =  numeroALetras(document.getElementById(ID_TAG).value);

        }
        if (Response["campos_det"][x]["TablaCampo"] == "cmpdecabecera"){
          id_cab = 'p' + pestana_int + 'zzz' + Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Campo"]
          document.getElementById(ID_TAG).value = document.getElementById(id_cab).value

        }
    }
    calcular_0(pestana_int)
}

function guardar_calcular(campo, tipo) {

  var cc_id = campo.id
  var res = cc_id.split("zzz");
  var cc_pesta = res[0].substring(1);
  var cc_nombre  = res[1]


  if(tipo==0){calcular_0(cc_pesta)}
}

function guardar_calcular_det(campo) {


  var cc_id = campo.id
  var res = cc_id.split("fff");
  var res2 = res[1].split("ccc");

  var cc_pesta = res[0].substring(2);
  var cc_fila = res2[0]
  var cc_nombre  = res2[1]
    
  calcular_detalle(cc_pesta, cc_fila)
}

function poner_valor_buscar_referencia_detalle(campo){
  var cc_id = campo.id
  var res = cc_id.split("fff");
  var res2 = res[1].split("ccc");

  var cc_pesta = res[0].substring(2);
  var cc_fila = res2[0]
  var cc_nombre  = res2[1]

  document.getElementById(campo.id).value = document.getElementById("vfinal_bus_2").value

  anexos = []

  Response = dict_pestalla['p-'+cc_pesta]

  for (x = 0; x <   Response["campos_det"].length; x++) {  
    if(Response["campos_det"][x]["TablaCampo"] == "cmpreferenciaadjunto"){
      if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["CampoReferencia"] == cc_nombre){
        ID_TAG = 'pd' + cc_pesta + 'fff' + cc_fila + 'ccc' + Response["campos_det"][x]["Nombre"]

        if(Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Tipo"] == "Imagen"){

          document.getElementById(ID_TAG + "_label").innerHTML = buscador_resultado[(document.getElementById("vfinal_bus").value-1)][Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Sentencia"]] 
          document.getElementById(ID_TAG + "_label").href = '/static/archivos/{{Id_empresa}}/'+ buscador_resultado[(document.getElementById("vfinal_bus").value-1)][Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Sentencia"]]
        
          document.getElementById(ID_TAG + "_img").src = '/static/archivos/{{Id_empresa}}/'+ buscador_resultado[(document.getElementById("vfinal_bus").value-1)][Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Sentencia"]] 

        }else{
          document.getElementById(ID_TAG).value = buscador_resultado[(document.getElementById("vfinal_bus").value-1)][Response["func_det"][Response["campos_det"][x]["Nombre"]][0]["Sentencia"]]
        }

            for (z2 = 0; z2 < Response["campos_det"].length; z2++) { 
              if(Response["campos_det"][z2]["TablaCampo"] == "cmpreferencia"){
                if(Response["func_det"][Response["campos_det"][z2]["Nombre"]][0][0]["predeterminado_valor"] == Response["campos_det"][x]["Nombre"]){
                  document.getElementById('pd' + pestalla +  'fff'+ cc_fila + 'ccc'+ Response["campos_det"][z2]["Nombre"]).value = document.getElementById(ID_TAG).value
                  anexos.push('pd' + pestalla +  'fff'+ cc_fila + 'ccc'+ Response["campos_det"][z2]["Nombre"])
                }
              }
            }



      }
    }
  } 

  for (zt = 0; zt < anexos.length; zt++) {  
     buscar_referencia_detalle_enter(document.getElementById(anexos[zt]))
  }

  calcular_detalle(cc_pesta, cc_fila)
}

function poner_valor_buscar_referencia_cabecera(campo){
  var cc_id = campo.id
  var res = cc_id.split("zzz");
  var cc_pesta = res[0].substring(1);
  var cc_nombre  = res[1]
  document.getElementById(campo.id).value = document.getElementById("vfinal_bus_2").value

  Response = dict_pestalla['p-'+cc_pesta]
  anexos = []
  for (x = 0; x < Response["campos_cab"].length; x++) {  
    if(Response["campos_cab"][x]["TablaCampo"] == "cmpreferenciaadjunto"){
      if(Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["CampoReferencia"] == cc_nombre){
        ID_TAG = 'p' + cc_pesta + 'zzz' + Response["campos_cab"][x]["Nombre"]
        document.getElementById(ID_TAG).value = buscador_resultado[(document.getElementById("vfinal_bus").value-1)][Response["func_cab"][Response["campos_cab"][x]["Nombre"]][0]["Sentencia"]]


        for (z2 = 0; z2 < Response["campos_cab"].length; z2++) { 
          if(Response["campos_cab"][z2]["TablaCampo"] == "cmpreferencia" ){
            if(Response["func_cab"][Response["campos_cab"][z2]["Nombre"]][0][0]["predeterminado_valor"] ==  Response["campos_cab"][x]["Nombre"]){
              document.getElementById('p' + pestalla + 'zzz' + Response["campos_cab"][z2]["Nombre"]).value = document.getElementById(ID_TAG).value
              anexos.push('p' + pestalla + 'zzz' + Response["campos_cab"][z2]["Nombre"])
            }
          }
        }


      }
    }
  } 

  if(Response["func_cab"][cc_nombre][2].length > 0){
    if(Response["func_cab"][cc_nombre][2][0]["Adicionar_registros"] == "Si"){
      A_Select = "Select "
      A_From = "From "
      A_Where = "Where "
      A_Group = "Group by "
      A_GroupWhere = "Group by "
      sentencia = ""
      A_extra = ""
      FaltaDato = false

      for (x = 0; x < Response["func_cab"][cc_nombre][3][0][0].length; x++) {
        A_extra = " " + Response["func_cab"][cc_nombre][3][0][0][x]["Elemento"] + " "
      }
      for (x = 0; x < Response["func_cab"][cc_nombre][3][0][1].length; x++) {
        A_From = A_From + " " + Response["func_cab"][cc_nombre][3][0][1][x]["Tabla"] + " as " + Response["func_cab"][cc_nombre][3][0][1][x]["Nombre"] + ", "      
      }
      if(A_From == "From "){A_From = ""}else{A_From = A_From.slice(0,-2)}
      for (x = 0; x < Response["func_cab"][cc_nombre][3][0][2].length; x++) {
        if(Response["func_cab"][cc_nombre][3][0][2][x]["Tipo"] == "Valor"){
          A_Where = A_Where + " '" + Response["func_cab"][cc_nombre][3][0][2][x]["Elemento"] + "' "
        }
        if(Response["func_cab"][cc_nombre][3][0][2][x]["Tipo"] == "Operacion"){
          A_Where = A_Where + " " + Response["func_cab"][cc_nombre][3][0][2][x]["Elemento"] + " "
        }
        if(Response["func_cab"][cc_nombre][3][0][2][x]["Tipo"] == "Registro"){
          ID_TAG_where = 'p' + cc_pesta + 'zzz' + Response["func_cab"][cc_nombre][3][0][2][x]["Elemento"]
          if(document.getElementById(ID_TAG_where).value == ""){FaltaDato = true}
          A_Where = A_Where + " '" + document.getElementById(ID_TAG_where).value + "' "
        }
        if(Response["func_cab"][cc_nombre][3][0][2][x]["Tipo"] == "Campo"){
          if(Response["func_cab"][cc_nombre][3][0][2][x]["Funcion"] =="" ){
            A_Where = A_Where + " " + Response["func_cab"][cc_nombre][3][0][2][x]["Origen"] + "." + Response["func_cab"][cc_nombre][3][0][2][x]["Elemento"] + " "
          }
          if(Response["func_cab"][cc_nombre][3][0][2][x]["Funcion"] =="Suma" ){
            A_Where = A_Where + " Sum(" + Response["func_cab"][cc_nombre][3][0][2][x]["Origen"] + "." + Response["func_cab"][cc_nombre][3][0][2][x]["Elemento"] + ") "
            A_GroupWhere = A_GroupWhere + Response["func_cab"][cc_nombre][3][0][2][x]["Grupo"] + ", "
          }
          if(Response["func_cab"][cc_nombre][3][0][2][x]["Funcion"] =="Promedio" ){
            A_Where = A_Where + "Avg(" + Response["func_cab"][cc_nombre][3][0][2][x]["Origen"] + "." + Response["func_cab"][cc_nombre][3][0][2][x]["Elemento"] + ") "
            A_GroupWhere = A_GroupWhere + Response["func_cab"][cc_nombre][3][0][2][x]["Grupo"] + ", "
          }
          if(Response["func_cab"][cc_nombre][3][0][2][x]["Funcion"] =="Contar" ){
            A_Where = A_Where + "Count(" + Response["func_cab"][cc_nombre][3][0][2][x]["Origen"] + "." + Response["func_cab"][cc_nombre][3][0][2][x]["Elemento"] + ") "
            A_GroupWhere = A_GroupWhere + Response["func_cab"][cc_nombre][3][0][2][x]["Grupo"] + ", "
          }
        }
      }
      for (x = 0; x < Response["func_cab"][cc_nombre][3][0][3].length; x++) {

        A_Select = A_Select + "CAST( "
        for (x2 = 0; x2 < Response["func_cab"][cc_nombre][3][0][4][x].length; x2++) {
          if(Response["func_cab"][cc_nombre][3][0][4][x][x2]["Tipo"] == "Valor"){
            A_Select = A_Select + " '" + Response["func_cab"][cc_nombre][3][0][4][x][x2]["Elemento"] + "' "
          } 
          if(Response["func_cab"][cc_nombre][3][0][4][x][x2]["Tipo"] == "Operacion"){
            A_Select = A_Select + " " + Response["func_cab"][cc_nombre][3][0][4][x][x2]["Elemento"] + " "
          } 
          if(Response["func_cab"][cc_nombre][3][0][4][x][x2]["Tipo"] == "Registro"){
            ID_TAG_selec = 'p' + cc_pesta + 'zzz' + Response["func_cab"][cc_nombre][3][0][4][x][x2]["Elemento"]
            if(document.getElementById(ID_TAG_where).value == ""){FaltaDato = true}
            A_Select = A_Select + " '" + Response["func_cab"][cc_nombre][3][0][4][x][x2]["Elemento"] + "' "
          } 
          if(Response["func_cab"][cc_nombre][3][0][4][x][x2]["Tipo"] == "Campo"){
            if(Response["func_cab"][cc_nombre][3][0][4][x][x2]["Funcion"] == ""){
              A_Select = A_Select + " " + Response["func_cab"][cc_nombre][3][0][4][x][x2]["Origen"] + "." + Response["func_cab"][cc_nombre][3][0][4][x][x2]["Elemento"] + " "
            } 
            if(Response["func_cab"][cc_nombre][3][0][4][x][x2]["Funcion"] == "Suma"){
              A_Select = A_Select + " Sum(" + Response["func_cab"][cc_nombre][3][0][4][x][x2]["Origen"] + "." + Response["func_cab"][cc_nombre][3][0][4][x][x2]["Elemento"] + ") "    
              if(Response["func_cab"][cc_nombre][3][0][4][x][x2]["groupby"] != ""){
                A_Group = A_Group + Response["func_cab"][cc_nombre][3][0][4][x][x2]["groupby"] + ", "
              }     
            } 
            if(Response["func_cab"][cc_nombre][3][0][4][x][x2]["Funcion"] == "Promedio"){
              A_Select = A_Select + " Avg(" + Response["func_cab"][cc_nombre][3][0][4][x][x2]["Origen"] + "." + Response["func_cab"][cc_nombre][3][0][4][x][x2]["Elemento"] + ") "
              if(Response["func_cab"][cc_nombre][3][0][4][x][x2]["groupby"] != ""){
                A_Group = A_Group + Response["func_cab"][cc_nombre][3][0][4][x][x2]["groupby"] + ", "
              }
            } 
            if(Response["func_cab"][cc_nombre][3][0][4][x][x2]["Funcion"] == "Contar"){
              A_Select = A_Select + " Count(" + Response["func_cab"][cc_nombre][3][0][4][x][x2]["Origen"] + "." + Response["func_cab"][cc_nombre][3][0][4][x][x2]["Elemento"] + ") "
              if(Response["func_cab"][cc_nombre][3][0][4][x][x2]["groupby"] != ""){
                A_Group = A_Group + Response["func_cab"][cc_nombre][3][0][4][x][x2]["groupby"] + ", "
              }
            } 
          } 
        }
        A_Select = A_Select + " as char) as '" + Response["func_cab"][cc_nombre][3][0][3][x]["Nombre"] +  "', "
      }
      A_Select = A_Select.slice(0,-2)
      if(A_Group != "Group by "){
        A_Group = A_Group.slice(0,-2)
      }

      if(A_Group == "Group by "){
        if(A_GroupWhere == "Group by "){
          if(A_Where == "Where "){
            sentencia = A_Select + " " + A_From
          }else{
            sentencia = A_Select + " " + A_From + " " + A_Where
          }
        }else{
          if(A_Where == "Where "){
            sentencia = A_Select + " " + A_From + " " + A_GroupWhere
          }else{
            sentencia = A_Select + " " + A_From + " " + A_Where + " " + A_GroupWhere
          }
        }
      }else{
        if(A_GroupWhere == "Group by "){
          if(A_Where == "Where "){
            sentencia = A_Select + " " + A_From + " " + A_Group
          }else{
            sentencia = A_Select + " " + A_From + " " + A_Where + " " + A_Group
          }
        }else{
          if(A_Where == "Where "){
            sentencia = A_Select + " " + A_From + " " +  A_Group + ", " + A_GroupWhere.slice(8).ToString
          }else{
            sentencia = A_Select + " " + A_From + " " + A_Where + " " +  A_Group + ", " + A_GroupWhere.slice(8).ToString
          }
        }
      }
      $.ajax({
        type: 'POST',
        url: '/consolidado',
        data: {'fuente': $(this).attr("value"), 'csrfmiddlewaretoken': '{{ csrf_token }}', 'Id_empresa':'{{Id_empresa}}','cmpsenten': sentencia, 'tag1': 'tag1', 'tag2': 'tag2', 'usuario':'{{usuario}}'},
        success: function(Response){

          for (xq = 0; xq < (cc_porPesta["p-" + cc_pesta]+2); xq++) {
            menos(cc_pesta, xq, 1)
          }

          for (xq = 0; xq < Response["cmpvalor"].length; xq++) {
            mas(cc_pesta)
            for (xq2 = 0; xq2 < Object.keys(Response['cmpvalor'][xq]).length; xq2++) {
              id_tag_det = 'pd' + cc_pesta + 'fff' + cc_porPesta["p-" + cc_pesta] + 'ccc' + Object.keys(Response['cmpvalor'][xq])[xq2]     
              if(dict_pestalla['p-' +cc_pesta]["func_det"][ Object.keys(Response['cmpvalor'][xq])[xq2]][0]["Tipo"] == "Imagen"){

                      document.getElementById(id_tag_det + "_label").innerHTML = Response['cmpvalor'][xq][Object.keys(Response['cmpvalor'][xq])[xq2]]   
                      document.getElementById(id_tag_det + "_label").href = '/static/archivos/{{Id_empresa}}/'+ Response['cmpvalor'][xq][Object.keys(Response['cmpvalor'][xq])[xq2]]   
                    
                      document.getElementById(id_tag_det + "_img").src = '/static/archivos/{{Id_empresa}}/'+ Response['cmpvalor'][xq][Object.keys(Response['cmpvalor'][xq])[xq2]]   




              }else{
                document.getElementById(id_tag_det).value  = Response['cmpvalor'][xq][Object.keys(Response['cmpvalor'][xq])[xq2]]   
              }
            }
          }
        calcular_0(cc_pesta)
        } 
      });
    }
  }         


  for (zt = 0; zt < anexos.length; zt++) {  

     buscar_referencia_cabecera_enter(document.getElementById(anexos[zt]))
  }
}

function poner_valor_buscar_referencia_reporte(campo){
  var cc_id = campo.id
  var res = cc_id.split("zz");
  var cc_pesta = res[1];
  var cc_nombre  = res[3]
  document.getElementById(campo.id).value = document.getElementById("vfinal_bus_2").value + "%"
 
  //id="rpzz'+ pestalla +'zz'+ x +'zz'+Response['referencias_reprotes'][x]["id"] +'" 
  //Response = dict_pestalla['p-'+cc_pesta]
}

function doble_click_buscador_rep(campo, x){
  selecctt_buscador(x)
  var btn = document.getElementById("c_modal_ref_rep")
  btn.click()
}

function doble_click_buscador_cad(campo, x){
  selecctt_buscador(x)
  var btn = document.getElementById("c_modal_ref_cab")
  btn.click()
}

function doble_click_buscador_det(campo, x){
  selecctt_buscador(x)
  var btn = document.getElementById("c_modal_ref_det")
  btn.click()
}

function filtrar_buscar_rep(id_campo_busc, pkcampo){

  //sentencia2 = "select * from (" + document.getElementById("buscador_senten").value + ") int_ress where "  + document.getElementById("busca_campo").value + " like '" + document.getElementById("busca_valor").value + "%'"

  cmpsenten= document.getElementById("buscador_senten").value
  valor_filtro = document.getElementById("busca_valor").value
   $.ajax({
          type: 'POST',
          url: '/buscador_filt_rep',
          data: {'fuente': $(this).attr("value"), 'csrfmiddlewaretoken': '{{ csrf_token }}', 'Id_empresa':'{{Id_empresa}}','cmpsenten':cmpsenten, 'usuario':'{{usuario}}', 'pkcampo':pkcampo, 'valor_filtro':valor_filtro, 'id_campo_busc':id_campo_busc.id},
          success: function(Response){

            var campo = document.getElementById(Response['id_campo_busc'][0]) 

            buscador_resultado = Response['cmpvalor']

            data_int = '<div class="panel-body" style="overflow: auto;"><table style="cursor: pointer;font-size: 11px;" width="100%" class="table table-striped table-bordered table-hover" id="dataTables-example"><thead><tr>'
            data_int = data_int + '<th style="display: none;">' + Response['nombre'] + '</th>'

            for (x = 0; x < Object.keys(Response['cmpvalor'][0]).length; x++) {
              data_int = data_int + '<th>' + Object.keys(Response['cmpvalor'][0])[x] + '</th>'

            }
            data_int = data_int + '</tr></thead><tbody>'
            for (x = 0; x < Response['cmpvalor'].length; x++) {
              data_int = data_int + '<tr onclick="doble_click_buscador_rep(' + campo +', this)">'
              data_int = data_int + '<td style="display: none;">' + Response['cmpvalor'][x][Response['nombre']] + '</td>'

              for (x2 = 0; x2 < Object.keys(Response['cmpvalor'][x]).length; x2++) {
                data_int = data_int + '<td>' + Response['cmpvalor'][x][Object.keys(Response['cmpvalor'][x])[x2]] + '</td>'
              }
              data_int = data_int + '</tr>'
            }
            data_int = data_int + '</tbody></table></div>'
            $('#buscador_int').html(data_int);
          } 
        });
}

function filtrar_buscar(id_campo_busc, pkcampo){

  //sentencia2 = "select * from (" + document.getElementById("buscador_senten").value + ") int_ress where "  + document.getElementById("busca_campo").value + " like '" + document.getElementById("busca_valor").value + "%'"

  cmpsenten= document.getElementById("buscador_senten").value
  valor_filtro = document.getElementById("busca_valor").value
   $.ajax({
          type: 'POST',
          url: '/buscador_filtro',
          data: {'fuente': $(this).attr("value"), 'csrfmiddlewaretoken': '{{ csrf_token }}', 'Id_empresa':'{{Id_empresa}}','cmpsenten':cmpsenten, 'usuario':'{{usuario}}', 'pkcampo':pkcampo, 'valor_filtro':valor_filtro, 'id_campo_busc':id_campo_busc.id},
          success: function(Response){

            var campo = document.getElementById(Response['id_campo_busc'][0]) 

            buscador_resultado = Response['cmpvalor']

            data_int = '<div class="panel-body" style="overflow: auto;"><table style="cursor: pointer;font-size: 11px;" width="100%" class="table table-striped table-bordered table-hover" id="dataTables-example"><thead><tr>'
            data_int = data_int + '<th style="display: none;">' + Response['nombre'] + '</th>'

            for (x = 0; x < Object.keys(Response['cmpvalor'][0]).length; x++) {
              data_int = data_int + '<th>' + Object.keys(Response['cmpvalor'][0])[x] + '</th>'

            }
            data_int = data_int + '</tr></thead><tbody>'
            for (x = 0; x < Response['cmpvalor'].length; x++) {
              data_int = data_int + '<tr onclick="doble_click_buscador_cad(' + campo +', this)">'
              data_int = data_int + '<td style="display: none;">' + Response['cmpvalor'][x][Response['nombre']] + '</td>'

              for (x2 = 0; x2 < Object.keys(Response['cmpvalor'][x]).length; x2++) {
                data_int = data_int + '<td>' + Response['cmpvalor'][x][Object.keys(Response['cmpvalor'][x])[x2]] + '</td>'
              }
              data_int = data_int + '</tr>'
            }
            data_int = data_int + '</tbody></table></div>'
            $('#buscador_int').html(data_int);
          } 
        });
}

function filtrar_buscar_det(id_campo_busc, pkcampo){

  //sentencia2 = "select * from (" + document.getElementById("buscador_senten").value + ") int_ress where "  + document.getElementById("busca_campo").value + " like '" + document.getElementById("busca_valor").value + "%'"

  cmpsenten= document.getElementById("buscador_senten").value
  valor_filtro = document.getElementById("busca_valor").value
   $.ajax({
          type: 'POST',
          url: '/buscador_filtro',
          data: {'fuente': $(this).attr("value"), 'csrfmiddlewaretoken': '{{ csrf_token }}', 'Id_empresa':'{{Id_empresa}}','cmpsenten':cmpsenten, 'usuario':'{{usuario}}', 'pkcampo':pkcampo, 'valor_filtro':valor_filtro, 'id_campo_busc':id_campo_busc.id},
          success: function(Response){

            var campo = document.getElementById(Response['id_campo_busc'][0]) 

            buscador_resultado = Response['cmpvalor']

            data_int = '<div class="panel-body" style="overflow: auto;"><table style="cursor: pointer;font-size: 11px;" width="100%" class="table table-striped table-bordered table-hover" id="dataTables-example"><thead><tr>'
            data_int = data_int + '<th style="display: none;">' + Response['nombre'] + '</th>'

            for (x = 0; x < Object.keys(Response['cmpvalor'][0]).length; x++) {
              data_int = data_int + '<th>' + Object.keys(Response['cmpvalor'][0])[x] + '</th>'

            }
            data_int = data_int + '</tr></thead><tbody>'
            for (x = 0; x < Response['cmpvalor'].length; x++) {
              data_int = data_int + '<tr  onclick="doble_click_buscador_det(' + campo +', this)">'
              data_int = data_int + '<td style="display: none;">' + Response['cmpvalor'][x][Response['nombre']] + '</td>'

              for (x2 = 0; x2 < Object.keys(Response['cmpvalor'][x]).length; x2++) {

                  if(Object.keys(Response['cmpvalor'][x])[x2] == 'imagen'){
                    data_int = data_int + '<td><div class="thumbnail" style="height: 100px;margin-bottom: 1px;"><div class="image view view-first"><img style="width: 80%;height: 60%; display: block;" src="/static/archivos/{{Id_empresa}}/' + Response['cmpvalor'][x][Object.keys(Response['cmpvalor'][x])[x2]] + '" alt="image"><a href="/static/archivos/{{Id_empresa}}/' + Response['cmpvalor'][x][Object.keys(Response['cmpvalor'][x])[x2]] + '" target="_blank">' + Response['cmpvalor'][x][Object.keys(Response['cmpvalor'][x])[x2]] + '</a></div></div></td>'
                  }else{
                    data_int = data_int + '<td>' + Response['cmpvalor'][x][Object.keys(Response['cmpvalor'][x])[x2]] + '</td>'
                  }
              }
              data_int = data_int + '</tr>'
            }
            data_int = data_int + '</tbody></table></div>'
            $('#buscador_int').html(data_int);
          } 
        });
}

var buscador_resultado = []

function buscar_referencia_reporte(campo){
  var cc_id = campo.id
  var res = cc_id.split("zz");
  var cc_pesta = res[1]
  var cc_indi = res[2]
  var cc_id_ref  = res[3]

  Response = dict_pestalla['p-'+cc_pesta]


  where = " "
  columnas = Response["referencias_reprotes"][cc_indi]["columnas"]
  campo = Response["referencias_reprotes"][cc_indi]["campo"]
  dato = document.getElementById(cc_id).value
  tabla = Response["referencias_reprotes"][cc_indi]["tabla"]
  orderby = " order by pk" + Response["referencias_reprotes"][cc_indi]["tabla"] + " desc "

  PkCampo = Response["referencias_reprotes"][cc_indi]["id"] 

    cmpsenten = "select " + columnas + ' from ' + tabla + ' ' 

        $.ajax({
          type: 'POST',
          url: '/buscador',
          data: {'fuente': $(this).attr("value"), 'csrfmiddlewaretoken': '{{ csrf_token }}', 'Id_empresa':'{{Id_empresa}}','cmpsenten': cmpsenten, 'usuario':'{{usuario}}', 'PkCampo':PkCampo},
          success: function(Response){
            buscador_resultado = Response['cmpvalor']
            data_int= '<div class="row"><div class="col-lg-12" >'
            document.getElementById("buscador_senten").value = cmpsenten
           
            data_int = data_int +'<input class="form-control" id="busca_valor" placeholder="Escriba para filtrar" onkeypress="return runScript_buscador_rep(event, ' + cc_id +', '+Response['PkCampo']+')"></div></div>'


            data_int = data_int + '<div class="modal-footer"><button type="button" class="btn btn-primary" data-dismiss="modal" onclick="poner_valor_buscar_referencia_reporte(' + cc_id +')" id="c_modal_ref_rep" style="display: none;"></button></div>'

        
            data_int = data_int + '<div id="buscador_int" style="overflow: auto;">'

            data_int = data_int + '<div class="panel-body" ><table style="cursor: pointer;font-size: 11px;" width="100%" class="table table-striped table-bordered table-hover" id="dataTables-example"><thead><tr>'
              data_int = data_int + '<th style="display: none;">' + campo + '</th>'


            for (x = 0; x < Object.keys(Response['cmpvalor'][0]).length; x++) {
              data_int = data_int + '<th>' + Object.keys(Response['cmpvalor'][0])[x] + '</th>'

            }
            data_int = data_int + '</tr></thead><tbody>'



              for (x = 0; x < Response['cmpvalor'].length; x++) {
                data_int = data_int + '<tr onclick="doble_click_buscador_rep(' + cc_id +', this)">'
                data_int = data_int + '<td style="display: none;">' + Response['cmpvalor'][x][campo] + '</td>'

                for (x2 = 0; x2 < Object.keys(Response['cmpvalor'][x]).length; x2++) {
                  data_int = data_int + '<td>' + Response['cmpvalor'][x][Object.keys(Response['cmpvalor'][x])[x2]] + '</td>'
                }
                data_int = data_int + '</tr>'
              }
        
            data_int = data_int + '</tbody></table></div>'

            data_int = data_int + '</div>'

            data_int = data_int + '<div class="modal-footer"></div>'

              $('#intbuscador').html(data_int);
          }
          });

    
}


function buscar_referencia_cabecera(campo){
  var cc_id = campo.id
  var res = cc_id.split("zzz");
  var cc_pesta = res[0].substring(1);
  var cc_nombre  = res[1]

  Response = dict_pestalla['p-'+cc_pesta]


  where = " "
  modo = Response["func_cab"][cc_nombre][0][0]["Modo"]
  columnas = Response["func_cab"][cc_nombre][0][0]["Columnas"]
  campo = Response["func_cab"][cc_nombre][0][0]["Sentencia"]
  dato = document.getElementById(cc_id).value
  tabla = Response["func_cab"][cc_nombre][0][0]["TablaOrigen"]
  orderby = " order by pk" + Response["func_cab"][cc_nombre][0][0]["TablaOrigen"] + " desc "
  PkCampo = Response["func_cab"][cc_nombre][0][0]["PkCampo"]

  for (x = 0; x <   Response["func_cab"][cc_nombre][1].length; x++) {   

    ElementoA = ""
    ElementoB = ""
    
    if(Response["func_cab"][cc_nombre][1][x]["TipoA"] == "R"){
      id_ext = 'p' + cc_pesta + 'zzz' + Response["func_cab"][cc_nombre][1][x]["ElementoA"] 
      ElementoA = "'" + document.getElementById(id_ext).value + "'"
    }
    if(Response["func_cab"][cc_nombre][1][x]["TipoA"] == "V"){
      ElementoA = " '" +Response["func_cab"][cc_nombre][1][x]["ElementoA"] + "'"
    }
    if(Response["func_cab"][cc_nombre][1][x]["TipoA"] == "C"){
      ElementoA = Response["func_cab"][cc_nombre][1][x]["ElementoA"]
    }

    if(Response["func_cab"][cc_nombre][1][x]["TipoB"] == "R"){
      id_ext = 'p' + cc_pesta + 'zzz' + Response["func_cab"][cc_nombre][1][x]["ElementoB"] 
      ElementoB = "'" + document.getElementById(id_ext).value + "'"
    }
    if(Response["func_cab"][cc_nombre][1][x]["TipoB"] == "V"){
      ElementoB = "'" + Response["func_cab"][cc_nombre][1][x]["ElementoB"] + "'"
    }
    if(Response["func_cab"][cc_nombre][1][x]["TipoB"] == "C"){
      ElementoB = Response["func_cab"][cc_nombre][1][x]["ElementoB"]
    }

    where = where + ElementoA + ' ' + Response["func_cab"][cc_nombre][1][x]["Operador"]  + ' ' + ElementoB +  ' and '
  }
  if (where == " "){where = ""}else{where = 'where ' + where.slice(0,-4)}

  cmpsenten = "select " + columnas + ' from ' + tabla + ' ' + where

        $.ajax({
          type: 'POST',
          url: '/buscador',
          data: {'fuente': $(this).attr("value"), 'csrfmiddlewaretoken': '{{ csrf_token }}', 'Id_empresa':'{{Id_empresa}}','cmpsenten': cmpsenten, 'usuario':'{{usuario}}', 'PkCampo':PkCampo},
          success: function(Response){

            if(Response['cmpvalor'].length == 0){
              //data_int = '<div class="col-lg-3">No existen datos</div>'
              data_int = 'No existen datos'

            }else{
              buscador_resultado = Response['cmpvalor']
              data_int= '<div class="row"><div class="col-lg-12" >'
              //'<select class="form-control" id="busca_campo">'
              //for (x = 0; x <   Object.keys(Response['cmpvalor'][0]).length; x++) {
              //  data_int = data_int + '<option>' + Object.keys(Response['cmpvalor'][0])[x] + '</option>'
                
              //} 
              document.getElementById("buscador_senten").value = cmpsenten
               //'</select>'
              data_int = data_int +'<input class="form-control" id="busca_valor" placeholder="Escriba para filtrar" onkeypress="return runScript_buscador_cab(event, ' + cc_id +', '+Response['PkCampo']+')"></div></div>'
              
              data_int = data_int + '<div class="modal-footer"><button type="button" class="btn btn-primary" data-dismiss="modal" onclick="poner_valor_buscar_referencia_cabecera(' + cc_id +')" id="c_modal_ref_cab" style="display: none;"></button></div>'

              data_int = data_int + '<div id="buscador_int" style="overflow: auto;">'
              data_int = data_int + '<div class="panel-body" ><table style="cursor: pointer;font-size: 11px;" width="100%" class="table table-striped table-bordered table-hover" id="dataTables-example"><thead><tr>'
              data_int = data_int + '<th style="display: none;">' + campo + '</th>'

              for (x = 0; x < Object.keys(Response['cmpvalor'][0]).length; x++) {
                data_int = data_int + '<th>' + Object.keys(Response['cmpvalor'][0])[x] + '</th>'
              }
              data_int = data_int + '</tr></thead><tbody>'


              for (x = 0; x < Response['cmpvalor'].length; x++) {
                data_int = data_int + '<tr onclick="doble_click_buscador_cad(' + cc_id +', this)">'
                data_int = data_int + '<td style="display: none;">' + Response['cmpvalor'][x][campo] + '</td>'

                for (x2 = 0; x2 < Object.keys(Response['cmpvalor'][x]).length; x2++) {
                  data_int = data_int + '<td>' + Response['cmpvalor'][x][Object.keys(Response['cmpvalor'][x])[x2]] + '</td>'
                }
                data_int = data_int + '</tr>'
              }
          
              data_int = data_int + '</tbody></table></div>'

              data_int = data_int + '</div>'

              data_int = data_int + '<div class="modal-footer"></div>'
            }
         


            $('#intbuscador').html(data_int);

          }
          });
}

function buscar_referencia_detalle(campo){
  var cc_id = campo.id
  var res = cc_id.split("fff");
  var res2 = res[1].split("ccc");

  var cc_pesta = res[0].substring(2);
  var cc_fila = res2[0]
  var cc_nombre  = res2[1]

  Response = dict_pestalla['p-'+cc_pesta]

  PkCampo = Response["func_det"][cc_nombre][0][0]["PkCampo"]

  where = " "
  modo = Response["func_det"][cc_nombre][0][0]["Modo"]
  columnas = Response["func_det"][cc_nombre][0][0]["Columnas"]
  campo = Response["func_det"][cc_nombre][0][0]["Sentencia"]
  dato = document.getElementById(cc_id).value
  tabla = Response["func_det"][cc_nombre][0][0]["TablaOrigen"]
  orderby = " order by pk" + Response["func_det"][cc_nombre][0][0]["TablaOrigen"] + " desc "


  for (x = 0; x <   Response["func_det"][cc_nombre][1].length; x++) {   

    ElementoA = ""
    ElementoB = ""
    
    if(Response["func_det"][cc_nombre][1][x]["TipoA"] == "R"){
      id_ext = 'p' + cc_pesta + 'zzz' + Response["func_det"][cc_nombre][1][x]["ElementoA"] 
      ElementoA = "'" + document.getElementById(id_ext).value + "'"
    }
    if(Response["func_det"][cc_nombre][1][x]["TipoA"] == "V"){
      ElementoA = "'" +Response["func_det"][cc_nombre][1][x]["ElementoA"] + "'"
    }
    if(Response["func_det"][cc_nombre][1][x]["TipoA"] == "C"){
      ElementoA = Response["func_det"][cc_nombre][1][x]["ElementoA"]
    }

    if(Response["func_det"][cc_nombre][1][x]["TipoB"] == "R"){
      id_ext = 'p' + cc_pesta + 'zzz' + Response["func_det"][cc_nombre][1][x]["ElementoB"] 
      ElementoB = "'" + document.getElementById(id_ext).value + "'"
    }
    if(Response["func_det"][cc_nombre][1][x]["TipoB"] == "V"){
      ElementoB = "'" + Response["func_det"][cc_nombre][1][x]["ElementoB"] + "'"
    }
    if(Response["func_det"][cc_nombre][1][x]["TipoB"] == "C"){
      ElementoB = Response["func_det"][cc_nombre][1][x]["ElementoB"]
    }

    where = where + ElementoA + ' ' + Response["func_det"][cc_nombre][1][x]["Operador"]  + ' ' + ElementoB +  ' and '
  }
  if (where == " "){where = ""}else{where = 'where ' + where.slice(0,-4)}

    cmpsenten = "select " + columnas + ' from ' + tabla + ' ' + where

        $.ajax({
          type: 'POST',
          url: '/buscador',
          data: {'fuente': $(this).attr("value"), 'csrfmiddlewaretoken': '{{ csrf_token }}', 'Id_empresa':'{{Id_empresa}}','cmpsenten': cmpsenten, 'usuario':'{{usuario}}', 'PkCampo':PkCampo},
          success: function(Response){

            if(Response['cmpvalor'].length == 0){
              //data_int = '<div class="col-lg-3">No existen datos</div>'
              data_int = 'No existen datos'

            }else{
              buscador_resultado = Response['cmpvalor']

              data_int= '<div class="row"><div class="col-lg-12">'
              //'<select class="form-control" id="busca_campo">'
              //for (x = 0; x <   Object.keys(Response['cmpvalor'][0]).length; x++) {
                //data_int = data_int + '<option>' + Object.keys(Response['cmpvalor'][0])[x] + '</option>'
                
              //} 
              document.getElementById("buscador_senten").value = cmpsenten
              //data_int = data_int + '</select>'
              data_int = data_int +'<input class="form-control" id="busca_valor" placeholder="Escriba para filtrar" onkeypress="return runScript_buscador_det(event, ' + cc_id +', '+Response['PkCampo']+')"></div></div>'

              //'<button class="btn btn-primary" onclick="filtrar_buscar(' + cc_id +')"><span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></button>'
            
             data_int = data_int + '<div class="modal-footer"><button type="button" class="btn btn-primary" data-dismiss="modal" onclick="poner_valor_buscar_referencia_detalle(' + cc_id +')" id="c_modal_ref_det" style="display: none;"></button></div>'


              data_int = data_int + '<div id="buscador_int" style="overflow: auto;">'
              data_int = data_int + '<div class="panel-body"><table style="cursor: pointer;font-size: 11px;" width="100%" class="table table-striped table-bordered table-hover" id="dataTables-example"><thead><tr>'
              data_int = data_int + '<th style="display: none;">' + campo + '</th>'

              for (x = 0; x < Object.keys(Response['cmpvalor'][0]).length; x++) {
                data_int = data_int + '<th>' + Object.keys(Response['cmpvalor'][0])[x] + '</th>'

              }
              data_int = data_int + '</tr></thead><tbody>'

              for (x = 0; x < Response['cmpvalor'].length; x++) {
                data_int = data_int + '<tr onclick="doble_click_buscador_det(' + cc_id +', this)" >'
                data_int = data_int + '<td style="display: none;">' + Response['cmpvalor'][x][campo] + '</td>'
                for (x2 = 0; x2 < Object.keys(Response['cmpvalor'][x]).length; x2++) {

                  if(Object.keys(Response['cmpvalor'][x])[x2] == 'imagen'){
                    data_int = data_int + '<td><div class="thumbnail" style="height: 100px;margin-bottom: 1px;"><div class="image view view-first"><img style="width: 80%;height: 60%; display: block;" src="/static/archivos/{{Id_empresa}}/' + Response['cmpvalor'][x][Object.keys(Response['cmpvalor'][x])[x2]] + '" alt="image"><a href="/static/archivos/{{Id_empresa}}/' + Response['cmpvalor'][x][Object.keys(Response['cmpvalor'][x])[x2]] + '" target="_blank">' + Response['cmpvalor'][x][Object.keys(Response['cmpvalor'][x])[x2]] + '</a></div></div></td>'
                  }else{
                    data_int = data_int + '<td>' + Response['cmpvalor'][x][Object.keys(Response['cmpvalor'][x])[x2]] + '</td>'
                  }



                }
                data_int = data_int + '</tr>'
              }
          
                data_int = data_int + '</tbody></table></div>'          
                data_int = data_int + '</div>'
                data_int = data_int + '<div class="modal-footer"></div>'

        }

            $('#intbuscador').html(data_int);

          }
          });
}



function registro(pkmodulo, pkregistro, tipo, temp_pestalla) {

        pestalla = pestalla +1;

        if(temp_pestalla == 'consulta'){
            $("#myTab").prepend('<li role="presentation" class="" id="li' + pestalla + '"><a href="#rr' + pestalla + '" id="id' + pestalla + '" role="tab" data-toggle="tab" aria-expanded="false">Consulta</a></li>');
        }else{
          if(dict_pestalla['p-'+temp_pestalla]["tabla_cab"] == undefined){
           $("#myTab").prepend('<li role="presentation" class="" id="li' + pestalla + '"><a href="#rr' + pestalla + '" id="id' + pestalla + '" role="tab" data-toggle="tab" aria-expanded="false">' + dict_pestalla['p-'+temp_pestalla]["tabla"][0]["Descripcion"] + '</a></li>');
        }else{

          $("#myTab").prepend('<li role="presentation" class="" id="li' + pestalla + '"><a href="#rr' + pestalla + '" id="id' + pestalla + '" role="tab" data-toggle="tab" aria-expanded="false">' +  dict_pestalla['p-'+temp_pestalla]["tabla_cab"]["Descripcion"] + '</a></li>');
        }
        }
        


        var id_tab = pkmodulo
        if(tipo == 0){tipo = 'Nuevo'}
        if(tipo == 1){tipo = 'modificar'}
        if(tipo == 2){tipo = 'consulta'}


div_opcio = ''

div_opcio = div_opcio + '<div class="col-md-55"><div class=""><div class="image view view-first"><img style="width: 100%; display: block;" src="images/media.jpg" alt="image"></div><div class="caption" style="height: 100px;"><p><strong>Estilo</strong></p><p>Cambiar posicion y tamaño de campos</p></div><button class="btn btn-primary" onclick="algo()" style="width: 100%;"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></button></div></div>'

div_opcio = div_opcio + '<div class="col-md-55"><div class=""><div class="image view view-first"><img style="width: 100%; display: block;" src="images/media.jpg" alt="image"></div><div class="caption" style="height: 100px;"><p><strong>Estilo</strong></p><p>Cambiar posicion y tamaño de campos</p></div><button class="btn btn-primary" onclick="algo()" style="width: 100%;"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></button></div></div>'

div_opcio = div_opcio + '<div class="col-md-55"><div class=""><div class="image view view-first"><img style="width: 100%; display: block;" src="images/media.jpg" alt="image"></div><div class="caption" style="height: 100px;"><p><strong>Estilo</strong></p><p>Cambiar posicion y tamaño de campos</p></div><button class="btn btn-primary" onclick="algo()" style="width: 100%;"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></button></div></div>'

div_opcio = div_opcio + '<div class="col-md-55"><div class=""><div class="image view view-first"><img style="width: 100%; display: block;" src="images/media.jpg" alt="image"></div><div class="caption" style="height: 100px;"><p><strong>Estilo</strong></p><p>Cambiar posicion y tamaño de campos</p></div><button class="btn btn-primary" onclick="algo()" style="width: 100%;"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></button></div></div>'

div_opcio = div_opcio + '<div class="col-md-55"><div class=""><div class="image view view-first"><img style="width: 100%; display: block;" src="images/media.jpg" alt="image"></div><div class="caption" style="height: 100px;"><p><strong>Estilo</strong></p><p>Cambiar posicion y tamaño de campos</p></div><button class="btn btn-primary" onclick="algo()" style="width: 100%;"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></button></div></div>'




              $("#myTabContent").prepend('<div role="tabpanel" class="tab-pane fade" id="rr' + pestalla + '" aria-labelledby="id' + pestalla + '"> ' + div_opcio + ' </div>');
             
    

            
}

function runScript_detalle(e, campo) {
    //See notes about 'which' and 'key'
    if (e.keyCode == 13) {
        buscar_referencia_detalle_enter(campo)
    }
    if (e.keyCode == 9) {
        buscar_referencia_detalle_enter(campo)
    }
    
}
function runScript(e, campo) {
    //See notes about 'which' and 'key'
    if (e.keyCode == 13) {
        buscar_referencia_cabecera_enter(campo)
    }
    if (e.keyCode == 9) {
        buscar_referencia_cabecera_enter(campo)
    }
    
}

function runScript_buscador_cab(e, id_campo_busc, pkcampo) {
    //See notes about 'which' and 'key'
    if (e.keyCode == 13) {
        filtrar_buscar(id_campo_busc, pkcampo)
    }
}


function runScript_buscador_rep(e, id_campo_busc, pkcampo) {
    //See notes about 'which' and 'key'
    if (e.keyCode == 13) {
        filtrar_buscar_rep(id_campo_busc, pkcampo)
    }
}

function runScript_buscador_det(e, id_campo_busc, pkcampo) {
    //See notes about 'which' and 'key'
    if (e.keyCode == 13) {
        filtrar_buscar_det(id_campo_busc, pkcampo)
    }
}

function buscar_referencia_cabecera_enter(campo){
  var cc_id = campo.id
  var res = cc_id.split("zzz");
  var cc_pesta = res[0].substring(1);
  var cc_nombre  = res[1]

  Response_int = dict_pestalla['p-'+cc_pesta]


  where = " "
  modo = Response_int["func_cab"][cc_nombre][0][0]["Modo"]
  columnas = Response_int["func_cab"][cc_nombre][0][0]["Columnas"]
  campo = Response_int["func_cab"][cc_nombre][0][0]["Sentencia"]
  dato = document.getElementById(cc_id).value
  tabla = Response_int["func_cab"][cc_nombre][0][0]["TablaOrigen"]
  orderby = " order by pk" + Response_int["func_cab"][cc_nombre][0][0]["TablaOrigen"] + " desc "


  for (x = 0; x <   Response_int["func_cab"][cc_nombre][1].length; x++) {   

    ElementoA = ""
    ElementoB = ""
    
    if(Response_int["func_cab"][cc_nombre][1][x]["TipoA"] == "R"){
      id_ext = 'p' + cc_pesta + 'zzz' + Response_int["func_cab"][cc_nombre][1][x]["ElementoA"] 
      ElementoA = "'" + document.getElementById(id_ext).value + "'"
    }
    if(Response_int["func_cab"][cc_nombre][1][x]["TipoA"] == "V"){
      ElementoA = "'" +Response_int["func_cab"][cc_nombre][1][x]["ElementoA"] + "'"
    }
    if(Response_int["func_cab"][cc_nombre][1][x]["TipoA"] == "C"){
      ElementoA = Response_int["func_cab"][cc_nombre][1][x]["ElementoA"]
    }

    if(Response_int["func_cab"][cc_nombre][1][x]["TipoB"] == "R"){
      id_ext = 'p' + cc_pesta + 'zzz' + Response_int["func_cab"][cc_nombre][1][x]["ElementoB"] 
      ElementoB = "'" + document.getElementById(id_ext).value + "'"
    }
    if(Response_int["func_cab"][cc_nombre][1][x]["TipoB"] == "V"){
      ElementoB = "'" + Response_int["func_cab"][cc_nombre][1][x]["ElementoB"] + "'"
    }
    if(Response_int["func_cab"][cc_nombre][1][x]["TipoB"] == "C"){
      ElementoB = Response_int["func_cab"][cc_nombre][1][x]["ElementoB"]
    }

    where = where + ElementoA + ' ' + Response_int["func_cab"][cc_nombre][1][x]["Operador"]  + ' ' + ElementoB +  ' and'
  }
  if (where == " "){where = ""}else{where = ' and ' + where.slice(0,-3)}

    cmpsenten = 'select ' + columnas + ' from ' + tabla + ' where ' + campo + ' like "' + dato + '%"' + where



        $.ajax({
          type: 'POST',
          url: '/buscador_auto_enter',
          data: {'fuente': $(this).attr("value"), 'csrfmiddlewaretoken': '{{ csrf_token }}', 'Id_empresa':'{{Id_empresa}}','cmpsenten': cmpsenten, 'usuario':'{{usuario}}','cc_pesta':cc_pesta,'cc_nombre':cc_nombre,'cc_fila':0},
          success: function(Response_int){
   
            if(Response_int['cmpvalor'].length > 0){ 
              ID_TAG = 'p' + Response_int['cc_pesta'] + 'zzz' + Response_int['cc_nombre']

              document.getElementById(ID_TAG).value =  Response_int['cmpvalor'][0][dict_pestalla["p-"+Response_int['cc_pesta']]["func_cab"][Response_int['cc_nombre']][0][0]['Sentencia']]

              

              for (x = 0; x < dict_pestalla["p-"+Response_int['cc_pesta']]["campos_cab"].length; x++) {  
                if(dict_pestalla["p-"+Response_int['cc_pesta']]["campos_cab"][x]["TablaCampo"] == "cmpreferenciaadjunto"){
                  if(dict_pestalla["p-"+Response_int['cc_pesta']]["func_cab"][dict_pestalla["p-"+Response_int['cc_pesta']]["campos_cab"][x]["Nombre"]][0]["CampoReferencia"] == Response_int['cc_nombre']){
                    ID_TAG = 'p' + Response_int['cc_pesta'] + 'zzz' + dict_pestalla["p-"+Response_int['cc_pesta']]["campos_cab"][x]["Nombre"]
                    document.getElementById(ID_TAG).value = Response_int['cmpvalor'][0][dict_pestalla["p-"+Response_int['cc_pesta']]["func_cab"][dict_pestalla["p-"+Response_int['cc_pesta']]["campos_cab"][x]["Nombre"]][0]["Sentencia"]]
                  }
                }
              }
            }
            calcular_0(Response_int['cc_pesta'])

          }
        });
}

function buscar_referencia_detalle_enter(campo){
  var cc_id = campo.id
  var res = cc_id.split("fff");
  var res2 = res[1].split("ccc");

  var cc_pesta = res[0].substring(2);
  var cc_fila = res2[0]
  var cc_nombre  = res2[1]

  Response = dict_pestalla['p-'+cc_pesta]


  where = " "
  modo = Response["func_det"][cc_nombre][0][0]["Modo"]
  columnas = Response["func_det"][cc_nombre][0][0]["Columnas"]
  campo = Response["func_det"][cc_nombre][0][0]["Sentencia"]
  dato = document.getElementById(cc_id).value
  tabla = Response["func_det"][cc_nombre][0][0]["TablaOrigen"]
  orderby = " order by pk" + Response["func_det"][cc_nombre][0][0]["TablaOrigen"] + " desc "


  for (x = 0; x <   Response["func_det"][cc_nombre][1].length; x++) {   

    ElementoA = ""
    ElementoB = ""
    
    if(Response["func_det"][cc_nombre][1][x]["TipoA"] == "R"){
      id_ext = 'p' + cc_pesta + 'zzz' + Response["func_det"][cc_nombre][1][x]["ElementoA"] 
      ElementoA = "'" + document.getElementById(id_ext).value + "'"
    }
    if(Response["func_det"][cc_nombre][1][x]["TipoA"] == "V"){
      ElementoA = "'" +Response["func_det"][cc_nombre][1][x]["ElementoA"] + "'"
    }
    if(Response["func_det"][cc_nombre][1][x]["TipoA"] == "C"){
      ElementoA = Response["func_det"][cc_nombre][1][x]["ElementoA"]
    }

    if(Response["func_det"][cc_nombre][1][x]["TipoB"] == "R"){
      id_ext = 'p' + cc_pesta + 'zzz' + Response["func_det"][cc_nombre][1][x]["ElementoB"] 
      ElementoB = "'" + document.getElementById(id_ext).value + "'"
    }
    if(Response["func_det"][cc_nombre][1][x]["TipoB"] == "V"){
      ElementoB = "'" + Response["func_det"][cc_nombre][1][x]["ElementoB"] + "'"
    }
    if(Response["func_det"][cc_nombre][1][x]["TipoB"] == "C"){
      ElementoB = Response["func_det"][cc_nombre][1][x]["ElementoB"]
    }

    where = where + ElementoA + ' ' + Response["func_det"][cc_nombre][1][x]["Operador"]  + ' ' + ElementoB +  ' and'
  }
  if (where == " "){where = ""}else{where = ' and ' + where.slice(0,-3)}

    cmpsenten = 'select ' + columnas + ' from ' + tabla + ' where ' + campo + ' like "' + dato + '%"' + where

        $.ajax({
          type: 'POST',
          url: '/buscador_auto_enter',
          data: {'fuente': $(this).attr("value"), 'csrfmiddlewaretoken': '{{ csrf_token }}', 'Id_empresa':'{{Id_empresa}}','cmpsenten': cmpsenten, 'usuario':'{{usuario}}','cc_pesta':cc_pesta,'cc_nombre':cc_nombre,'cc_fila':cc_fila},
          success: function(Response_int){

            if(Response_int['cmpvalor'].length > 0){ 

              temp_int = dict_pestalla["p-"+Response_int['cc_pesta']]

              ID_TAG = 'pd' + Response_int['cc_pesta'] + 'fff' + Response_int['cc_fila'] + 'ccc' + Response_int['cc_nombre']

              document.getElementById(ID_TAG).value =  Response_int['cmpvalor'][0][temp_int["func_det"][Response_int['cc_nombre']][0][0]['Sentencia']]


              for (x = 0; x < temp_int["campos_det"].length; x++) {  
                if(temp_int["campos_det"][x]["TablaCampo"] == "cmpreferenciaadjunto"){
                  if(temp_int["func_det"][temp_int["campos_det"][x]["Nombre"]][0]["CampoReferencia"] == cc_nombre){

                    ID_TAG = 'pd' + Response_int['cc_pesta'] + 'fff' + Response_int['cc_fila'] + 'ccc' + temp_int["campos_det"][x]["Nombre"]

                    if(temp_int["func_det"][temp_int["campos_det"][x]["Nombre"]][0]["Tipo"] == 'Imagen'){

                      document.getElementById(ID_TAG + "_label").innerHTML = Response_int['cmpvalor'][0][temp_int["func_det"][temp_int["campos_det"][x]["Nombre"]][0]["Sentencia"]]
                      document.getElementById(ID_TAG + "_label").href = '/static/archivos/{{Id_empresa}}/'+ Response_int['cmpvalor'][0][temp_int["func_det"][temp_int["campos_det"][x]["Nombre"]][0]["Sentencia"]] 
                    
                      document.getElementById(ID_TAG + "_img").src = '/static/archivos/{{Id_empresa}}/'+ Response_int['cmpvalor'][0][temp_int["func_det"][temp_int["campos_det"][x]["Nombre"]][0]["Sentencia"]]

                    }else{
                      document.getElementById(ID_TAG).value = Response_int['cmpvalor'][0][temp_int["func_det"][temp_int["campos_det"][x]["Nombre"]][0]["Sentencia"]]
                    }

                  }
                }
              } 
              calcular_detalle(Response_int['cc_pesta'], Response_int['cc_fila'])

            }

          } 
        });
}

//function filtrar(PkModulo, eliminar, modifica, pestana_int, tablaDescripcion) {

function filtrar(pestana_int) {

        Response = dict_pestalla['p-' + pestana_int]

        v_where_valor= document.getElementById('valor' + pestana_int).value;
        v_top= document.getElementById('top' + pestana_int).value;


        $.ajax({
          type: 'POST',
          url: '/menu_filtro',
          data: {'fuente': 'filtro', 'csrfmiddlewaretoken': '{{ csrf_token }}', 'Id_empresa':'{{Id_empresa}}', 'usuario':'{{usuario}}', 'idioma':'{{ idioma }}', 'tablaDescripcion': Response["tabla"][0]["Descripcion"], 'pestana_int':pestana_int, 'PkModulo':Response["tabla"][0]["PkModulo"], 'v_tabla':Response["tabla"][0]["Nombre"], 'v_where_valor':v_where_valor, 'eliminar':Response["eliminar"], 'modifica':Response["modifica"], 'v_top':v_top, 'campos':JSON.stringify(Response["names"])},
          success: function(Response){
            ResFijo = dict_pestalla['p-' + Response["pestana_int"]]


            largo_tablaPX = 0
              for (x = 0; x < Response["dbdatos"][0].length; x++) {
                largo_tablaPX = largo_tablaPX + 150 
              }


            new_tab = '<table id="datatable-checkbox" width="100%" class="table table-striped table-bordered bulk_action" style="overflow-x:auto;width: '+ largo_tablaPX +'px; font-size: 11px;"><thead><tr><th style="width: 70px;">{{idioma_html.Acciones}}</th>'

 
            for (x = 1; x < Response["dbdatos"][0].length; x++) { 

              new_tab = new_tab +'<th>'+Response["dbdatos"][0][x][0]+'</th>'

            }
            new_tab = new_tab +'</tr></thead><tbody>'

            for (x = 0; x < Response["dbdatos"][1].length; x++) { 

              new_tab = new_tab +'<tr id="f'+ResFijo["tabla"][0]["PkModulo"] +'-f'+Response["dbdatos"][1][x][0]+'"><td><div class="row">'
              if(ResFijo["modifica"] == "Si"){   

                new_tab = new_tab +'<a class="btn btn-success" onclick="registro('+ResFijo["tabla"][0]["PkModulo"] +','+Response["dbdatos"][1][x][0]+',1, '+Response["pestana_int"]+')" style="padding: 2px 2px; margin-right: 0px; margin-left: 5px;"><span class="glyphicon glyphicon-edit" aria-hidden="true"></span></a>'
              }
              if(ResFijo["eliminar"] == "Si"){
                new_tab = new_tab +'<a class="btn btn-danger" onclick="eliminar('+ResFijo["tabla"][0]["PkModulo"] +','+Response["dbdatos"][1][x][0]+')" style="padding: 2px 2px; margin-right: 0px; margin-left: 0px;"><span class="glyphicon glyphicon-remove-sign" aria-hidden="true"></span></a>'
              }

              new_tab = new_tab +'<button class="btn btn-primary" onclick="registro('+ResFijo["tabla"][0]["PkModulo"] +','+Response["dbdatos"][1][x][0]+',2,'+Response["pestana_int"]+')" style="padding: 2px 2px; margin-right: 0px; margin-left: 0px;"><span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span></button></div></td>'
             
              for (x2 = 1; x2 < Response["dbdatos"][0].length; x2++) { 

                //new_tab = new_tab +'<td>'+Response["dbdatos"][1][x][x2]+'</td>'


                 if(ResFijo["modifica"] == "Si"){
                    id_tag_int = 'md'+ ResFijo["pestalla"] +'zzz'+Response["dbdatos"][0][x2][0]+'jjj'+Response["dbdatos"][1][x][0]
                    new_tab = new_tab + '<td><input type="text" id="'+ id_tag_int +'" class="form-control" value="' + Response["dbdatos"][1][x][x2] +'" onkeypress="return runScript_modi_fast(event, ' + id_tag_int +')" style="font-size: 11px; height: 25px;"></td>'
                
                  }else{
                    new_tab = new_tab +'<td>'+Response["dbdatos"][1][x][x2]+'</td>'
                  }
 
              }

              new_tab = new_tab +'</tr>'

            }
              new_tab = new_tab +'</tbody></table>'


            $('#tabla' + Response["pestana_int"]).html(new_tab);

          }
          });
}

function verificar_validar_registro(pestana_int) {

  Response = dict_pestalla['p-' + pestana_int]
  valio = false
  valiodet = false
  
  if(Response["validaciones"].length >0){
    for (x = 0; x < Response["validaciones"][0].length; x++) {
      valorA = 0 
      ValorB = 0
      if(Response["validaciones"][0][x]["EstadoA"] == "C"){
        valorA = document.getElementById('p' + pestana_int + 'zzz' + Response["validaciones"][0][x]["ElementoA"]).value
      }else{
        valorA = Response["validaciones"][0][x]["ElementoA"]
      }
      if(Response["validaciones"][0][x]["EstadoB"] == "C"){
        valorB = document.getElementById('p' + pestana_int + 'zzz' + Response["validaciones"][0][x]["ElementoB"]).value
      }else{
        valorB = Response["validaciones"][0][x]["ElementoB"]
      }      
      if(Response["validaciones"][0][x]["Operador"] == "="){if(valorA != valorB){
        valio = true
        alert(Response["validaciones"][0][x]["Mensaje"])}}
      if(Response["validaciones"][0][x]["Operador"] == ">"){if(parseFloat(valorA) <= parseFloat(valorB)){
        valio = true
        alert(Response["validaciones"][0][x]["Mensaje"])}}
      if(Response["validaciones"][0][x]["Operador"] == "<"){if(parseFloat(valorA) >= parseFloat(valorB)){
        valio = true
        alert(Response["validaciones"][0][x]["Mensaje"])}}
      if(Response["validaciones"][0][x]["Operador"] == "=>"){if(parseFloat(valorA) < parseFloat(valorB)){
        valio = true
        alert(Response["validaciones"][0][x]["Mensaje"])}}
      if(Response["validaciones"][0][x]["Operador"] == "=<"){if(parseFloat(valorA) > parseFloat(valorB)){
        valio = true
        alert(Response["validaciones"][0][x]["Mensaje"])}}
      if(Response["validaciones"][0][x]["Operador"] == "Igual"){
        if(valorB =="Obligatorio"){
          if(valorA.length == 0){
            valio = true
            alert(Response["validaciones"][0][x]["Mensaje"])            
          }
        }else{
          if(valorA != valorB){
        valio = true
        alert(Response["validaciones"][0][x]["Mensaje"])}
        }
      }
      if(Response["validaciones"][0][x]["Operador"] == "!="){if(valorA == valorB){
        valio = true
        alert(Response["validaciones"][0][x]["Mensaje"])}}
      if(Response["validaciones"][0][x]["Operador"] == "No Igual"){if(valorA == valorB){
        valio = true
        alert(Response["validaciones"][0][x]["Mensaje"])}}

    }
  }

  if(Response["validaciones"].length >1){

    for (x = 0; x < Response["validaciones"][1].length; x++) {
      for (x2 = 0; x2 < (cc_porPesta['p-' + pestana_int] + 1 ); x2++) { 
        tagA = 'pd' + pestana_int + 'fff'+ x2 +'ccc' + Response["validaciones"][1][x]["ElementoA"]
        tagB = 'pd' + pestana_int + 'fff'+ x2 +'ccc' + Response["validaciones"][1][x]["ElementoB"]
        tagver = 'pd' + pestana_int + 'fff'+ x2 +'ccc' + Response["campos_det"][1]["Nombre"]
        if (document.getElementById(tagver) != null){
          valorA = 0 
          valorB = 0
          if(Response["validaciones"][1][x]["EstadoA"] == "C"){

            valorA = document.getElementById(tagA).value
          }else{
            valorA = Response["validaciones"][1][x]["ElementoA"]
          }
          if(Response["validaciones"][1][x]["EstadoB"] == "C"){
            valorb = document.getElementById(tagB).value
          }else{
            valorB = Response["validaciones"][1][x]["ElementoB"]
          }
          if(Response["validaciones"][1][x]["Operador"] == "="){if(valorA != valorB){
            valiodet = true
            alert(Response["validaciones"][1][x]["Mensaje"])}}
          if(Response["validaciones"][1][x]["Operador"] == ">"){if(parseFloat(valorA) <= parseFloat(valorB)){
            valiodet = true
            alert(Response["validaciones"][1][x]["Mensaje"])}}
          if(Response["validaciones"][1][x]["Operador"] == "<"){if(parseFloat(valorA) >= parseFloat(valorB)){
            valiodet = true
            alert(Response["validaciones"][1][x]["Mensaje"])}}
          if(Response["validaciones"][1][x]["Operador"] == "=>"){if(parseFloat(valorA) < parseFloat(valorB)){
            valiodet = true
            alert(Response["validaciones"][1][x]["Mensaje"])}}
          if(Response["validaciones"][1][x]["Operador"] == "=<"){if(parseFloat(valorA) > parseFloat(valorB)){
            valiodet = true
            alert(Response["validaciones"][1][x]["Mensaje"])}}
          if(Response["validaciones"][1][x]["Operador"] == "Igual"){if(valorA != valorB){
            valiodet = true
            alert(Response["validaciones"][1][x]["Mensaje"])}}
          if(Response["validaciones"][1][x]["Operador"] == "!="){if(valorA == valorB){
            valiodet = true
            alert(Response["validaciones"][1][x]["Mensaje"])}}
          if(Response["validaciones"][1][x]["Operador"] == "No Igual"){if(valorA == valorB){
            valiodet = true
            alert(Response["validaciones"][1][x]["Mensaje"])}}
        }
      }
    }    
  } 
  if(valiodet == false && valio == false){    
    return true
  }else{
    return false 
  }
}

function validar_registro(pestana_int){
  if(verificar_validar_registro(pestana_int) == true ){
    alert("Validado")
  }
}

function grabar_elemento(pestana_int, disparador){
  if(verificar_validar_registro(pestana_int) == true ){
    Response = dict_pestalla['p-' + pestana_int]
    disparador_real = ""
    if(disparador == 0){disparador_real = "Guardar Registro Nuevo"}
    if(disparador == 1){disparador_real = "Modificar Registro"}

    envio_archi = []
    envio_datset = {}
    array_cab = []
    array_det= []
    array_subdet = []

    ingreso_cab = {}
    tiene_detalle = 'Si'
    for (x = 0; x < Response["campos_cab"].length; x++) {
      tag_campo = "p" + pestana_int + "zzz" + Response["campos_cab"][x]["Nombre"]
      if(document.getElementById(tag_campo).value == null){
              ingreso_cab[Response["campos_cab"][x]["Nombre"]] =  ''
      }else{
              ingreso_cab[Response["campos_cab"][x]["Nombre"]] =  document.getElementById(tag_campo).value
      }
      if(Response["campos_cab"][x]["TablaCampo"] == "cmpfecha"){
        var d = new Date(document.getElementById(tag_campo).value),
            month = '' + (d.getMonth() + 1),
            day = '' + d.getDate(),
            year = d.getFullYear();

        if (month.length < 2) month = '0' + month;
        if (day.length < 2) day = '0' + day;

        ingreso_cab[Response["campos_cab"][x]["Nombre"]] =  [year, month, day].join('-');
      }
      if(Response["campos_cab"][x]["TablaCampo"] == "cmparchivo"){
        envio_archi.push(tag_campo)
      }
    }
    array_cab.push(ingreso_cab)
    envio_datset[Response["tabla_cab"]["Nombre"]] = array_cab 

    if(Response["tabla_det"] != 0){
      for (x = 0; x < (cc_porPesta['p-' + pestana_int] + 1 ); x++) { 
        ingreso_det= {}
        if(document.getElementById("pd" + pestana_int + "fff"+ x +"ccc" + Response["campos_det"][0]["Nombre"]) != null)
        {
          for (x2 = 0; x2 < Response["campos_det"].length; x2++) {

            if(Response["campos_det"][x2]["TablaCampo"] == "cmparchivo"){
              tag_campo = "pd" + pestana_int + "fff"+ x +"ccc" + Response["campos_det"][x2]["Nombre"]
              ingreso_det[Response["campos_det"][x2]["Nombre"]] =  document.getElementById(tag_campo).value
            
              envio_archi.push(tag_campo)
            }else{
              if(Response["campos_det"][x2]["TablaCampo"] == "cmpreferenciaadjunto" && Response["func_det"][Response["campos_det"][x2]["Nombre"]][0]["Tipo"] == 'Imagen' ){
                tag_campo = "pd" + pestana_int + "fff"+ x +"ccc" + Response["campos_det"][x2]["Nombre"] + '_label'
                ingreso_det[Response["campos_det"][x2]["Nombre"]] =  document.getElementById(tag_campo).innerHTML
              }else{
                tag_campo = "pd" + pestana_int + "fff"+ x +"ccc" + Response["campos_det"][x2]["Nombre"]
                ingreso_det[Response["campos_det"][x2]["Nombre"]] =  document.getElementById(tag_campo).value
            
              }

           
            }
          }
        array_det.push(ingreso_det)
        }
      }
      envio_datset[Response["tabla_det"]["Nombre"]] = array_det 
    }else{
      tiene_detalle = 'No'
      ingreso_det = 0
    }

    ingreso_subdet = {}
    if(Response["tabla_subdet"] != 0){ingreso_subdet = 0}else{ingreso_subdet = 0}
    pestana_pasa_grabar = pestana_int


    var formData = new FormData();
    for (x2 = 0; x2 < envio_archi.length; x2++) {
      formData.append("arc-" + envio_archi[x2], document.getElementById(envio_archi[x2]).value);
    }
     
    $.ajax({
      type: 'POST',
      url: '/regis_guardar',
      data: {'fuente': $(this).attr("value"), 'csrfmiddlewaretoken': '{{ csrf_token }}', 'tiene_detalle':tiene_detalle, 'Id_empresa':'{{Id_empresa}}','nom_tabla':Response["tabla_cab"]["Nombre"], 'disparador':disparador_real, 'pkmodulo':Response["tabla_cab"]["PkModulo"], 'array_cab': JSON.stringify(array_cab),'array_det': JSON.stringify(array_det),'array_subdet': JSON.stringify(array_subdet), 'usuario':'{{usuario}}', 'campos_cab':JSON.stringify(Response["campos_cab"]), 'campos_det':JSON.stringify(Response["campos_det"]), 'campos_subdet':JSON.stringify(Response["campos_subdet"]), 'envio_datset':JSON.stringify(envio_datset),'pestalla':pestana_int, 'tablaDatos':JSON.stringify(Response["tabla_cab"])},
      success: function(Response){
   
        if(Response["grabo"] == true){
          registro(Response["pkmodulo"], Response["pkregistro"],2, Response["pestalla"])
          cerrar_elemento( Response["pestalla"])
          document.getElementById('id'+ pestalla).click();
        }else{
          alert(Response["msg"])
        }
      }
    });
  }
}


function eliminar(pkmodulo,pkregistro ) {
    var mensaje;
    var opcion = confirm("{{idioma_html.msg_eliminar}}");
    if (opcion == true) {
        mensaje = "{{idioma_html.eliminado}}";
        $('#f' +pkmodulo + '-f'+ pkregistro ).remove();

        $.ajax({
          type: 'POST',
          url: '/menu_eliminar',
          data: {'fuente': $(this).attr("value"), 'csrfmiddlewaretoken': '{{ csrf_token }}', 'Id_empresa':'{{Id_empresa}}','pkregistro': pkregistro, 'pkmodulo':pkmodulo, 'usuario':'{{usuario}}'},
          success: function(Response){}
        });
    }else {
        mensaje = "{{idioma_html.cancelado}}";
    }
}


function pdf_elemento(pestana_int){
    Response = dict_pestalla['p-' + pestana_int]

    if(Response["plantilla_pdf"]["plantillasMain"].length == 0){

    }else{
      if(Response["plantilla_pdf"]["plantillasMain"].length == 1){
        ind_pla = 0
      } 
      var doc = new jsPDF('p', 'cm', [parseFloat(Response["plantilla_pdf"]["plantillasMain"][ind_pla]["Largo"]), parseFloat(Response["plantilla_pdf"]["plantillasMain"][ind_pla]["Ancho"])]);

      doc.setFontSize(Response["plantilla_pdf"]["plantillasMain"][ind_pla]["Letra"]);
    }
      
    var Vpkplantilla = Response["plantilla_pdf"]["plantillasMain"][ind_pla]["PkPlantilla"]


    for (z = 0; z < Response["plantilla_pdf"]["plantillassegmentos"][Vpkplantilla].length; z++){ 
      if(Response["plantilla_pdf"]["plantillassegmentos"][Vpkplantilla][z]["Tipo"] == "Cabecera"){
        seg_cab = Response["plantilla_pdf"]["plantillassegmentos"][Vpkplantilla][z]
      }    
      if(Response["plantilla_pdf"]["plantillassegmentos"][Vpkplantilla][z]["Tipo"] == "Detalle"){
        seg_det = Response["plantilla_pdf"]["plantillassegmentos"][Vpkplantilla][z]
      }    
      if(Response["plantilla_pdf"]["plantillassegmentos"][Vpkplantilla][z]["Tipo"] == "Pie"){
        seg_pie = Response["plantilla_pdf"]["plantillassegmentos"][Vpkplantilla][z]
      }    
    }
     

    //cab
    //etiquetas
    var altura_ini = seg_cab["AlturaInicial"]

    for (z = 0; z < Response["plantilla_pdf"]["plantillasetiquetas"][seg_cab["PkSegmento"]].length; z++) {
      if(Response["plantilla_pdf"]["plantillasetiquetas"][seg_cab["PkSegmento"]][z]["TipoLetra"] == "Logo"){


              imagen = document.getElementById("logo_cia")
              tipo = imagen.attributes["value"]["value"].split('.')
              tamano = Response["plantilla_pdf"]["plantillasetiquetas"][seg_cab["PkSegmento"]][z]["Tamano"].split(',')
              var imgData = getBase64Image(imagen,tamano[0] * 37,tamano[1] * 37)
              doc.addImage(imgData, tipo[1].toUpperCase(), parseFloat(Response["plantilla_pdf"]["plantillasetiquetas"][seg_cab["PkSegmento"]][z]["X"]), parseFloat(Response["plantilla_pdf"]["plantillasetiquetas"][seg_cab["PkSegmento"]][z]["Y"]), parseFloat(tamano[0]) , parseFloat(tamano[1]) )


      }else{
        doc.setFontSize(parseFloat(Response["plantilla_pdf"]["plantillasetiquetas"][seg_cab["PkSegmento"]][z]["Tamano"]))
        doc.setFont("helvetica");
        doc.setFontStyle(Response["plantilla_pdf"]["plantillasetiquetas"][seg_cab["PkSegmento"]][z]["TipoLetra"]);

        doc.text(parseFloat(Response["plantilla_pdf"]["plantillasetiquetas"][seg_cab["PkSegmento"]][z]["X"]), parseFloat(Response["plantilla_pdf"]["plantillasetiquetas"][seg_cab["PkSegmento"]][z]["Y"]) + parseFloat(altura_ini), Response["plantilla_pdf"]["plantillasetiquetas"][seg_cab["PkSegmento"]][z]["Nombre"]);
      }
    }  
    for (z = 0; z < Response["plantilla_pdf"]["plantillascamposcabecera"][seg_cab["PkSegmento"]].length; z++) { 
      var valor = Response["valores_cab"][0][Response["plantilla_pdf"]["plantillascamposcabecera"][seg_cab["PkSegmento"]][z]["Campo"]].toString()
     
      valor = devolver_valor_imp(valor, Response["plantilla_pdf"]["plantillascamposcabecera"][seg_cab["PkSegmento"]][z]["Tipo"], Response["plantilla_pdf"]["plantillascamposcabecera"][seg_cab["PkSegmento"]][z]["Ext"])

      if(Response["plantilla_pdf"]["plantillascamposcabecera"][seg_cab["PkSegmento"]][z]["Tipo"] == 'Derecha'){
        doc.text(parseFloat(Response["plantilla_pdf"]["plantillascamposcabecera"][seg_cab["PkSegmento"]][z]["X"]), parseFloat(Response["plantilla_pdf"]["plantillascamposcabecera"][seg_cab["PkSegmento"]][z]["Y"]) + parseFloat(altura_ini), valor.toString() , 'right');
      }else{
        if(Response["plantilla_pdf"]["plantillascamposcabecera"][seg_cab["PkSegmento"]][z]["Tipo"] == 'Color'){
          datos_forma = Response["plantilla_pdf"]["plantillascamposcabecera"][seg_cab["PkSegmento"]][z]["Ext"].split(',')
          doc.setTextColor(parseFloat(datos_forma[0]), parseFloat(datos_forma[1]), parseFloat(datos_forma[2]));
          doc.setFontSize(parseFloat(datos_forma[3]))

          doc.text(parseFloat(Response["plantilla_pdf"]["plantillascamposcabecera"][seg_cab["PkSegmento"]][z]["X"]), parseFloat(Response["plantilla_pdf"]["plantillascamposcabecera"][seg_cab["PkSegmento"]][z]["Y"]) + parseFloat(altura_ini), valor.toString() );

          doc.setTextColor(0, 0, 0);
          doc.setFontSize(10);


        }else{
          doc.setFontSize(10);
          doc.setFontStyle("normal");
          doc.text(parseFloat(Response["plantilla_pdf"]["plantillascamposcabecera"][seg_cab["PkSegmento"]][z]["X"]), parseFloat(Response["plantilla_pdf"]["plantillascamposcabecera"][seg_cab["PkSegmento"]][z]["Y"]) + parseFloat(altura_ini), valor.toString() );
        }
      }
    }  





    var linea = parseFloat(seg_det["AlturaInicial"])

    //detallecab

      doc.setDrawColor(192, 192, 192)
      doc.setFillColor(192, 192, 192)
      //doc.roundedRect(5, 20, 10, 10, 4, 4, 'FD')
      
      
      doc.roundedRect(0.5 ,linea-0.5, parseFloat(Response["plantilla_pdf"]["plantillasMain"][ind_pla]["Ancho"])-1.5 ,0.7,0.3,0.3, 'FD')
      doc.setDrawColor(0, 0, 0)

    for (z = 0; z < Response["plantilla_pdf"]["plantillascampos"][seg_det["PkSegmento"]].length; z++) { 
      doc.setFontStyle("bold");
      if(Response["plantilla_pdf"]["plantillascampos"][seg_det["PkSegmento"]][z]["Tipo"] == 'Derecha'){
        doc.text(parseFloat(Response["plantilla_pdf"]["plantillascampos"][seg_det["PkSegmento"]][z]["X"]), linea, Response["plantilla_pdf"]["plantillascampos"][seg_det["PkSegmento"]][z]["Cabecera"], 'right')
      }else{
        doc.text(parseFloat(Response["plantilla_pdf"]["plantillascampos"][seg_det["PkSegmento"]][z]["X"]), linea, Response["plantilla_pdf"]["plantillascampos"][seg_det["PkSegmento"]][z]["Cabecera"])
      }
    }
        doc.setFillColor(0, 0, 0)

      doc.setFont("helvetica");
      doc.setFontStyle("normal");
      doc.setFontSize(9);

    //detalle datos
    var line_add = 0
    for (z2 = 0; z2 < Response["valores_det"].length; z2++) { 
      linea = linea + 1 + line_add
      line_add =0

      if(linea > ( parseFloat(Response["plantilla_pdf"]["plantillasMain"][ind_pla]["Largo"]) - 3)){
        doc.addPage('p', 'cm', [parseFloat(Response["plantilla_pdf"]["plantillasMain"][ind_pla]["Largo"]), parseFloat(Response["plantilla_pdf"]["plantillasMain"][ind_pla]["Ancho"])]);
        linea = 2
      }
      for (z = 0; z < Response["plantilla_pdf"]["plantillascampos"][seg_det["PkSegmento"]].length; z++) { 
        var txt = Response["valores_det"][z2][Response["plantilla_pdf"]["plantillascampos"][seg_det["PkSegmento"]][z]["Campo"]]

        var valor =  txt.toString()   
        valor = devolver_valor_imp(valor, Response["plantilla_pdf"]["plantillascampos"][seg_det["PkSegmento"]][z]["Tipo"], Response["plantilla_pdf"]["plantillascampos"][seg_det["PkSegmento"]][z]["Ext"])

        if(valor.length > parseFloat(Response["plantilla_pdf"]["plantillascampos"][seg_det["PkSegmento"]][z]["Limite"]) && Response["plantilla_pdf"]["plantillascampos"][seg_det["PkSegmento"]][z]["Tipo"] != 'Imagen'){
          valor = devolver_str_limte(valor, parseFloat(Response["plantilla_pdf"]["plantillascampos"][seg_det["PkSegmento"]][z]["Limite"]))
          for (s = 0; s < valor.length; s++) {
            doc.text(parseFloat(Response["plantilla_pdf"]["plantillascampos"][seg_det["PkSegmento"]][z]["X"]), linea + (0.5 * s), valor[s])
          }
          if(valor.length * 0.5 > line_add){
            line_add = (valor.length * 0.5)
          }
            
        }else{
          if(Response["plantilla_pdf"]["plantillascampos"][seg_det["PkSegmento"]][z]["Tipo"] == 'Derecha'){
            
            doc.text(parseFloat(Response["plantilla_pdf"]["plantillascampos"][seg_det["PkSegmento"]][z]["X"])+ (parseFloat(Response["plantilla_pdf"]["plantillascampos"][seg_det["PkSegmento"]][z]["Limite"]) * 0.02), linea, valor, 'right')
          }else{
          if(Response["plantilla_pdf"]["plantillascampos"][seg_det["PkSegmento"]][z]["Tipo"] == 'Imagen'){
   
              var tag = 'pd'+pestana_int+'fff'+ z2 +'ccc'+ Response["plantilla_pdf"]["plantillascampos"][seg_det["PkSegmento"]][z]["Campo"] +'_img'
              imagen = document.getElementById(tag)

              tipo = imagen.attributes["value"]["value"].split('.')

              var imgData = getBase64Image(imagen,parseFloat(Response["plantilla_pdf"]["plantillascampos"][seg_det["PkSegmento"]][z]["Ext"]) * 37,parseFloat(Response["plantilla_pdf"]["plantillascampos"][seg_det["PkSegmento"]][z]["Ext"]) * 37)
                      
              doc.addImage(imgData, tipo[1].toUpperCase(), parseFloat(Response["plantilla_pdf"]["plantillascampos"][seg_det["PkSegmento"]][z]["X"]), parseFloat(linea-0.5), parseFloat(Response["plantilla_pdf"]["plantillascampos"][seg_det["PkSegmento"]][z]["Ext"]), parseFloat(Response["plantilla_pdf"]["plantillascampos"][seg_det["PkSegmento"]][z]["Ext"]) )
              if(line_add < parseFloat(Response["plantilla_pdf"]["plantillascampos"][seg_det["PkSegmento"]][z]["Ext"]) ){

                line_add = parseFloat(Response["plantilla_pdf"]["plantillascampos"][seg_det["PkSegmento"]][z]["Ext"]  )- 1 //2
              }
            }else{
            doc.text(parseFloat(Response["plantilla_pdf"]["plantillascampos"][seg_det["PkSegmento"]][z]["X"]), linea, valor)
          }
        }
      }
    }
  }


    //pie
    if(linea >= parseFloat(seg_pie["AlturaInicial"])){
        doc.addPage('p', 'cm', [parseFloat(Response["plantilla_pdf"]["plantillasMain"][ind_pla]["Largo"]), parseFloat(Response["plantilla_pdf"]["plantillasMain"][ind_pla]["Ancho"])]);
      }
    linea = parseFloat(seg_pie["AlturaInicial"])



    for (z = 0; z < Response["plantilla_pdf"]["plantillasetiquetas"][seg_pie["PkSegmento"]].length; z++) { 
      //doc.text(parseFloat(Response["plantilla_pdf"]["plantillasetiquetas"][seg_pie["PkSegmento"]][z]["X"]), parseFloat(Response["plantilla_pdf"]["plantillasetiquetas"][seg_pie["PkSegmento"]][z]["Y"]) + parseFloat(linea), Response["plantilla_pdf"]["plantillasetiquetas"][seg_pie["PkSegmento"]][z]["Nombre"]);
    
        doc.setFontSize(parseFloat(Response["plantilla_pdf"]["plantillasetiquetas"][seg_pie["PkSegmento"]][z]["Tamano"]))
        doc.setFont("helvetica");
        doc.setFontStyle(Response["plantilla_pdf"]["plantillasetiquetas"][seg_pie["PkSegmento"]][z]["TipoLetra"]);

        doc.text(parseFloat(Response["plantilla_pdf"]["plantillasetiquetas"][seg_pie["PkSegmento"]][z]["X"]), parseFloat(Response["plantilla_pdf"]["plantillasetiquetas"][seg_pie["PkSegmento"]][z]["Y"]) + parseFloat(linea), Response["plantilla_pdf"]["plantillasetiquetas"][seg_pie["PkSegmento"]][z]["Nombre"]);
    }  

    for (z = 0; z < Response["plantilla_pdf"]["plantillascamposcabecera"][seg_pie["PkSegmento"]].length; z++) { 

        var valor = Response["valores_cab"][0][Response["plantilla_pdf"]["plantillascamposcabecera"][seg_pie["PkSegmento"]][z]["Campo"]].toString()
             
        valor = devolver_valor_imp(valor, Response["plantilla_pdf"]["plantillascamposcabecera"][seg_pie["PkSegmento"]][z]["Tipo"], Response["plantilla_pdf"]["plantillascamposcabecera"][seg_pie["PkSegmento"]][z]["Ext"])

        if(Response["plantilla_pdf"]["plantillascamposcabecera"][seg_pie["PkSegmento"]][z]["Tipo"] == 'Derecha'){
          doc.text(parseFloat(Response["plantilla_pdf"]["plantillascamposcabecera"][seg_pie["PkSegmento"]][z]["X"]), parseFloat(Response["plantilla_pdf"]["plantillascamposcabecera"][seg_pie["PkSegmento"]][z]["Y"]) + parseFloat(linea), valor.toString() , 'right');
        }else{

           if(Response["plantilla_pdf"]["plantillascamposcabecera"][seg_pie["PkSegmento"]][z]["Tipo"] == 'Imagen'){
            var tag = 'pd'+pestana_int+'fff'+ z +'ccc'+ Response["plantilla_pdf"]["plantillascamposcabecera"][seg_pie["PkSegmento"]][z]["Campo"] +'_img'
            var imgData = getBase64Image(document.getElementById(tag), document.getElementById(tag).width, document.getElementById(tag).height )
            doc.addImage(imgData, 'JPEG', parseFloat(Response["plantilla_pdf"]["plantillascamposcabecera"][seg_pie["PkSegmento"]][z]["X"]), parseFloat(Response["plantilla_pdf"]["plantillascamposcabecera"][seg_pie["PkSegmento"]][z]["Y"]) + parseFloat(linea), Response["plantilla_pdf"]["plantillascamposcabecera"][seg_pie["PkSegmento"]][z]["Ext"], Response["plantilla_pdf"]["plantillascamposcabecera"][seg_pie["PkSegmento"]][z]["Ext"])

           }else{
            if(Response["plantilla_pdf"]["plantillascamposcabecera"][seg_pie["PkSegmento"]][z]["Ext"] == 'center'){
              doc.text(parseFloat(Response["plantilla_pdf"]["plantillascamposcabecera"][seg_pie["PkSegmento"]][z]["X"]), parseFloat(Response["plantilla_pdf"]["plantillascamposcabecera"][seg_pie["PkSegmento"]][z]["Y"]) + parseFloat(linea), valor.toString() , 'center');
            }else{
              doc.text(parseFloat(Response["plantilla_pdf"]["plantillascamposcabecera"][seg_pie["PkSegmento"]][z]["X"]), parseFloat(Response["plantilla_pdf"]["plantillascamposcabecera"][seg_pie["PkSegmento"]][z]["Y"]) + parseFloat(linea), valor.toString() );
            }
              
           }
        }
    }  



    var date = new Date()

    doc.save(Response["tabla_cab"]["Nombre"] + '_' + date.toLocaleDateString() + " " + date.toLocaleTimeString() + '.pdf');

}

function devolver_str_limte(txt, limite) {
var devolver = []
  do {

    devolver.push(txt.substring(0,limite))
    txt = txt.substring(limite,txt.length-1)
  }
  while (txt.length >= limite);
  devolver.push(txt)
  return devolver
}


function getBase64Image(img, t_w, t_h) {
    // Create an empty canvas element
    var canvas = document.createElement("canvas");
    canvas.width = t_w;
    canvas.height = t_h;
    //canvas.width = img.width;
    //canvas.height = img.height;

    // Copy the image contents to the canvas
    var ctx = canvas.getContext("2d");
    //ctx.drawImage(img, 0, 0);
    ctx.drawImage(img,0,0,img.naturalWidth,img.naturalHeight,0,0,canvas.width,canvas.height);

    // Get the data-URL formatted image
    // Firefox supports PNG and JPEG. You could check img.src to
    // guess the original format, but be aware the using "image/jpg"
    // will re-encode the image.
    var dataURL = canvas.toDataURL("image/png");
    return dataURL
    //return dataURL.replace(/^data:image\/(png|jpg);base64,/, "");
}

function devolver_valor_imp( valor, tipo, ext){
  switch(tipo) {
    case "Color":
      return valor.toString()
    case "Imagen":
      return valor.toString()
    case "Normal":
      return valor.toString()
    case "Fecha":
      var date = new Date(valor)
      switch(ext){
        case "Dia":
          return date.getDay()
        case "Mes":
          return date.getMonth()
        case "Anio":
          return date.getFullYear()
        case "Letras":
          switch(date.getMonth()) {
            case 1:
              return date.getFullYear() + " Enero " + date.getDay()
            case 2:
              return date.getFullYear() + " Febrero " + date.getDay()
            case 3:
              return date.getFullYear() + " Marzo " + date.getDay()
            case 4:
              return date.getFullYear() + " Abril " + date.getDay()
            case 5:
              return date.getFullYear() + " Mayo " + date.getDay()
            case 6:
              return date.getFullYear() + " Junio " + date.getDay()
            case 7:
              return date.getFullYear() + " Julio " + date.getDay()
            case 8:
              return date.getFullYear() + " Agosto " + date.getDay()
            case 9:
              return date.getFullYear() + " Septiembre " + date.getDay()
            case 10:
              return date.getFullYear() + " Octubre " + date.getDay()
            case 11:
              return date.getFullYear() + " Noviembre " + date.getDay()
            case 12:
              return date.getFullYear() + " Diciembre " + date.getDay()
          }
        case "Normal":
          return valor.toString()
        case "DDMMAAAA":
          return date.getDay() + date.getMonth() + date.getFullYear()
        case "LetrasMayusculas":
          switch(date.getMonth()) {
            case 1:
              return date.getFullYear() + " ENERO " + date.getDay()
            case 2:
              return date.getFullYear() + " FEBRERO " + date.getDay()
            case 3:
              return date.getFullYear() + " MARZO " + date.getDay()
            case 4:
              return date.getFullYear() + " ABRIL " + date.getDay()
            case 5:
              return date.getFullYear() + " MAYO " + date.getDay()
            case 6:
              return date.getFullYear() + " JUNIO " + date.getDay()
            case 7:
              return date.getFullYear() + " JULIO " + date.getDay()
            case 8:
              return date.getFullYear() + " AGOSTO " + date.getDay()
            case 9:
              return date.getFullYear() + " SEPTIEMBRE " + date.getDay()
            case 10:
              return date.getFullYear() + " OCTUBRE " + date.getDay()
            case 11:
              return date.getFullYear() + " NOVIEMBRE " + date.getDay()
            case 12:
              return date.getFullYear() + " DICIEMBRE " + date.getDay()
          }
        case "Cheque":
          if(date.getMonth() > 9){
            if(date.getDay() > 9){
              return date.getDay() + "/" +  date.getMonth() + "/" +  date.getFullYear()
            }else{
              return date.getDay() + "/" +  date.getMonth() + "/0" +  date.getFullYear()
            }
          }else{
            if(date.getDay() > 9){
              return date.getDay() + "/0" +  date.getMonth() + "/" +  date.getFullYear()
            }else{
              return date.getDay() + "/0" +  date.getMonth() + "/0" +  date.getFullYear()
            }
          }
        default:
          return valor.toString()
      }
    case "Derecha":
      var num = parseFloat(valor)
      switch(ext){  
        case "Normal":
          return num.toString()
        case "Numero":
          return num.toString()
        case "Miles":
          return formatMoney(num, ",", ".");
        case "Dolar":
          return '$ '+ formatMoney(num, ",", ".");
        case "Euro":
          return '€ '+ formatMoney(num, ".", ",");
        case "Porcentaje":
          return  (num /100) + '%'
        default:
          return num.toString()
      }
    case "Numero":
      var num = parseFloat(valor)
      switch(ext){  
        case "Numero":
          return num.toString()
        case "Miles":  
          return formatMoney(num, ",", ".");
        case "Dolar":
          return '$ '+ formatMoney(num, ",", ".");
        case "Euro":
          return '€ '+ formatMoney(num, ".", ",");
        case "Porcentaje":
          return  (num /100) + '%'
        default:
          return num.toString()
      }
    case "CerosFijos":
      return valor.toString()
    default:
  }
}

function formatMoney(n, c, d, t) {
  var c = isNaN(c = Math.abs(c)) ? 2 : c,
    d = d == undefined ? "." : d,
    t = t == undefined ? "," : t,
    s = n < 0 ? "-" : "",
    i = String(parseInt(n = Math.abs(Number(n) || 0).toFixed(c))),
    j = (j = i.length) > 3 ? j % 3 : 0;

  return s + (j ? i.substr(0, j) + t : "") + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + t) + (c ? d + Math.abs(n - i).toFixed(c).slice(2) : "");
}

</script>


  </head>

  <body class="nav-md">
    <div class="container body">
      <div class="main_container">
        <div class="col-md-3 left_col">
          <div class="left_col scroll-view">
            <div class="navbar nav_title" style="border: 0;">
              <p class="site_title"><i class="fa fa-bar-chart" style="border: 0px;"></i> <span>{{Id_empresa}}</span></p>
              <img style="display: none;" id="logo_cia" src="/static/archivos/{{Id_empresa}}/logo.png" alt="image"  value="logo.png">
            </div>


            <div class="clearfix"></div>

            <br />
          <!-- <form name="Reportes" method="post"> -->
          {% csrf_token %}

            <!-- sidebar menu -->
            <div id="sidebar-menu" class="main_menu_side hidden-print main_menu">
              <div class="menu_section">
                <h3>Menu</h3>
                <ul class="nav side-menu">

              {% for id in menu %}
                  <li><a><i class="{{ id.icono }}"></i> {{ id.Nombre }} <span class="fa fa-chevron-down"></span></a>
                    <ul class="nav child_menu">
                    {% for pkmodulo in modulos %}{% if id.PkModGen == pkmodulo.PkModGen %}{% if pkmodulo.formtipo == "Registro" %}<li><a class="dropdown-item" id="{{ pkmodulo.id }}" value="registro" result="{{ pkmodulo.mdesc }}">{{ pkmodulo.mdesc }}</a></li>{% endif %}{% if pkmodulo.formtipo == "Reporte" %}  
                          <li><a>{{ pkmodulo.mdesc }}<span class="fa fa-chevron-down"></span></a><ul class="nav child_menu">{% for repor in reportes %}{% if repor.Pkmodulo == pkmodulo.PkModulo %}
                                <li><a class="dropdown-item" id="{{ repor.PkReporte }}" value="reporte" result="{{ repor.diplay }}">{{ repor.diplay }}</a></li>{% endif %}{% endfor %}</ul></li>{% endif %}{% endif %}{% endfor %}</ul>{% endfor %}                               
                  </li>
                </ul>
              </div>
              <div class="menu_section">
              </div>

            </div>
            <!-- /sidebar menu -->

            <!-- /menu footer buttons -->
            <div class="sidebar-footer hidden-small">
              <a data-toggle="tooltip" data-placement="top" title="Settings">
                <span class="glyphicon glyphicon-cog" aria-hidden="true"></span>
              </a>
              <a data-toggle="tooltip" data-placement="top" title="FullScreen">
                <span class="glyphicon glyphicon-fullscreen" aria-hidden="true"></span>
              </a>
              <a data-toggle="tooltip" data-placement="top" title="Lock">
                <span class="glyphicon glyphicon-eye-close" aria-hidden="true"></span>
              </a>
              <a data-toggle="tooltip" data-placement="top" title="Logout" href="login.html">
                <span class="glyphicon glyphicon-off" aria-hidden="true"></span>
              </a>
            </div>
            <!-- /menu footer buttons -->
          </div>
        </div>


        <!-- top navigation -->
        <div class="top_nav">
          <div class="nav_menu">
            <nav>
              <div class="nav toggle">
                <a id="menu_toggle"><i class="fa fa-bars"></i></a>
              </div>

              <ul class="nav navbar-nav navbar-right">
                <li class="">
                  <a href="javascript:;" class="user-profile dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                    <img src="images/img.jpg" alt="">John Doe
                    <span class=" fa fa-angle-down"></span>
                  </a>
                  <ul class="dropdown-menu dropdown-usermenu pull-right">
                    <li><a href="javascript:;"> Profile</a></li>
                    <li>
                      <a href="javascript:;">
                        <span class="badge bg-red pull-right">50%</span>
                        <span>Settings</span>
                      </a>
                    </li>
                    <li><a href="javascript:;">Help</a></li>
                    <li><a href="login.html"><i class="fa fa-sign-out pull-right"></i> Log Out</a></li>
                  </ul>
                </li>

                <li role="presentation" class="dropdown">
                  <a href="javascript:;" class="dropdown-toggle info-number" data-toggle="dropdown" aria-expanded="false">
                    <i class="fa fa-envelope-o"></i>
                    <span class="badge bg-green">6</span>
                  </a>
                  <ul id="menu1" class="dropdown-menu list-unstyled msg_list" role="menu">
                    <li>
                      <a>
                        <span class="image"><img src="images/img.jpg" alt="Profile Image" /></span>
                        <span>
                          <span>John Smith</span>
                          <span class="time">3 mins ago</span>
                        </span>
                        <span class="message">
                          Film festivals used to be do-or-die moments for movie makers. They were where...
                        </span>
                      </a>
                    </li>
                    <li>
                      <a>
                        <span class="image"><img src="images/img.jpg" alt="Profile Image" /></span>
                        <span>
                          <span>John Smith</span>
                          <span class="time">3 mins ago</span>
                        </span>
                        <span class="message">
                          Film festivals used to be do-or-die moments for movie makers. They were where...
                        </span>
                      </a>
                    </li>
                    <li>
                      <a>
                        <span class="image"><img src="images/img.jpg" alt="Profile Image" /></span>
                        <span>
                          <span>John Smith</span>
                          <span class="time">3 mins ago</span>
                        </span>
                        <span class="message">
                          Film festivals used to be do-or-die moments for movie makers. They were where...
                        </span>
                      </a>
                    </li>
                    <li>
                      <a>
                        <span class="image"><img src="images/img.jpg" alt="Profile Image" /></span>
                        <span>
                          <span>John Smith</span>
                          <span class="time">3 mins ago</span>
                        </span>
                        <span class="message">
                          Film festivals used to be do-or-die moments for movie makers. They were where...
                        </span>
                      </a>
                    </li>
                    <li>
                      <div class="text-center">
                        <a>
                          <strong>See All Alerts</strong>
                          <i class="fa fa-angle-right"></i>
                        </a>
                      </div>
                    </li>
                  </ul>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <!-- /top navigation -->

        <!-- page content -->
        <div class="right_col" role="main">
                   
                  <div class="x_content">

                    <div class="" role="tabpanel" data-example-id="togglable-tabs">
                      <ul id="myTab" class="nav nav-tabs bar_tabs" role="tablist">
                        <li role="presentation" class="active"><a href="#tab_content1" id="home-tab" role="tab" data-toggle="tab" aria-expanded="true">{{idioma_html.inicio}}</a>
                        </li>
                      </ul>

                      <div id="myTabContent" class="tab-content">
                        <div role="tabpanel" class="tab-pane fade active in" id="tab_content1" aria-labelledby="home-tab">

                          <div class="row" role="main">
                  

                          <div id="panel_cemaforo" class="row" style="padding-top: 50px;">

                            <div class="col-md-12">
                              <div class="col-middle">
                                  <div class="text-center text-center">
                                      <h1 class="error-number"></h1>
                                      <h2>{{idioma_html.espere}}</h2>
                                      <p>{{idioma_html.carga}}.</p>
                                      <div class="weather-icon">
                                            <span>
                                                                <canvas height="84" width="84" id="partly-cloudy-day"></canvas>
                                                            </span>
                                          </div>
                                  </div>
                              </div>
                            </div>
                          </div>
          

        </div>
        
                        </div>
                      </div>
                    </div>
                  </div>

                <div class="x_content">
            



                </div>



        
         
                  </div>




       
        

        </div>


                  <div class="modal fade bs-example-modal-md" tabindex="-1" role="dialog" aria-hidden="true" id="modal3">
                    <div class="modal-dialog modal-md">
                      <div class="modal-content">
                        <div class="modal-header">
                          <button type="utton" class="close" data-dismiss="modal"><span aria-hidden="true">×</span>
                          </button>
                          <h4 class="modal-title" id="myModalLabel">{{idioma_html.detalle}}</h4>
                        </div>
                        <div class="modal-body">
                          <div class="form-group">
                            <div class="col-md-6 col-sm-6 col-xs-12">
                              <input type="hidden" id="vfinal_bus_2" class="form-control col-md-7 col-xs-12">
                            </div>
                          </div>
                          <div id="intreportemodal">
                          </div>  
                        </div>
                      </div>
                    </div>
                  </div>





                  <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-hidden="true" id="modal1">
                    <div class="modal-dialog modal-lg">
                      <div class="modal-content">
                        <div class="modal-header">
                          <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span>
                          </button>
                          <h4 class="modal-title" id="myModalLabel">{{idioma_html.Buscador}}</h4>
                        </div>
                        <div class="modal-body">
                          <div class="form-group">
                            
                            <div class="col-md-6 col-sm-6 col-xs-12">
                              <input type="hidden" id="vfinal_bus_2" class="form-control col-md-7 col-xs-12">
                            </div>
                          </div>
                          <input type="hidden" id="vfinal_bus" name="vfinal_bus" value=""> 
                          <input type="hidden" id="buscador_senten" name="buscador_senten" value=""> 

                          <div id="intbuscador">
                          </div>  
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="modal fade bs-example-modal-sm"  tabindex="-1" role="dialog" aria-hidden="true">
                    <div class="modal-dialog modal-sm" style="width: 800px;">
                      <div class="modal-content">

                        <div class="modal-header">
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span>
                          </button>
                        <div id="intnotaCab">

                        </div>


                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">{{idioma_html.eliminar_txt}}</span>    </button>

                        mover a <select class="nota_tarea_txt" id="nota_tarea_cbx" onchange="movernota()">
                  {% for list in estados %}<option>{{list.nombre}}</option>{% endfor %}
                          </select>
                        </div>
                        <div>
                <div class="x_panel">
                  <div class="x_content">
                    <div class="" role="tabpanel" data-example-id="togglable-tabs">
                      <ul id="myTab" class="nav nav-tabs bar_tabs" role="tablist">

                        <li role="presentation" class="active"><a href="#nota_txt" id="nota-tab" role="tab" data-toggle="tab" aria-expanded="true">{{idioma_html.texto}}</a>
                        </li>
                        <li role="presentation" class=""><a href="#nota_adj" role="tab" id="nota-tab2" data-toggle="tab" aria-expanded="false">{{idioma_html.adjunto}}</a>
                        </li>
                        <li role="presentation" class=""><a href="#nota_tarea" role="tab" id="nota-tab3" data-toggle="tab" aria-expanded="false">{{idioma_html.tarea}}</a>
                        </li>
                        <li role="presentation" class=""><a href="#nota_doc" role="tab" id="nota-tab4" data-toggle="tab" aria-expanded="false">{{idioma_html.documento}}</a>
                        </li>

                      </ul>
                      <input type="hidden" id="vpk_nota" name="vpk_nota" value=""> 

                      <div id="myTabContent" class="tab-content">
                        <div role="tabpanel" class="tab-pane fade active in" id="nota_txt" aria-labelledby="home-tab">
                            <textarea id="vpk_nota_txt" required="required" class="form-control" name="vpk_nota_txt" data-parsley-trigger="keyup" data-parsley-minlength="20" data-parsley-maxlength="100" data-parsley-minlength-message="Come on! You need to enter at least a 20 caracters long comment.." data-parsley-validation-threshold="10"></textarea>
                            <button type="button" class="btn btn-primary" onclick="nota_texto()"><span class="fa fa-comment" aria-hidden="true">{{idioma_html.add}}</span></button>
                        </div>
                        <div role="tabpanel" class="tab-pane fade" id="nota_adj" aria-labelledby="profile-tab">
                          
                           <div class="x_content">
                            <p>{{idioma_html.adjunto_des}}</p>


                            <form method="post" enctype="multipart/form-data" id="form_nota">
                              {% csrf_token %}
                              <input type="file" name="myfile_nota" id="myfile_nota">
                              <input type="hidden" name="Id_empresa" value="{{Id_empresa}}" >
                              <button type="submit">Upload</button>

                              <button onclick="subir_archivo_nota2();" type="button" class="btn btn-primary">{{idioma_html.subir}}</button>
                            </form>


                            <!--<input type="file" name="files[]" id="input_files" />
                            <button onclick="subir_archivo_nota();" type="button" class="btn btn-primary">{{idioma_html.subir}}</button>-->
                            <div id="div_update_file" > </div>
                          </div>
                        </div>
                        <div role="tabpanel" class="tab-pane fade" id="nota_tarea" aria-labelledby="profile-tab">
                          <p>{{idioma_html.tarea_des}}</p>
                          <input type="text" class="form-control" id="vpk_nota_tarea" name="nota_tarea_txt" value="" placeholder="{{idioma_html.ing_tarea}}"> 
                          <input type="text" id="vpk_nota_responsable"class="form-control" readonly="readonly" placeholder="{{idioma_html.responsable}}">
                          <select class="nota_tarea_txt" id="nota_tarea_cbx">
                                                {% for usuario in list_user %}
                                                <option>{{usuario.usuario}}</option>
                                                {% endfor %}
                          </select>
                          <button type="button" class="btn btn-primary" onclick="incrementar_resp()"><span>{{idioma_html.add}}</span></button>
                          <button type="button" class="btn btn-primary" onclick="crear_resp()"><span>{{idioma_html.crear_add}}</span></button>
                        </div>
                        <div role="tabpanel" class="tab-pane fade" id="nota_doc" aria-labelledby="profile-tab">
                          <p>{{idioma_html.documento_des}}</p>


                          
                          <select class="nota_tarea_txt" id="nota_doc_menu_cbx" onchange="nota_doc_filtrar()">
                           {% for id in menu %}<option>{{ id.Nombre }}</option>{% endfor %}
                                                
                                                
                          </select>
                          <select class="nota_tarea_txt" id="nota_doc_proceso_cbx" onchange="nota_doc_buscar()">
                                           
                          </select>
                         

                          <br>
                          <label>Identificador: </label> 
                          <select class="nota_tarea_txt" id="nota_doc_proceso_campoiden" onchange="limpiarnota_doc_buscar()">                 
                          </select>
                          <input type="text" readonly="readonly" id="nota_doc_proceso_valoriden">
                          <input type="hidden" id="nota_doc_proceso_pk" value="">
                          <button class="btn btn-primary" onclick="nota_doc_grabar()" ><span class="fa fa-save" aria-hidden="true"></button>

                          

                          <div id="divbusca_nota_doc" style="overflow: auto;"></div>

                        </div>
                      </div>
                    </div>

                  </div>
                </div>
              </div>
                        <div style="width: 800px; background: whitesmoke;" id="intnota">

                        </div>
                        

                      </div>
                    </div>
                  </div>


        <!-- /page content -->

        <!-- footer content -->
        <footer>
          <div class="pull-right">
          <div class="clearfix"></div>
        </footer>
        <!-- /footer content -->
      </div>
    </div>

<!-- jQuery 3 -->
<script src="/static/a/bower_components/jquery/dist/jquery.min.js"></script>
<!-- jQuery UI 1.11.4 -->
<script src="/static/a/bower_components/jquery-ui/jquery-ui.min.js"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script>
  $.widget.bridge('uibutton', $.ui.button);
</script>
<!-- Bootstrap 3.3.7 -->
<script src="/static/a/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<!-- Material Design -->
<script src="/static/a/dist/js/material.min.js"></script>
<script src="/static/a/dist/js/ripples.min.js"></script>
<script>
    $.material.init();
</script>
<!-- Morris.js charts -->
<script src="/static/a/bower_components/raphael/raphael.min.js"></script>
<script src="/static/a/bower_components/morris.js/morris.min.js"></script>
<!-- Sparkline -->
<script src="/static/a/bower_components/jquery-sparkline/dist/jquery.sparkline.min.js"></script>
<!-- jvectormap -->
<script src="/static/a/plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
<script src="/static/a/plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
<!-- jQuery Knob Chart -->
<script src="/static/a/bower_components/jquery-knob/dist/jquery.knob.min.js"></script>
<!-- daterangepicker -->
<script src="/static/a/bower_components/moment/min/moment.min.js"></script>
<script src="/static/a/bower_components/bootstrap-daterangepicker/daterangepicker.js"></script>
<!-- datepicker -->
<script src="/static/a/bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
<!-- Bootstrap WYSIHTML5 -->
<script src="/static/a/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script>
<!-- Slimscroll -->
<script src="/static/a/bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>
<!-- FastClick -->
<script src="/static/a/bower_components/fastclick/lib/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="/static/a/dist/js/adminlte.min.js"></script>
<!-- AdminLTE dashboard demo (This is only for demo purposes) -->
<script src="/static/a/dist/js/pages/dashboard.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="/static/a/dist/js/demo.js"></script>
<script src="/static/vendors/bootstrap-daterangepicker/daterangepicker.js"></script>
    <script src="/static/raphael-2.1.4.min.js"></script>
    <script src="/static/justgage.js"></script>
        <script src="/static/vendors/jquery/dist/jquery.min.js"></script>
    <script src="/static/vendors/DateJS/build/date.js"></script>
    <script src="/static/raphael-2.1.4.min.js"></script>
    <script src="/static/justgage.js"></script>
</body>
</html>

<!--       _
       .__(.)< (MEOW)
        \___)   
 ~~~~~~~~~~~~~~~~~~-->

